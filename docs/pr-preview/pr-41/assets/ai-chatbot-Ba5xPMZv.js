import{r as Ue,i as Be,x as w,E as We}from"./iframe-BE0vYhhu.js";import{t as Pe}from"./custom-element-UsVr97OX.js";import{n as m}from"./property-BKOuPZs4.js";import{n as S,e as E}from"./ref-OntQz8h1.js";import{n as D}from"./when-CI7b_ccM.js";import{S as He}from"./mock-adapter-CGsAFG5D.js";import{g as _,d as Oe}from"./utils-B0W8KtS_.js";import"./ai-attachment-BrzUH0A6.js";import"./ai-chat-header-agTb7fuF.js";import"./ai-chat-interface-DJopIrR_.js";import"./ai-file-picker-BpI_tK24.js";import"./ai-message-thread-G7IWXvIc.js";import"./ai-prompt-2dQi7aqP.js";import"./ai-spinner-DzDLaiFr.js";import"./ai-suggestions-D913ntDt.js";import"./ai-voice-input-BXoGT79c.js";class qe{constructor(e){this._attachments=new Map,this._abortCallbacks=new Map,this._config=e}get pendingAttachments(){return Array.from(this._attachments.values()).filter(e=>e.status==="pending"||e.status==="uploading").map(e=>e.metadata)}get completedAttachments(){return Array.from(this._attachments.values()).filter(e=>e.status==="complete").map(e=>e.metadata)}get allAttachments(){return Array.from(this._attachments.values()).map(e=>e.metadata)}get isUploading(){return Array.from(this._attachments.values()).some(e=>e.status==="uploading")}updateConfig(e){this._config={...this._config,...e}}addAttachment(e,s){const a={id:e,status:"pending",...s};this._attachments.set(e,{id:e,metadata:a,status:"pending"}),this._config.onStateChange?.()}removeAttachment(e){this._attachments.delete(e),this._abortCallbacks.delete(e),this._config.onStateChange?.()}removeCompletedAttachment(e){this._attachments.get(e)?.status==="complete"&&(this._attachments.delete(e),this._config.onStateChange?.())}updateProgress(e,s){const a=this._attachments.get(e);a&&(a.status="uploading",a.metadata.uploading=!0,a.metadata.progress=s,a.metadata.status="uploading",this._config.onStateChange?.())}markComplete(e,s){const a=this._attachments.get(e);a&&(a.status="complete",a.uploadedFile=s,a.metadata.uploading=!1,a.metadata.progress=100,a.metadata.status="success",a.metadata.fileId=s.fileId,this._config.onStateChange?.())}markError(e,s){const a=this._attachments.get(e);a&&(a.status="error",a.errorMessage=s,a.metadata.uploading=!1,a.metadata.status="error",a.metadata.error=s,console.error(`File upload error for ${a.metadata.filename}: ${s}`),this._config.onError?.(s),this.removeAttachment(e))}registerOnAbort(e,s){this._abortCallbacks.set(e,s)}abort(e){const s=this._abortCallbacks.get(e);s&&s(),this.removeAttachment(e)}canSend(){return!Array.from(this._attachments.values()).some(e=>e.status==="uploading")}getCompletedUploads(){return Array.from(this._attachments.values()).filter(e=>e.status==="complete"&&e.uploadedFile).map(e=>e.uploadedFile)}clear(){this._attachments.clear(),this._abortCallbacks.clear(),this._config.onStateChange?.()}}class Ne{constructor(e,s){this._host=e,this._config=s,this._messageItems=[],this._toolCalls=new Map,this._activeResponse=null,e.addController(this)}hostConnected(){}hostDisconnected(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null}updateConfig(e){this._config={...this._config,...e}}get messageItems(){return this._messageItems}getToolCall(e){return this._toolCalls.get(e)}getActiveResponse(){return this._activeResponse}startResponse(){if(this._activeResponse)return this._activeResponse;const e={id:_(),children:[],status:"streaming",timestamp:Date.now()};return this._activeResponse=e,this._messageItems=[...this._messageItems,{type:"assistant",data:e}],this.#e(),e}addTextToResponse(e,s,a){const n=this._activeResponse??this.startResponse(),l=n.children[n.children.length-1];l?.type==="text"&&l.messageId===e&&l.status==="streaming"?l.content=s:n.children.push({type:"text",messageId:e,content:s,status:"streaming"}),a&&this.#t({type:"message-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#e()}appendTextDelta(e,s,a){const n=this._activeResponse??this.startResponse(),l=n.children[n.children.length-1];l?.type==="text"&&l.messageId===e&&l.status==="streaming"?l.content+=s:n.children.push({type:"text",messageId:e,content:s,status:"streaming"}),a&&this.#t({type:"message-delta",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#e()}markTextComplete(e,s){if(!this._activeResponse)return;const a=[...this._activeResponse.children].reverse().find(n=>n.type==="text"&&n.messageId===e);a&&a.type==="text"&&(a.status="complete"),s&&this.#t({type:"message-end",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#e()}addToolCallToResponse(e,s){const a=this._activeResponse??this.startResponse();if(this._toolCalls.set(e.id,e),a.children.push({type:"toolCall",data:e}),s){const n={type:"tool-call-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent};this.#t(n),this.#a(e.id,n)}this.#s(),this.#e()}updateToolCallInResponse(e,s,a){const n=this._toolCalls.get(e);if(!n)return;const l={...n,...s};if(this._toolCalls.set(e,l),this._activeResponse){for(const c of this._activeResponse.children)if(c.type==="toolCall"&&c.data.id===e){c.data=l;break}}if(a)if(a.eventType==="tool-call-args"){const c=a.event,u={type:"tool-call-args",timestamp:Date.now(),data:c,rawEvent:c.rawEvent};this.#t(u),this.#a(e,u)}else{const c=a.event,u={type:"tool-call-end",timestamp:Date.now(),data:c,rawEvent:c.rawEvent};this.#t(u),this.#a(e,u)}this.#s(),this.#e()}completeToolCallInResponse(e,s,a){if(this.updateToolCallInResponse(e,{result:s,status:"complete"}),a){const n={type:"tool-result",timestamp:Date.now(),data:a,rawEvent:a.rawEvent};this.#t(n),this.#a(e,n)}}tryFinalizeResponse(){this._activeResponse&&(this._activeResponse.status="complete",this.#s(),this._activeResponse=null,this.#e(),this._config.onThreadSettled?.())}#s(){const e=this._activeResponse;e&&(this._messageItems=this._messageItems.map(s=>s.type==="assistant"&&s.data.id===e.id?{type:"assistant",data:{...e}}:s))}#t(e){this._activeResponse&&(this._activeResponse.eventStream=[...this._activeResponse.eventStream||[],e])}#a(e,s){const a=this._toolCalls.get(e);if(!a)return;const n=[...a.eventStream||[],s],l={...a,eventStream:n};if(this._toolCalls.set(e,l),this._activeResponse){for(const c of this._activeResponse.children)if(c.type==="toolCall"&&c.data.id===e){c.data=l;break}}}#e(){this._host.requestUpdate()}addMessageItem(e){this._messageItems=[...this._messageItems,e],this.#e()}addMessage(e,s){this.tryFinalizeResponse(),!this.getMessage(e.id)&&(this.addMessageItem({type:"message",data:e}),s&&this.#i(e.id,{type:"message-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),e.status==="complete"&&this._config.onThreadSettled?.())}getMessage(e){const s=this._messageItems.find(a=>a.type==="message"&&a.data.id===e);return s?.type==="message"?s.data:void 0}updateMessageStatus(e,s,a){this._messageItems=this._messageItems.map(n=>n.type==="message"&&n.data.id===e?{...n,data:{...n.data,status:s}}:n),a&&this.#i(e,{type:"message-end",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#e(),(s==="complete"||s==="error")&&this._config.onThreadSettled?.()}updateMessageContent(e,s){this._messageItems=this._messageItems.map(a=>a.type==="message"&&a.data.id===e?{...a,data:{...a.data,content:s}}:a),this.#e()}removeMessageItem(e){this._messageItems=this._messageItems.filter((s,a)=>a!==e),this.#e()}clearMessages(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null,this.#e(),this._config.onThreadSettled?.()}removeMessageItemsFrom(e){this._messageItems=this._messageItems.slice(0,e),this._activeResponse=null,this.#e()}getMessages(){const e=[];for(const s of this._messageItems)if(s.type==="message")e.push({...s.data,toolCalls:[]});else if(s.type==="assistant"){const a=s.data,n=a.children.filter(u=>u.type==="text").map(u=>u.content).join(""),l=a.children.filter(u=>u.type==="toolCall").map(u=>u.data),c={id:a.id,role:"assistant",content:n,timestamp:a.timestamp,status:a.status==="streaming"?"streaming":a.status==="error"?"error":"complete",toolCalls:l.length?l:void 0,eventStream:a.eventStream,feedback:a.feedback,children:a.children};e.push(c)}else if(s.type==="toolCall"){const a=e[e.length-1];a&&a.role==="assistant"&&(a.toolCalls=[...a.toolCalls||[],s.data])}return e}setMessages(e){const s=[];this._toolCalls.clear(),this._activeResponse=null;for(const a of e)if(a.role==="assistant"&&a.status!=="error"){let n;if(a.children?.length)n=a.children.map(c=>(c.type==="toolCall"&&this._toolCalls.set(c.data.id,c.data),c));else if(n=[],a.content?.trim()&&n.push({type:"text",messageId:a.id,content:a.content,status:"complete"}),a.toolCalls)for(const c of a.toolCalls)n.push({type:"toolCall",data:c}),this._toolCalls.set(c.id,c);const l={id:a.id,children:n,status:a.status==="streaming"?"streaming":"complete",timestamp:a.timestamp,eventStream:a.eventStream,feedback:a.feedback};s.push({type:"assistant",data:l})}else s.push({type:"message",data:{...a,toolCalls:void 0}});this._messageItems=s,this.#e()}setResponseFeedback(e,s){const a=this._messageItems.find(n=>n.type==="assistant"&&n.data.id===e);a?.type==="assistant"&&(a.data.feedback=s,this.#e())}#i(e,s){this._messageItems.some(n=>n.type==="message"&&n.data.id===e)&&(this._messageItems=this._messageItems.map(n=>{if(n.type==="message"&&n.data.id===e){const l=[...n.data.eventStream||[],s];return{...n,data:{...n.data,eventStream:l}}}return n}),this.#e())}}const Le=':host{display:block;width:100%;height:100%}forge-ai-chat-interface::part(messages){overflow:hidden}forge-ai-chat-interface forge-ai-message-thread{min-height:0}.session-files{display:flex;flex-direction:column;gap:var(--forge-spacing-xsmall, 8px);min-width:0}.session-files .session-files-header{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6))}.session-files .session-files-list::-webkit-scrollbar{height:var(--forge-scrollbar-height, 16px);width:var(--forge-scrollbar-width, 16px)}.session-files .session-files-list::-webkit-scrollbar-track{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-track:hover{background-color:var(--forge-scrollbar-track-container-hover, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-corner{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-thumb{height:var(--forge-scrollbar-thumb-min-height, 32px);width:var(--forge-scrollbar-thumb-min-width, 32px);border-radius:var(--forge-scrollbar-border-radius, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));border-width:var(--forge-scrollbar-border-width, 3px);border-style:solid;border-color:transparent;background-color:var(--forge-scrollbar-thumb-container, var(--forge-theme-surface-container-medium, #c2c2c2));background-clip:content-box}.session-files .session-files-list::-webkit-scrollbar-thumb:hover{background-color:var(--forge-scrollbar-thumb-container-hover, var(--forge-theme-surface-container-high, #9e9e9e))}.session-files .session-files-list{display:flex;gap:var(--forge-spacing-small, 12px);overflow-x:auto;padding-block-end:var(--forge-spacing-xsmall, 8px)}.disclaimer{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6));text-align:center;margin-block-start:var(--forge-spacing-xxsmall, 4px);margin-block-end:calc(var(--forge-spacing-small, 12px) * -1)}';var je=Object.defineProperty,Je=Object.getOwnPropertyDescriptor,K=t=>{throw TypeError(t)},g=(t,e,s,a)=>{for(var n=a>1?void 0:a?Je(e,s):e,l=t.length-1,c;l>=0;l--)(c=t[l])&&(n=(a?c(e,s,n):c(n))||n);return a&&n&&je(e,s,n),n},W=(t,e,s)=>e.has(t)||K("Cannot "+s),o=(t,e,s)=>(W(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?K("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),x=(t,e,s,a)=>(W(t,e,"write to private field"),e.set(t,s),s),r=(t,e,s)=>(W(t,e,"access private method"),s),Y=(t,e,s,a)=>({set _(n){x(t,e,n)},get _(){return o(t,e,a)}}),U,R,y,z,h,p,C,I,T,i,Q,v,$,X,k,M,B,Z,ee,te,se,P,ae,ie,oe,H,ne,re,le,he,ce,de,O,q,pe,F,ge,me,fe,ue,be,ye,N,_e,ve,L,we,xe,Ce,Me,Ie,Te,$e,Re,j,J,ke,G,Ae,Ee,V,Se,ze,Fe,f,A,De;const Ge="forge-ai-chatbot";let d=class extends Be{constructor(){super(...arguments),b(this,i),this.fileUpload="off",this.voiceInput="on",this.debugCommand="on",this.placeholder="Ask a question...",this.showExpandButton=!1,this.showMinimizeButton=!1,this.expanded=!1,this.minimizeIcon="default",this.enableReactions=!1,this.titleText="AI Assistant",this.headingLevel=2,this.debugMode=!1,this.disclaimerText="AI can make mistakes. Always verify responses.",this.agents=[],b(this,U,E()),b(this,R,E()),b(this,y,E()),b(this,z,E()),b(this,h),b(this,p),b(this,C),b(this,I),b(this,T,0)}connectedCallback(){super.connectedCallback(),x(this,h,new Ne(this,{tools:o(this,i,M),onThreadSettled:()=>r(this,i,De).call(this)})),x(this,p,new qe({onError:t=>{r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:t}})},onStateChange:()=>{this.requestUpdate()}})),this.adapter&&r(this,i,B).call(this)}disconnectedCallback(){super.disconnectedCallback(),o(this,I)?.unsubscribe(),this.adapter?.disconnect()}willUpdate(t){t.has("adapter")&&this.adapter&&(x(this,C,void 0),r(this,i,B).call(this))}clearMessages(){o(this,h).clearMessages(),o(this,p).clear()}getMessages(){return o(this,h).getMessages()}setMessages(t){o(this,h).setMessages(t)}getSelectedAgent(){return this.agents.find(t=>t.id===this.selectedAgentId)}async sendMessage(t,e){if(!this.adapter){console.warn("No adapter configured.");return}if(o(this,y).value?.closeSlashMenu(),e){const s=Date.now();for(const a of e)r(this,i,L).call(this,a,s)}await r(this,i,q).call(this,{content:t,attachments:o(this,p).pendingAttachments})}abort(){r(this,i,F).call(this)}async scrollToBottom({behavior:t}={}){await o(this,R).value?.updateComplete,await new Promise(requestAnimationFrame),o(this,R).value?.scrollToBottom({behavior:t})}getThreadState(){return{threadId:this.adapter?.threadId,messages:this.getMessages(),timestamp:Date.now(),selectedAgentId:this.selectedAgentId}}async setThreadState(t){this.setMessages(t.messages),t.threadId&&this.adapter&&(this.adapter.threadId=t.threadId),this.selectedAgentId=t.selectedAgentId,await this.updateComplete;const e=t.messages.filter(s=>s.role==="user").map(s=>s.content);o(this,y).value?.setHistory(e),this.scrollToBottom({behavior:"instant"})}render(){return w`
      <forge-ai-chat-interface
        ${S(o(this,U))}
        role="region"
        aria-label="AI chatbot"
        aria-live="polite"
        aria-busy=${o(this,i,$)}>
        <forge-ai-chat-header
          ${S(o(this,z))}
          slot="header"
          ?show-expand-button=${this.showExpandButton}
          ?show-minimize-button=${this.showMinimizeButton}
          ?expanded=${this.expanded}
          ?disable-agent-selector=${o(this,i,$)}
          export-option=${o(this,i,k)?"enabled":"off"}
          clear-option=${o(this,i,k)?"enabled":"off"}
          .minimizeIcon=${this.minimizeIcon}
          .agentInfo=${this.agentInfo}
          .headingLevel=${this.headingLevel}
          .titleText=${this.titleText}
          .agents=${this.agents}
          .selectedAgentId=${this.selectedAgentId}
          @forge-ai-chat-header-expand=${r(this,i,$e)}
          @forge-ai-chat-header-minimize=${r(this,i,Re)}
          @forge-ai-chat-header-clear=${r(this,i,j)}
          @forge-ai-chat-header-export=${r(this,i,V)}
          @forge-ai-chat-header-info=${r(this,i,J)}
          @forge-ai-chat-header-agent-change=${r(this,i,ke)}>
          <slot name="icon" slot="icon">
            <forge-ai-icon></forge-ai-icon>
          </slot>
        </forge-ai-chat-header>
        ${o(this,i,Se)} ${o(this,i,Fe)} ${o(this,i,ze)}
        ${D(this.disclaimerText,()=>w`<div class="disclaimer" slot="disclaimer">${this.disclaimerText}</div>`)}
      </forge-ai-chat-interface>
    `}};U=new WeakMap;R=new WeakMap;y=new WeakMap;z=new WeakMap;h=new WeakMap;p=new WeakMap;C=new WeakMap;I=new WeakMap;T=new WeakMap;i=new WeakSet;Q=function(){const t=[];return o(this,i,k)&&(t.push({id:"clear",name:"Clear",group:"Conversation"}),t.push({id:"export",name:"Export",group:"Conversation"})),t.push({id:"info",name:"Info",group:"Help"}),this.debugCommand==="on"&&t.push({id:"debug",name:`${this.debugMode?"Disable debug mode":"Enable debug mode"}`,group:"Help"}),t};v=function(){return o(this,h)?.messageItems??[]};$=function(){return(this.adapter?.isRunning??!1)||o(this,T)>0};X=function(){return o(this,p)?.isUploading??!1};k=function(){return o(this,i,v).length>0};M=function(){return o(this,C)||x(this,C,new Map(this.adapter?.getTools().map(t=>[t.name,t])??[])),o(this,C)};B=async function(){!this.adapter||this.adapter.isConnecting||(await this.adapter.connect(),o(this,I)?.unsubscribe(),x(this,I,new He),o(this,I).add(this.adapter.onMessageStart(r(this,i,Z).bind(this)),this.adapter.onMessageDelta(r(this,i,ee).bind(this)),this.adapter.onMessageEnd(r(this,i,te).bind(this)),this.adapter.onToolCallStart(r(this,i,ae).bind(this)),this.adapter.onToolCallArgs(r(this,i,ie).bind(this)),this.adapter.onToolCallEnd(r(this,i,oe).bind(this)),this.adapter.onToolCall(r(this,i,ne).bind(this)),this.adapter.onToolCallResult(r(this,i,de).bind(this)),this.adapter.onRunFinished(r(this,i,se).bind(this)),this.adapter.onRunAborted(r(this,i,he).bind(this)),this.adapter.onError(r(this,i,le).bind(this)),this.adapter.onStateChange(r(this,i,ce).bind(this))),x(this,C,void 0),o(this,h)?.updateConfig({tools:o(this,i,M)}),r(this,i,f).call(this,{type:"forge-ai-chatbot-connected"}))};Z=function(t){o(this,h).addTextToResponse(t.messageId,"",t)};ee=function(t){o(this,h).appendTextDelta(t.messageId,t.delta,t),this.scrollToBottom()};te=function(t){o(this,h).markTextComplete(t.messageId,t)};se=function(){r(this,i,P).call(this)};P=function(){if(o(this,T)>0||this.adapter?.isRunning)return;o(this,h).tryFinalizeResponse();const t=this.getMessages(),e=t[t.length-1];e?.role==="assistant"&&e.status==="complete"&&r(this,i,A).call(this,"forge-ai-chatbot-message-received",e)};ae=function(t){const e={id:t.id,messageId:t.messageId,name:t.name,args:{},argsBuffer:"",status:"parsing",type:o(this,i,M).has(t.name)?"client":"agent"};o(this,h).addToolCallToResponse(e,t)};ie=function(t){const e={argsBuffer:t.argsBuffer,args:t.partialArgs??{}},s={eventType:"tool-call-args",event:t};o(this,h).updateToolCallInResponse(t.id,e,s),this.scrollToBottom()};oe=function(t){const e={args:t.args,argsBuffer:void 0,status:"executing"},s={eventType:"tool-call-end",event:t};o(this,h).updateToolCallInResponse(t.id,e,s)};H=function(t,e){return typeof e=="string"||e&&typeof e=="object"?e:`Tool '${t}' executed successfully`};ne=async function(t){let e=o(this,h).getToolCall(t.id);if(e?o(this,h).updateToolCallInResponse(t.id,{args:t.args,status:"executing"}):(e={id:t.id,messageId:t.messageId,name:t.name,args:t.args,status:"executing",type:o(this,i,M).has(t.name)?"client":"agent"},o(this,h).addToolCallToResponse(e)),e?.type==="client"){r(this,i,f).call(this,{type:"forge-ai-chatbot-tool-call",detail:{toolCallId:t.id,toolName:t.name,arguments:t.args}});const s=o(this,i,M).get(t.name);s?.handler?await Promise.resolve(r(this,i,re).call(this,t.id,t.name,s.handler,t.args)):r(this,i,O).call(this,t.id,r(this,i,H).call(this,t.name))}};re=async function(t,e,s,a){Y(this,T)._++,this.requestUpdate();try{const l=await s({args:a,toolCallId:t,toolName:e,signal:void 0});await r(this,i,O).call(this,t,r(this,i,H).call(this,e,l))}catch(n){console.error(`Tool handler error [${e}]:`,n),o(this,h).updateToolCallInResponse(t,{status:"error",result:{error:n.message}});const l={id:_(),role:"assistant",content:"An unexpected error occurred.",timestamp:Date.now(),status:"error"};o(this,h).addMessage(l),r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:n.message}})}finally{Y(this,T)._--,r(this,i,P).call(this),this.requestUpdate()}};le=function(t){const e={id:_(),role:"assistant",content:t.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(e),r(this,i,A).call(this,"forge-ai-chatbot-message-received",e),r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:t.message}})};he=function(){const t={id:_(),role:"system",content:"Run cancelled",timestamp:Date.now(),status:"complete",clientOnly:!0};o(this,h).addMessage(t),r(this,i,A).call(this,"forge-ai-chatbot-message-received",t)};ce=function(t){this.requestUpdate()};de=function(t){o(this,h).completeToolCallInResponse(t.toolCallId,t.result,t)};O=async function(t,e){!o(this,h).getToolCall(t)||!this.adapter||(o(this,h).completeToolCallInResponse(t,e),this.adapter.sendToolResult(t,e,this.getMessages()))};q=async function(t){if(!t.content.trim()||!this.adapter||o(this,i,$)){this.adapter||console.warn("No adapter configured.");return}if(!o(this,p).canSend())return;const e={id:_(),role:"user",content:t.content,timestamp:t.timestamp??Date.now(),status:"pending"};o(this,h).addMessage(e);try{this.adapter.sendMessage(this.getMessages()),o(this,h).updateMessageStatus(e.id,"complete")}catch(s){o(this,h).updateMessageStatus(e.id,"error");const a=s instanceof Error?s.message:"Failed to send message";r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:a}})}finally{r(this,i,A).call(this,"forge-ai-chatbot-message-sent",e.id)}};pe=async function(t){const e=[...o(this,p).pendingAttachments];await r(this,i,q).call(this,{content:t.detail.value,timestamp:t.detail.date.getTime(),attachments:e})};F=function(){this.adapter?.isRunning&&this.adapter.abort(),this.requestUpdate()};ge=function(){r(this,i,F).call(this)};me=async function(t){const e=t.detail.messageId,s=o(this,i,v).find(n=>n.type==="assistant"&&n.data.id===e);if(!s||s.type!=="assistant")return;const a=s.data.children.filter(n=>n.type==="text").map(n=>n.content).join(`

`);try{await navigator.clipboard.writeText(a)}catch{}};fe=async function(t){const e=t.detail.messageId,s=o(this,h).getMessage(e);if(!(!s||s.role!=="user"))try{await navigator.clipboard.writeText(s.content)}catch{}};ue=function(t){if(!this.adapter)return;const e=t.detail.messageId,s=o(this,i,v).findIndex(n=>n.type==="message"&&n.data.id===e);if(s===-1)return;const a=s+1;a<o(this,i,v).length&&o(this,h).removeMessageItemsFrom(a),this.adapter.sendMessage(this.getMessages())};be=function(t){if(!this.adapter)return;const{messageId:e,content:s}=t.detail,a=o(this,i,v).findIndex(l=>l.type==="message"&&l.data.id===e);if(a===-1)return;o(this,h).updateMessageContent(e,s);const n=a+1;n<o(this,i,v).length&&o(this,h).removeMessageItemsFrom(n),this.adapter.sendMessage(this.getMessages())};ye=function(t){if(!this.adapter)return;const e=t.detail.messageId,s=o(this,i,v).findIndex(a=>a.type==="assistant"&&a.data.id===e);s!==-1&&(o(this,h).removeMessageItemsFrom(s),this.adapter.sendMessage(this.getMessages()))};N=function(t,e){o(this,h).setResponseFeedback(t.detail.messageId,{type:e,reason:t.detail.feedback}),r(this,i,f).call(this,{type:"forge-ai-chatbot-response-feedback",detail:{messageId:t.detail.messageId,type:e,feedback:t.detail.feedback}})};_e=function(t){r(this,i,N).call(this,t,"positive")};ve=function(t){r(this,i,N).call(this,t,"negative")};L=function(t,e){const s=_();o(this,p).addAttachment(s,{filename:t.name,size:t.size,mimeType:t.type,timestamp:e});const a=r(this,i,xe).call(this,s);this.adapter?.emitFileUpload(t,a),r(this,i,f).call(this,{type:"forge-ai-chatbot-file-select",detail:{fileId:s,file:t,filename:t.name,size:t.size,mimeType:t.type,timestamp:e,...a}})};we=function(t){const{file:e,timestamp:s}=t.detail;r(this,i,L).call(this,e,s)};xe=function(t){return{updateProgress:e=>{o(this,p).updateProgress(t,e)},markComplete:e=>{o(this,p).markComplete(t,e)},markError:e=>{o(this,p).markError(t,e)},onAbort:e=>{o(this,p).registerOnAbort(t,e)}}};Ce=function(t){const e={id:_(),role:"assistant",content:t.detail.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(e)};Me=function(t){const{filename:e}=t.detail,s=o(this,p).pendingAttachments.find(n=>n.filename===e);if(s){o(this,p).abort(s.id);return}const a=o(this,p).completedAttachments.find(n=>n.filename===e);a&&a.fileId&&(o(this,p).removeCompletedAttachment(a.id),this.requestUpdate(),this.adapter?.emitFileRemove(a.fileId,{onSuccess:()=>{},onError:n=>{console.error(`Failed to remove file ${e}:`,n)}}))};Ie=async function(t){o(this,y).value?.addToHistory(t.detail.text),await this.sendMessage(t.detail.text),o(this,y).value?.focus()};Te=function(t){const{transcript:e}=t.detail;e&&o(this,y).value&&(o(this,y).value.value=e)};$e=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-expand"})};Re=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-minimize"})};j=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-clear",cancelable:!0}).defaultPrevented||this.clearMessages()};J=function(){const t=o(this,z).value;t?.showAgentInfo&&t.showAgentInfo(),r(this,i,f).call(this,{type:"forge-ai-chatbot-info"})};ke=function(t){const{agent:e,previousAgentId:s}=t.detail;if(!r(this,i,f).call(this,{type:"forge-ai-chatbot-agent-change",detail:{agent:e,previousAgentId:s}}).defaultPrevented&&(this.selectedAgentId=e?.id,this.adapter&&(this.adapter.threadId=_()),o(this,i,k))){const n=e?.name??this.titleText,l={id:_(),role:"system",content:`Switched to ${n}`,timestamp:Date.now(),status:"complete",clientOnly:!0};o(this,h).addMessage(l)}};G=function(){this.debugMode=!this.debugMode};Ae=function(t){switch(t.detail.commandId){case"clear":r(this,i,j).call(this);break;case"export":r(this,i,V).call(this);break;case"info":r(this,i,J).call(this);break;case"debug":r(this,i,G).call(this);break}};Ee=function(t){const e=[`  Tool: ${t.name}`,`  Args: ${JSON.stringify(t.args)}`];if(t.status==="error"){const s=typeof t.result=="object"&&t.result!==null&&"error"in t.result?t.result.error:"Unknown error";e.push(`  Error: ${s}`)}else t.result!==void 0&&e.push(`  Result: ${JSON.stringify(t.result)}`);return e.join(`
`)};V=function(){const t=this.getMessages();if(t.length===0)return;const e=t.map(a=>{const n=new Date(a.timestamp).toLocaleString(),l=a.role==="user"?"You":"Assistant";let c=`[${n}] ${l}:
${a.content}
`;return a.toolCalls?.length&&(c+=`
`+a.toolCalls.map(u=>r(this,i,Ee).call(this,u)).join(`

`)+`
`),c}).join(`
`),s=`chat-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`;Oe(e,s,"text/plain")};Se=function(){const t=o(this,p).completedAttachments,s=[...o(this,p).pendingAttachments,...t];return s.length===0?We:w`
      <div class="session-files" slot="attachments">
        <div class="session-files-header">Session Files (${s.length})</div>
        <div class="session-files-list">
          ${s.map(a=>w`
              <forge-ai-attachment
                .filename=${a.filename}
                .size=${a.size}
                ?uploading=${a.uploading??!1}
                removable
                @forge-ai-attachment-remove=${r(this,i,Me)}>
              </forge-ai-attachment>
            `)}
        </div>
      </div>
    `};ze=function(){const t=o(this,i,X);return w`
      <forge-ai-prompt
        ${S(o(this,y))}
        slot="prompt"
        .placeholder=${this.placeholder}
        .running=${o(this,i,$)||t}
        .slashCommands=${o(this,i,Q)}
        ?disabled=${t}
        ?debug-mode=${this.debugMode}
        @forge-ai-prompt-send=${r(this,i,pe)}
        @forge-ai-prompt-stop=${r(this,i,F)}
        @forge-ai-prompt-cancel=${r(this,i,ge)}
        @forge-ai-prompt-debug-toggle=${r(this,i,G)}
        @forge-ai-prompt-command=${r(this,i,Ae)}>
        ${D(this.fileUpload==="on",()=>w`
            <forge-ai-file-picker
              slot="actions"
              variant="icon-button"
              multiple
              ?disabled=${t}
              .selectedFiles=${o(this,p).pendingAttachments.map(e=>e.filename)}
              @forge-ai-file-picker-change=${r(this,i,we)}
              @forge-ai-file-picker-error=${r(this,i,Ce)}>
            </forge-ai-file-picker>
          `)}
        ${D(this.voiceInput==="on",()=>w`
            <forge-ai-voice-input slot="actions" @forge-ai-voice-input-result=${r(this,i,Te)}>
            </forge-ai-voice-input>
          `)}
      </forge-ai-prompt>
    `};Fe=function(){return w`
      <forge-ai-message-thread
        ${S(o(this,R))}
        .messageItems=${o(this,i,v)}
        .tools=${o(this,i,M)}
        ?enable-reactions=${this.enableReactions}
        ?show-thinking=${o(this,i,$)}
        ?debug-mode=${this.debugMode}
        @forge-ai-message-thread-copy=${r(this,i,me)}
        @forge-ai-message-thread-resend=${r(this,i,ye)}
        @forge-ai-message-thread-thumbs-up=${r(this,i,_e)}
        @forge-ai-message-thread-thumbs-down=${r(this,i,ve)}
        @forge-ai-message-thread-user-copy=${r(this,i,fe)}
        @forge-ai-message-thread-user-resend=${r(this,i,ue)}
        @forge-ai-message-thread-user-edit=${r(this,i,be)}>
        <slot name="empty-state-heading" slot="empty-state-heading"></slot>
        <slot name="empty-state-message" slot="empty-state-message"></slot>
        <forge-ai-suggestions
          slot="empty-state-actions"
          variant="block"
          .suggestions=${this.suggestions??[]}
          @forge-ai-suggestions-select=${r(this,i,Ie)}>
        </forge-ai-suggestions>
      </forge-ai-message-thread>
    `};f=function(t){const e=new CustomEvent(t.type,{detail:t.detail,bubbles:!0,composed:!0,cancelable:t.cancelable??!1});return this.dispatchEvent(e),e};A=function(t,e){const s=typeof e=="string"?o(this,h).getMessage(e):e;s&&r(this,i,f).call(this,{type:t,detail:{message:s}})};De=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-thread-state-change"})};d.styles=Ue(Le);g([m({attribute:!1})],d.prototype,"adapter",2);g([m({attribute:"file-upload"})],d.prototype,"fileUpload",2);g([m({attribute:"voice-input"})],d.prototype,"voiceInput",2);g([m({attribute:"debug-command"})],d.prototype,"debugCommand",2);g([m()],d.prototype,"placeholder",2);g([m({attribute:!1})],d.prototype,"suggestions",2);g([m({type:Boolean,attribute:"show-expand-button"})],d.prototype,"showExpandButton",2);g([m({type:Boolean,attribute:"show-minimize-button"})],d.prototype,"showMinimizeButton",2);g([m({type:Boolean})],d.prototype,"expanded",2);g([m({attribute:"minimize-icon"})],d.prototype,"minimizeIcon",2);g([m({type:Boolean,attribute:"enable-reactions"})],d.prototype,"enableReactions",2);g([m({type:Object,attribute:!1})],d.prototype,"agentInfo",2);g([m({attribute:"title-text"})],d.prototype,"titleText",2);g([m({attribute:"heading-level",type:Number})],d.prototype,"headingLevel",2);g([m({type:Boolean,attribute:"debug-mode"})],d.prototype,"debugMode",2);g([m({attribute:"disclaimer-text"})],d.prototype,"disclaimerText",2);g([m({attribute:!1})],d.prototype,"agents",2);g([m({attribute:"selected-agent-id"})],d.prototype,"selectedAgentId",2);d=g([Pe(Ge)],d);
