import{r as at,i as ot,x as y,E as st}from"./iframe-CCWsMM7d.js";import{t as rt}from"./custom-element-UsVr97OX.js";import{n as h}from"./property-BBKQEB1X.js";import{n as U,e as D}from"./ref-Bdh8BJ3W.js";import{n as W}from"./when-CI7b_ccM.js";import{S as Xt}from"./mock-adapter-CGsAFG5D.js";import{g as k,d as te}from"./utils-B0W8KtS_.js";import"./ai-attachment-CqfcxrRQ.js";import"./ai-chat-header-Dm9seQfX.js";import"./ai-chat-interface-DnZT2ajC.js";import"./ai-file-picker-27kosksN.js";import"./ai-message-thread-B4QtgsHi.js";import"./ai-prompt-CCEcOO_b.js";import"./ai-spinner-DYKUrOUQ.js";import"./ai-suggestions-DPm5Gj5M.js";import"./ai-voice-input-Br6U9Lud.js";class ee{constructor(t){this._attachments=new Map,this._abortCallbacks=new Map,this._config=t}get pendingAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="pending"||t.status==="uploading").map(t=>t.metadata)}get completedAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete").map(t=>t.metadata)}get allAttachments(){return Array.from(this._attachments.values()).map(t=>t.metadata)}get isUploading(){return Array.from(this._attachments.values()).some(t=>t.status==="uploading")}updateConfig(t){this._config={...this._config,...t}}addAttachment(t,a){const o={id:t,status:"pending",...a};this._attachments.set(t,{id:t,metadata:o,status:"pending"}),this._config.onStateChange?.()}removeAttachment(t){this._attachments.delete(t),this._abortCallbacks.delete(t),this._config.onStateChange?.()}removeCompletedAttachment(t){this._attachments.get(t)?.status==="complete"&&(this._attachments.delete(t),this._config.onStateChange?.())}updateProgress(t,a){const o=this._attachments.get(t);o&&(o.status="uploading",o.metadata.uploading=!0,o.metadata.progress=a,o.metadata.status="uploading",this._config.onStateChange?.())}markComplete(t,a){const o=this._attachments.get(t);o&&(o.status="complete",o.uploadedFile=a,o.metadata.uploading=!1,o.metadata.progress=100,o.metadata.status="success",o.metadata.fileId=a.fileId,this._config.onStateChange?.())}markError(t,a){const o=this._attachments.get(t);o&&(o.status="error",o.errorMessage=a,o.metadata.uploading=!1,o.metadata.status="error",o.metadata.error=a,console.error(`File upload error for ${o.metadata.filename}: ${a}`),this._config.onError?.(a),this.removeAttachment(t))}registerOnAbort(t,a){this._abortCallbacks.set(t,a)}abort(t){const a=this._abortCallbacks.get(t);a&&a(),this.removeAttachment(t)}canSend(){return!Array.from(this._attachments.values()).some(t=>t.status==="uploading")}getCompletedUploads(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete"&&t.uploadedFile).map(t=>t.uploadedFile)}clear(){this._attachments.clear(),this._abortCallbacks.clear(),this._config.onStateChange?.()}}class ae{constructor(t,a){this._host=t,this._config=a,this._messageItems=[],this._toolCalls=new Map,this._activeResponse=null,t.addController(this)}hostConnected(){}hostDisconnected(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null}updateConfig(t){this._config={...this._config,...t}}get messageItems(){return this._messageItems}getToolCall(t){return this._toolCalls.get(t)}getActiveResponse(){return this._activeResponse}startResponse(){if(this._activeResponse)return this._activeResponse;const t={id:k(),children:[],status:"streaming",timestamp:Date.now()};return this._activeResponse=t,this._messageItems=[...this._messageItems,{type:"assistant",data:t}],this.#t(),t}addTextToResponse(t,a,o){const i=this._activeResponse??this.startResponse(),d=i.children.findIndex(l=>l.type==="text"&&l.messageId===t);if(d>=0){const l=i.children[d];l.type==="text"&&(l.content=a)}else i.children.push({type:"text",messageId:t,content:a,status:"streaming"});o&&this.#e({type:"message-start",timestamp:Date.now(),data:o,rawEvent:o.rawEvent}),this.#a(),this.#t()}appendTextDelta(t,a,o){const i=this._activeResponse??this.startResponse(),d=i.children.find(l=>l.type==="text"&&l.messageId===t);d&&d.type==="text"?d.content+=a:i.children.push({type:"text",messageId:t,content:a,status:"streaming"}),o&&this.#e({type:"message-delta",timestamp:Date.now(),data:o,rawEvent:o.rawEvent}),this.#a(),this.#t()}markTextComplete(t,a){if(!this._activeResponse)return;const o=this._activeResponse.children.find(i=>i.type==="text"&&i.messageId===t);o&&o.type==="text"&&(o.status="complete"),a&&this.#e({type:"message-end",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#a(),this.#t()}addToolCallToResponse(t,a){const o=this._activeResponse??this.startResponse();if(this._toolCalls.set(t.id,t),o.children.push({type:"toolCall",data:t}),a){const i={type:"tool-call-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent};this.#e(i),this.#o(t.id,i)}this.#a(),this.#t()}updateToolCallInResponse(t,a,o){const i=this._toolCalls.get(t);if(!i)return;const d={...i,...a};if(this._toolCalls.set(t,d),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=d;break}}if(o)if(o.eventType==="tool-call-args"){const l=o.event,p={type:"tool-call-args",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(p),this.#o(t,p)}else{const l=o.event,p={type:"tool-call-end",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(p),this.#o(t,p)}this.#a(),this.#t()}completeToolCallInResponse(t,a,o){if(this.updateToolCallInResponse(t,{result:a,status:"complete"}),o){const i={type:"tool-result",timestamp:Date.now(),data:o,rawEvent:o.rawEvent};this.#e(i),this.#o(t,i)}}tryFinalizeResponse(){this._activeResponse&&(this._activeResponse.status="complete",this.#a(),this._activeResponse=null,this.#t())}#a(){const t=this._activeResponse;t&&(this._messageItems=this._messageItems.map(a=>a.type==="assistant"&&a.data.id===t.id?{type:"assistant",data:{...t}}:a))}#e(t){this._activeResponse&&(this._activeResponse.eventStream=[...this._activeResponse.eventStream||[],t])}#o(t,a){const o=this._toolCalls.get(t);if(!o)return;const i=[...o.eventStream||[],a],d={...o,eventStream:i};if(this._toolCalls.set(t,d),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=d;break}}}#t(){this._host.requestUpdate()}addMessageItem(t){this._messageItems=[...this._messageItems,t],this.#t()}addMessage(t,a){this.tryFinalizeResponse(),!this.getMessage(t.id)&&(this.addMessageItem({type:"message",data:t}),a&&this.#s(t.id,{type:"message-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}))}getMessage(t){const a=this._messageItems.find(o=>o.type==="message"&&o.data.id===t);return a?.type==="message"?a.data:void 0}updateMessageStatus(t,a,o){this._messageItems=this._messageItems.map(i=>i.type==="message"&&i.data.id===t?{...i,data:{...i.data,status:a}}:i),o&&this.#s(t,{type:"message-end",timestamp:Date.now(),data:o,rawEvent:o.rawEvent}),this.#t()}updateMessageContent(t,a){this._messageItems=this._messageItems.map(o=>o.type==="message"&&o.data.id===t?{...o,data:{...o.data,content:a}}:o),this.#t()}removeMessageItem(t){this._messageItems=this._messageItems.filter((a,o)=>o!==t),this.#t()}clearMessages(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null,this.#t()}removeMessageItemsFrom(t){this._messageItems=this._messageItems.slice(0,t),this._activeResponse=null,this.#t()}getMessages(){const t=[];for(const a of this._messageItems)if(a.type==="message")t.push({...a.data,toolCalls:[]});else if(a.type==="assistant"){const o=a.data,i=o.children.filter(p=>p.type==="text").map(p=>p.content).join(""),d=o.children.filter(p=>p.type==="toolCall").map(p=>p.data),l={id:o.id,role:"assistant",content:i,timestamp:o.timestamp,status:o.status==="streaming"?"streaming":o.status==="error"?"error":"complete",toolCalls:d.length?d:void 0,eventStream:o.eventStream,feedback:o.feedback,children:o.children};t.push(l)}else if(a.type==="toolCall"){const o=t[t.length-1];o&&o.role==="assistant"&&(o.toolCalls=[...o.toolCalls||[],a.data])}return t}setMessages(t){const a=[];this._toolCalls.clear(),this._activeResponse=null;for(const o of t)if(o.role==="assistant"&&o.status!=="error"){let i;if(o.children?.length)i=o.children.map(l=>(l.type==="toolCall"&&this._toolCalls.set(l.data.id,l.data),l));else if(i=[],o.content?.trim()&&i.push({type:"text",messageId:o.id,content:o.content,status:"complete"}),o.toolCalls)for(const l of o.toolCalls)i.push({type:"toolCall",data:l}),this._toolCalls.set(l.id,l);const d={id:o.id,children:i,status:o.status==="streaming"?"streaming":"complete",timestamp:o.timestamp,eventStream:o.eventStream,feedback:o.feedback};a.push({type:"assistant",data:d})}else a.push({type:"message",data:{...o,toolCalls:void 0}});this._messageItems=a,this.#t()}setResponseFeedback(t,a){const o=this._messageItems.find(i=>i.type==="assistant"&&i.data.id===t);o?.type==="assistant"&&(o.data.feedback=a,this.#t())}#s(t,a){this._messageItems.some(i=>i.type==="message"&&i.data.id===t)&&(this._messageItems=this._messageItems.map(i=>{if(i.type==="message"&&i.data.id===t){const d=[...i.data.eventStream||[],a];return{...i,data:{...i.data,eventStream:d}}}return i}),this.#t())}}const it="confirmToolCall",oe='.forge-button{--_button-primary-color: var(--forge-button-primary-color, var(--forge-theme-primary, #3f51b5));--_button-text-color: var(--forge-button-text-color, var(--_button-primary-color));--_button-disabled-color: var(--forge-button-disabled-color, var(--forge-theme-surface-container, #e0e0e0));--_button-padding: var(--forge-button-padding, var(--forge-spacing-medium, 16px));--_button-display: var(--forge-button-display, inline-grid);--_button-justify: var(--forge-button-justify, center);--_button-shape: var(--forge-button-shape, calc(var(--forge-shape-medium, 4px) * var(--forge-shape-factor, 1)));--_button-height: var(--forge-button-height, 36px);--_button-min-width: var(--forge-button-min-width, 64px);--_button-spacing: var(--forge-button-spacing, var(--forge-spacing-xsmall, 8px));--_button-border-width: var(--forge-button-border-width, medium);--_button-border-style: var(--forge-button-border-style, none);--_button-border-color: var(--forge-button-border-color, currentColor);--_button-shape-start-start-radius: var(--forge-button-shape-start-start-radius, var(--_button-shape));--_button-shape-start-end-radius: var(--forge-button-shape-start-end-radius, var(--_button-shape));--_button-shape-end-start-radius: var(--forge-button-shape-end-start-radius, var(--_button-shape));--_button-shape-end-end-radius: var(--forge-button-shape-end-end-radius, var(--_button-shape));--_button-padding-block: var(--forge-button-padding-block, var(--_button-0));--_button-padding-inline: var(--forge-button-padding-inline, var(--_button-padding));--_button-background: var(--forge-button-background, transparent);--_button-hover-background: var(--forge-button-hover-background, var(--_button-background));--_button-active-background: var(--forge-button-active-background, var(--_button-background));--_button-color: var(--forge-button-color, var(--_button-text-color));--_button-icon-size: var(--forge-button-icon-size, calc(var(--forge-typography-font-size, 1rem) * 1.125));--_button-shadow: var(--forge-button-shadow, none);--_button-hover-shadow: var(--forge-button-hover-shadow, none);--_button-active-shadow: var(--forge-button-active-shadow, none);--_button-cursor: var(--forge-button-cursor, pointer);--_button-transition-duration: var(--forge-button-transition-duration, var(--forge-animation-duration-short3, .15s));--_button-transition-timing: var(--forge-button-transition-timing, var(--forge-animation-easing-standard, cubic-bezier(.2, 0, 0, 1)));--_button-text-padding-inline: var(--forge-button-text-padding-inline, var(--forge-spacing-xsmall, 8px));--_button-outlined-background: var(--forge-button-outlined-background, transparent);--_button-outlined-color: var(--forge-button-outlined-color, var(--_button-primary-color));--_button-outlined-border-width: var(--forge-button-outlined-border-width, var(--forge-border-thin, 1px));--_button-outlined-border-style: var(--forge-button-outlined-border-style, solid);--_button-outlined-border-color: var(--forge-button-outlined-border-color, var(--_button-primary-color));--_button-tonal-background: var(--forge-button-tonal-background, var(--forge-theme-primary-container, #d1d5ed));--_button-tonal-disabled-background: var(--forge-button-tonal-disabled-background, var(--_button-disabled-color));--_button-tonal-color: var(--forge-button-tonal-color, var(--forge-theme-on-primary-container, #222c62));--_button-tonal-disabled-color: var(--forge-button-tonal-disabled-color, var(--_button-disabled-text-color));--_button-filled-background: var(--forge-button-filled-background, var(--_button-primary-color));--_button-filled-disabled-background: var(--forge-button-filled-disabled-background, var(--_button-disabled-color));--_button-filled-color: var(--forge-button-filled-color, var(--forge-theme-on-primary, #ffffff));--_button-filled-disabled-color: var(--forge-button-filled-disabled-color, var(--_button-disabled-text-color));--_button-raised-background: var(--forge-button-raised-background, var(--_button-primary-color));--_button-raised-disabled-background: var(--forge-button-raised-disabled-background, var(--_button-disabled-color));--_button-raised-color: var(--forge-button-raised-color, var(--forge-theme-on-primary, #ffffff));--_button-raised-disabled-color: var(--forge-button-raised-disabled-color, var(--_button-disabled-text-color));--_button-raised-shadow: var(--forge-button-raised-shadow, 0px 3px 1px -2px rgba(0, 0, 0, .2), 0px 2px 2px 0px rgba(0, 0, 0, .14), 0px 1px 5px 0px rgba(0, 0, 0, .12));--_button-raised-hover-shadow: var(--forge-button-raised-hover-shadow, 0px 2px 4px -1px rgba(0, 0, 0, .2), 0px 4px 5px 0px rgba(0, 0, 0, .14), 0px 1px 10px 0px rgba(0, 0, 0, .12));--_button-raised-active-shadow: var(--forge-button-raised-active-shadow, 0px 5px 5px -3px rgba(0, 0, 0, .2), 0px 8px 10px 1px rgba(0, 0, 0, .14), 0px 3px 14px 2px rgba(0, 0, 0, .12));--_button-raised-disabled-shadow: var(--forge-button-raised-disabled-shadow, none);--_button-link-color: var(--forge-button-link-color, var(--_button-primary-color));--_button-link-text-decoration: var(--forge-button-link-text-decoration, underline);--_button-link-height: var(--forge-button-link-height, auto);--_button-link-padding: var(--forge-button-link-padding, 0);--_button-link-line-height: var(--forge-button-link-line-height, normal);--_button-link-width: var(--forge-button-link-width, auto);--_button-link-hover-text-decoration: var(--forge-button-link-hover-text-decoration, none);--_button-link-active-opacity: var(--forge-button-link-active-opacity, .65);--_button-link-transition-duration: var(--forge-button-link-transition-duration, var(--forge-animation-duration-short3, .15s));--_button-link-transition-timing: var(--forge-button-link-transition-timing, var(--forge-animation-easing-standard, cubic-bezier(.2, 0, 0, 1)));--_button-disabled-cursor: var(--forge-button-disabled-cursor, not-allowed);--_button-disabled-text-color: var(--forge-button-disabled-text-color, var(--forge-theme-text-low, rgba(0, 0, 0, .38)));--_button-disabled-background: var(--forge-button-disabled-background, transparent);--_button-disabled-border-color: var(--forge-button-disabled-border-color, var(--_button-disabled-color));--_button-disabled-shadow: var(--forge-button-disabled-shadow, none);--_button-dense-height: var(--forge-button-dense-height, 24px);--_button-pill-shape: var(--forge-button-pill-shape, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));--_button-pill-padding-inline: var(--forge-button-pill-padding-inline, var(--forge-spacing-small, 12px));--_button-focus-indicator-offset: var(--forge-button-focus-indicator-offset, 4px);--_button-text-focus-indicator-offset: var(--forge-button-text-focus-indicator-offset, 0px);--_button-link-focus-indicator-offset: var(--forge-button-link-focus-indicator-offset, 2px);--_button-popover-icon-transition-duration: var(--forge-button-popover-icon-transition-duration, var(--forge-animation-duration-short3, .15s));--_button-popover-icon-transition-timing: var(--forge-button-popover-icon-transition-timing, var(--forge-animation-easing-standard, cubic-bezier(.2, 0, 0, 1)));--_button-popover-icon-open-rotation: var(--forge-button-popover-icon-open-rotation, 180deg)}.forge-button{-webkit-tap-highlight-color:transparent;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-button-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-button-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-button-font-size-scale, .875)));font-weight:var(--forge-typography-button-font-weight, 500);line-height:var(--forge-typography-button-line-height, normal);letter-spacing:var(--forge-typography-button-letter-spacing, .0714285714em);text-transform:var(--forge-typography-button-text-transform, inherit);text-decoration:var(--forge-typography-button-text-decoration, inherit);position:relative;display:var(--_button-display);grid-auto-flow:column;align-items:center;justify-content:var(--_button-justify);gap:var(--_button-spacing);z-index:0;box-sizing:border-box;min-inline-size:var(--_button-min-width);height:var(--_button-height);inline-size:100%;border-width:var(--_button-border-width);border-style:var(--_button-border-style);border-color:var(--_button-border-color);border-start-start-radius:var(--_button-shape-start-start-radius);border-start-end-radius:var(--_button-shape-start-end-radius);border-end-start-radius:var(--_button-shape-end-start-radius);border-end-end-radius:var(--_button-shape-end-end-radius);padding-block:var(--_button-padding-block);padding-inline:var(--_button-padding-inline);box-shadow:var(--_button-shadow);outline:none;-webkit-user-select:none;user-select:none;-webkit-appearance:none;vertical-align:middle;text-decoration:none;white-space:nowrap;background:var(--_button-background);color:var(--_button-color);cursor:var(--_button-cursor);transition-property:box-shadow,background;transition-duration:var(--_button-transition-duration);transition-timing-function:var(--_button-transition-timing)}.forge-button::-moz-focus-inner{padding:0;border:0}.forge-button:hover{--_button-shadow: var(--_button-hover-shadow);background:var(--_button-hover-background)}.forge-button:active{--_button-shadow: var(--_button-active-shadow);background:var(--_button-active-background)}.forge-button{position:relative;inline-size:auto}.forge-button:not(:disabled):not(.forge-button--link){--_state-layer-display: var(--forge-state-layer-display, flex);--_state-layer-color: var(--forge-state-layer-color, var(--forge-theme-on-surface, #000000));--_state-layer-hover-color: var(--forge-state-layer-hover-color, var(--_state-layer-color));--_state-layer-hover-opacity: var(--forge-state-layer-hover-opacity, .08);--_state-layer-pressed-color: var(--forge-state-layer-pressed-color, var(--_state-layer-color));--_state-layer-pressed-opacity: var(--forge-state-layer-pressed-opacity, .12);--_state-layer-hover-duration: var(--forge-state-layer-hover-duration, 15ms);--_state-layer-pressed-duration: var(--forge-state-layer-pressed-duration, 105ms);--_state-layer-animation-duration: var(--forge-state-layer-animation-duration, 375ms)}.forge-button:not(:disabled):not(.forge-button--link):before{position:absolute;backface-visibility:hidden;transform:translateZ(0);background-color:var(--_state-layer-hover-color);inset:0;transition:opacity var(--_state-layer-hover-duration) linear,background-color var(--_state-layer-hover-duration) linear;--_state-layer-hover-duration: var(--forge-state-layer-hover-duration, .1s);content:"";opacity:0;border-radius:inherit}.forge-button:not(:disabled):not(.forge-button--link):hover:before{background-color:var(--_state-layer-hover-color);opacity:var(--_state-layer-hover-opacity)}.forge-button:not(:disabled):not(.forge-button--link):active:before{opacity:var(--_state-layer-pressed-opacity);transition-duration:var(--_state-layer-pressed-duration);--_state-layer-pressed-opacity: var(--forge-state-layer-pressed-opacity, .18)}@keyframes forge-focus-indicator-outward-grow{0%{outline-width:0}to{outline-width:var(--_focus-indicator-active-width)}}@keyframes forge-focus-indicator-outward-shrink{0%{outline-width:var(--_focus-indicator-active-width)}}@keyframes forge-focus-indicator-inward-grow{0%{border-width:0}to{border-width:var(--_focus-indicator-active-width)}}@keyframes forge-focus-indicator-inward-shrink{0%{border-width:var(--_focus-indicator-active-width)}}.forge-button:not(:disabled){outline:none}.forge-button:not(:disabled):focus-visible:after{--_focus-indicator-display: var(--forge-focus-indicator-display, flex);--_focus-indicator-width: var(--forge-focus-indicator-width, var(--forge-border-medium, 2px));--_focus-indicator-active-width: var(--forge-focus-indicator-active-width, 6px);--_focus-indicator-color: var(--forge-focus-indicator-color, var(--forge-theme-primary, #3f51b5));--_focus-indicator-shape: var(--forge-focus-indicator-shape, calc(var(--forge-shape-extra-small, 1px) * var(--forge-shape-factor, 1)));--_focus-indicator-duration: var(--forge-focus-indicator-duration, var(--forge-animation-duration-long4, .6s));--_focus-indicator-easing: var(--forge-focus-indicator-easing, var(--forge-animation-easing-emphasized, cubic-bezier(.2, 0, 0, 1)));--_focus-indicator-shape-start-start: var(--forge-focus-indicator-shape-start-start, var(--_focus-indicator-shape));--_focus-indicator-shape-start-end: var(--forge-focus-indicator-shape-start-end, var(--_focus-indicator-shape));--_focus-indicator-shape-end-end: var(--forge-focus-indicator-shape-end-end, var(--_focus-indicator-shape));--_focus-indicator-shape-end-start: var(--forge-focus-indicator-shape-end-start, var(--_focus-indicator-shape));--_focus-indicator-outward-offset: var(--forge-focus-indicator-outward-offset, var(--forge-spacing-xxsmall, 4px));--_focus-indicator-inward-offset: var(--forge-focus-indicator-inward-offset, 0px);--_focus-indicator-offset-block: var(--forge-focus-indicator-offset-block, 0);--_focus-indicator-offset-inline: var(--forge-focus-indicator-offset-inline, 0)}.forge-button:not(:disabled):focus-visible:after{animation-delay:0s,calc(var(--_focus-indicator-duration) * .25);animation-duration:calc(var(--_focus-indicator-duration) * .25),calc(var(--_focus-indicator-duration) * .75);animation-timing-function:var(--_focus-indicator-easing);box-sizing:border-box;color:var(--_focus-indicator-color);display:none;pointer-events:none;position:absolute;margin-block:var(--_focus-indicator-offset-block);margin-inline:var(--_focus-indicator-offset-inline);animation-name:forge-focus-indicator-outward-grow,forge-focus-indicator-outward-shrink;border-end-end-radius:calc(var(--_focus-indicator-shape-end-end) + var(--_focus-indicator-outward-offset));border-end-start-radius:calc(var(--_focus-indicator-shape-end-start) + var(--_focus-indicator-outward-offset));border-start-end-radius:calc(var(--_focus-indicator-shape-start-end) + var(--_focus-indicator-outward-offset));border-start-start-radius:calc(var(--_focus-indicator-shape-start-start) + var(--_focus-indicator-outward-offset));inset:calc(-1 * var(--_focus-indicator-outward-offset));outline:var(--_focus-indicator-width) solid currentColor;content:"";display:block}.forge-button:not(:disabled){--forge-focus-indicator-color: var(--_button-primary-color)}.forge-button:disabled{cursor:var(--_button-disabled-cursor);--_button-background: var(--_button-disabled-background);--_button-color: var(--_button-disabled-text-color);--_button-shadow: var(--_button-disabled-shadow);pointer-events:none;pointer-events:initial}.forge-button:where(:not(.forge-button--outlined,.forge-button--tonal,.forge-button--filled,.forge-button--raised,.forge-button--link)),.forge-button--text{--_button-padding-inline: var(--_button-text-padding-inline)}.forge-button--outlined{--_button-background: var(--_button-outlined-background);--_button-color: var(--_button-outlined-color);--_button-border-width: var(--_button-outlined-border-width);--_button-border-style: var(--_button-outlined-border-style);--_button-border-color: var(--_button-outlined-border-color)}.forge-button--outlined:disabled{--_button-border-color: var(--_button-disabled-border-color)}.forge-button--tonal{--_button-background: var(--_button-tonal-background);--_button-color: var(--_button-tonal-color)}.forge-button--tonal:disabled{--_button-background: var(--_button-tonal-disabled-background);--_button-color: var(--_button-tonal-disabled-color)}.forge-button--filled,.forge-button--raised{--_button-background: var(--_button-filled-background);--_button-color: var(--_button-filled-color);--forge-state-layer-color: var(--_button-filled-color)}.forge-button--filled:disabled,.forge-button--raised:disabled{--_button-background: var(--_button-filled-disabled-background);--_button-color: var(--_button-filled-disabled-color)}.forge-button--raised{--_button-background: var(--_button-raised-background);--_button-color: var(--_button-raised-color);--_button-shadow: var(--_button-raised-shadow)}.forge-button--raised:hover{--_button-shadow: var(--_button-raised-hover-shadow)}.forge-button--raised:active{--_button-shadow: var(--_button-raised-active-shadow)}.forge-button--raised:disabled{--_button-background: var(--_button-raised-disabled-background);--_button-color: var(--_button-raised-disabled-color);--_button-shadow: var(--_button-raised-disabled-shadow)}.forge-button--link{--_button-color: var(--_button-link-color);--_button-height: var(--_button-link-height);--_button-padding: var(--_button-link-padding);--_button-focus-indicator-offset: var(--_button-link-focus-indicator-offset);text-decoration:var(--_button-link-text-decoration);line-height:var(--_button-link-line-height);transition:opacity var(--_button-link-transition-duration) var(--_button-link-transition-timing);inline-size:var(--_button-link-width)}.forge-button--link:hover{text-decoration:var(--_button-link-hover-text-decoration)}.forge-button--link:active{opacity:var(--_button-link-active-opacity)}.forge-button--pill{--_button-shape: var(--_button-pill-shape);--_button-padding-inline: var(--_button-pill-padding-inline);--forge-focus-indicator-shape: var(--_button-pill-shape)}.forge-button{--forge-icon-font-size: var(--_button-icon-size)}.forge-button--dense{--_button-height: var(--_button-dense-height)}:host{display:contents}.container{position:absolute;inset:auto var(--forge-spacing-medium, 16px) var(--forge-spacing-medium, 16px);z-index:10;display:flex;align-items:center;justify-content:space-between;gap:var(--forge-spacing-medium, 16px);padding:var(--forge-spacing-medium, 16px);background-color:var(--forge-theme-surface, #ffffff);border:1px solid var(--forge-theme-outline, #e0e0e0);border-radius:var(--forge-spacing-medium, 16px);box-shadow:0 2px 4px -1px #0003,0 4px 5px #00000024,0 1px 10px #0000001f;animation:slide-up-fade-in .3s cubic-bezier(0,0,0,1)}.text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-body1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-body1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-body-font-size-scale, .875)));font-weight:var(--forge-typography-body1-font-weight, 400);line-height:var(--forge-typography-body1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-body-line-height-scale, 1.125)));letter-spacing:var(--forge-typography-body1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-body1-text-transform, inherit);text-decoration:var(--forge-typography-body1-text-decoration, inherit);flex:1;color:var(--forge-theme-on-surface, #000000)}.actions{display:flex;gap:var(--forge-spacing-small, 12px)}@keyframes slide-up-fade-in{0%{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}';var se=Object.defineProperty,re=Object.getOwnPropertyDescriptor,nt=e=>{throw TypeError(e)},z=(e,t,a,o)=>{for(var i=o>1?void 0:o?re(t,a):t,d=e.length-1,l;d>=0;d--)(l=e[d])&&(i=(o?l(t,a,i):l(i))||i);return o&&i&&se(t,a,i),i},ie=(e,t,a)=>t.has(e)||nt("Cannot "+a),ne=(e,t,a)=>t.has(e)?nt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),tt=(e,t,a)=>(ie(e,t,"access private method"),a),F,lt,dt;const le="forge-ai-confirmation-prompt";let I=class extends ot{constructor(){super(...arguments),ne(this,F),this.text="",this.confirmText="Confirm",this.denyText="Deny",this.disabled=!1}render(){return y`
      <div class="container" role="alertdialog" aria-labelledby="confirmation-text" aria-modal="false">
        <div id="confirmation-text" class="text">${this.text}</div>
        <div class="actions">
          <button
            class="deny-button forge-button forge-button--outlined"
            ?disabled=${this.disabled}
            aria-label="Deny"
            @click=${tt(this,F,dt)}>
            ${this.denyText}
          </button>
          <button
            class="confirm-button forge-button forge-button--raised"
            ?disabled=${this.disabled}
            aria-label="Confirm"
            @click=${tt(this,F,lt)}>
            ${this.confirmText}
          </button>
        </div>
      </div>
    `}};F=new WeakSet;lt=function(){const e=new CustomEvent("forge-ai-confirmation-prompt-confirm",{bubbles:!0,composed:!0});this.dispatchEvent(e)};dt=function(){const e=new CustomEvent("forge-ai-confirmation-prompt-deny",{bubbles:!0,composed:!0});this.dispatchEvent(e)};I.styles=at(oe);z([h()],I.prototype,"text",2);z([h({attribute:"confirm-text"})],I.prototype,"confirmText",2);z([h({attribute:"deny-text"})],I.prototype,"denyText",2);z([h({type:Boolean})],I.prototype,"disabled",2);I=z([rt(le)],I);const de=':host{display:block;width:100%;height:100%}forge-ai-chat-interface::part(messages){overflow:hidden}forge-ai-chat-interface forge-ai-message-thread{min-height:0}.session-files{display:flex;flex-direction:column;gap:var(--forge-spacing-xsmall, 8px);min-width:0}.session-files .session-files-header{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6))}.session-files .session-files-list::-webkit-scrollbar{height:var(--forge-scrollbar-height, 16px);width:var(--forge-scrollbar-width, 16px)}.session-files .session-files-list::-webkit-scrollbar-track{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-track:hover{background-color:var(--forge-scrollbar-track-container-hover, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-corner{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-thumb{height:var(--forge-scrollbar-thumb-min-height, 32px);width:var(--forge-scrollbar-thumb-min-width, 32px);border-radius:var(--forge-scrollbar-border-radius, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));border-width:var(--forge-scrollbar-border-width, 3px);border-style:solid;border-color:transparent;background-color:var(--forge-scrollbar-thumb-container, var(--forge-theme-surface-container-medium, #c2c2c2));background-clip:content-box}.session-files .session-files-list::-webkit-scrollbar-thumb:hover{background-color:var(--forge-scrollbar-thumb-container-hover, var(--forge-theme-surface-container-high, #9e9e9e))}.session-files .session-files-list{display:flex;gap:var(--forge-spacing-small, 12px);overflow-x:auto;padding-block-end:var(--forge-spacing-xsmall, 8px)}.disclaimer{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6));text-align:center;margin-block-start:var(--forge-spacing-xxsmall, 4px);margin-block-end:calc(var(--forge-spacing-small, 12px) * -1)}';var ce=Object.defineProperty,he=Object.getOwnPropertyDescriptor,ct=e=>{throw TypeError(e)},g=(e,t,a,o)=>{for(var i=o>1?void 0:o?he(t,a):t,d=e.length-1,l;d>=0;d--)(l=e[d])&&(i=(o?l(t,a,i):l(i))||i);return o&&i&&ce(t,a,i),i},H=(e,t,a)=>t.has(e)||ct("Cannot "+a),r=(e,t,a)=>(H(e,t,"read from private field"),a?a.call(e):t.get(e)),v=(e,t,a)=>t.has(e)?ct("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),_=(e,t,a,o)=>(H(e,t,"write to private field"),t.set(e,a),a),n=(e,t,a)=>(H(e,t,"access private method"),a),et=(e,t,a,o)=>({set _(i){_(e,t,i)},get _(){return r(e,t,o)}}),q,A,x,B,c,f,C,$,T,m,s,ht,w,R,ut,ft,gt,P,M,N,pt,bt,mt,vt,j,_t,yt,xt,L,wt,Y,kt,Ct,It,Mt,E,J,$t,O,Tt,Rt,Et,At,zt,St,Dt,Ft,G,Ut,Bt,V,Pt,Ot,Wt,qt,Nt,Ht,jt,Lt,Z,K,Yt,Q,Jt,Gt,X,Vt,Zt,Kt,Qt,b,S;const ue="forge-ai-chatbot";let u=class extends ot{constructor(){super(...arguments),v(this,s),this.fileUpload="off",this.voiceInput="on",this.debugCommand="on",this.placeholder="Ask a question...",this.showExpandButton=!1,this.showMinimizeButton=!1,this.expanded=!1,this.minimizeIcon="default",this.enableReactions=!1,this.titleText="AI Assistant",this.headingLevel=2,this.debugMode=!1,this.disclaimerText="AI can make mistakes. Always verify responses.",this.agents=[],v(this,q,D()),v(this,A,D()),v(this,x,D()),v(this,B,D()),v(this,c),v(this,f),v(this,C),v(this,$),v(this,T,0),v(this,m)}connectedCallback(){super.connectedCallback(),_(this,c,new ae(this,{tools:r(this,s,M)})),_(this,f,new ee({onError:e=>{n(this,s,b).call(this,{type:"forge-ai-chatbot-error",detail:{error:e}})},onStateChange:()=>{this.requestUpdate()}})),this.adapter&&n(this,s,N).call(this)}disconnectedCallback(){super.disconnectedCallback(),r(this,$)?.unsubscribe(),this.adapter?.disconnect()}willUpdate(e){e.has("adapter")&&this.adapter&&(_(this,C,void 0),n(this,s,N).call(this))}clearMessages(){r(this,c).clearMessages(),r(this,f).clear()}getMessages(){return r(this,c).getMessages()}setMessages(e){r(this,c).setMessages(e)}getSelectedAgent(){return this.agents.find(e=>e.id===this.selectedAgentId)}async sendMessage(e,t){if(!this.adapter){console.warn("No adapter configured.");return}if(r(this,x).value?.closeSlashMenu(),t){const a=Date.now();for(const o of t)n(this,s,V).call(this,o,a)}await n(this,s,J).call(this,{content:e,attachments:r(this,f).pendingAttachments})}abort(){n(this,s,O).call(this)}async scrollToBottom({behavior:e}={}){await r(this,A).value?.updateComplete,await new Promise(requestAnimationFrame),r(this,A).value?.scrollToBottom({behavior:e})}getThreadState(){return{threadId:this.adapter?.threadId,messages:this.getMessages(),timestamp:Date.now()}}async setThreadState(e){this.setMessages(e.messages),e.threadId&&this.adapter&&(this.adapter.threadId=e.threadId),await this.updateComplete;const t=e.messages.filter(a=>a.role==="user").map(a=>a.content);r(this,x).value?.setHistory(t),this.scrollToBottom({behavior:"instant"})}render(){return y`
      <forge-ai-chat-interface
        ${U(r(this,q))}
        role="region"
        aria-label="AI chatbot"
        aria-live="polite"
        aria-busy=${r(this,s,R)}>
        <forge-ai-chat-header
          ${U(r(this,B))}
          slot="header"
          ?show-expand-button=${this.showExpandButton}
          ?show-minimize-button=${this.showMinimizeButton}
          ?expanded=${this.expanded}
          ?disable-agent-selector=${r(this,s,R)}
          export-option=${r(this,s,P)?"enabled":"off"}
          clear-option=${r(this,s,P)?"enabled":"off"}
          .minimizeIcon=${this.minimizeIcon}
          .agentInfo=${this.agentInfo}
          .headingLevel=${this.headingLevel}
          .titleText=${this.titleText}
          .agents=${this.agents}
          .selectedAgentId=${this.selectedAgentId}
          @forge-ai-chat-header-expand=${n(this,s,jt)}
          @forge-ai-chat-header-minimize=${n(this,s,Lt)}
          @forge-ai-chat-header-clear=${n(this,s,Z)}
          @forge-ai-chat-header-export=${n(this,s,X)}
          @forge-ai-chat-header-info=${n(this,s,K)}
          @forge-ai-chat-header-agent-change=${n(this,s,Yt)}>
          <slot name="icon" slot="icon">
            <forge-ai-icon></forge-ai-icon>
          </slot>
        </forge-ai-chat-header>
        ${r(this,s,Vt)} ${r(this,s,Qt)} ${r(this,s,Zt)} ${r(this,s,Kt)}
        ${W(this.disclaimerText,()=>y`<div class="disclaimer" slot="disclaimer">${this.disclaimerText}</div>`)}
      </forge-ai-chat-interface>
    `}};q=new WeakMap;A=new WeakMap;x=new WeakMap;B=new WeakMap;c=new WeakMap;f=new WeakMap;C=new WeakMap;$=new WeakMap;T=new WeakMap;m=new WeakMap;s=new WeakSet;ht=function(){const e=[];return r(this,s,P)&&(e.push({id:"clear",name:"Clear",group:"Conversation"}),e.push({id:"export",name:"Export",group:"Conversation"})),e.push({id:"info",name:"Info",group:"Help"}),this.debugCommand==="on"&&e.push({id:"debug",name:`${this.debugMode?"Disable debug mode":"Enable debug mode"}`,group:"Help"}),e};w=function(){return r(this,c)?.messageItems??[]};R=function(){return(this.adapter?.isRunning??!1)||r(this,T)>0};ut=function(){return r(this,m)!==void 0};ft=function(){return r(this,s,w).filter(e=>!(e.type==="toolCall"&&e.data.name===it))};gt=function(){return r(this,f)?.isUploading??!1};P=function(){return r(this,s,w).length>0};M=function(){return r(this,C)||_(this,C,new Map(this.adapter?.getTools().map(e=>[e.name,e])??[])),r(this,C)};N=async function(){!this.adapter||this.adapter.isConnecting||(await this.adapter.connect(),r(this,$)?.unsubscribe(),_(this,$,new Xt),r(this,$).add(this.adapter.onMessageStart(n(this,s,pt).bind(this)),this.adapter.onMessageDelta(n(this,s,bt).bind(this)),this.adapter.onMessageEnd(n(this,s,mt).bind(this)),this.adapter.onToolCallStart(n(this,s,_t).bind(this)),this.adapter.onToolCallArgs(n(this,s,yt).bind(this)),this.adapter.onToolCallEnd(n(this,s,xt).bind(this)),this.adapter.onToolCall(n(this,s,wt).bind(this)),this.adapter.onToolCallResult(n(this,s,Mt).bind(this)),this.adapter.onRunFinished(n(this,s,vt).bind(this)),this.adapter.onRunAborted(n(this,s,Ct).bind(this)),this.adapter.onError(n(this,s,kt).bind(this)),this.adapter.onStateChange(n(this,s,It).bind(this))),_(this,C,void 0),r(this,c)?.updateConfig({tools:r(this,s,M)}),n(this,s,b).call(this,{type:"forge-ai-chatbot-connected"}))};pt=function(e){r(this,c).addTextToResponse(e.messageId,"",e)};bt=function(e){r(this,c).appendTextDelta(e.messageId,e.delta,e),this.scrollToBottom()};mt=function(e){r(this,c).markTextComplete(e.messageId,e)};vt=function(){n(this,s,j).call(this)};j=function(){if(r(this,T)>0||this.adapter?.isRunning||r(this,m))return;r(this,c).tryFinalizeResponse();const e=this.getMessages(),t=e[e.length-1];t?.role==="assistant"&&t.status==="complete"&&n(this,s,S).call(this,"forge-ai-chatbot-message-received",t)};_t=function(e){const t={id:e.id,messageId:e.messageId,name:e.name,args:{},argsBuffer:"",status:"parsing",type:r(this,s,M).has(e.name)?"client":"agent"};r(this,c).addToolCallToResponse(t,e)};yt=function(e){const t={argsBuffer:e.argsBuffer,args:e.partialArgs??{}},a={eventType:"tool-call-args",event:e};r(this,c).updateToolCallInResponse(e.id,t,a),this.scrollToBottom()};xt=function(e){const t={args:e.args,argsBuffer:void 0,status:"executing"},a={eventType:"tool-call-end",event:e};r(this,c).updateToolCallInResponse(e.id,t,a)};L=function(e,t){return typeof t=="string"||t&&typeof t=="object"?t:`Tool '${e}' executed successfully`};wt=async function(e){let t=r(this,c).getToolCall(e.id);if(t?r(this,c).updateToolCallInResponse(e.id,{args:e.args,status:"executing"}):(t={id:e.id,messageId:e.messageId,name:e.name,args:e.args,status:"executing",type:r(this,s,M).has(e.name)?"client":"agent"},r(this,c).addToolCallToResponse(t)),e.name===it){const a=e.args;_(this,m,{type:"llm-driven",toolCallId:e.id,displayText:a.action??""}),this.requestUpdate();return}if(t?.type==="client"){n(this,s,b).call(this,{type:"forge-ai-chatbot-tool-call",detail:{toolCallId:e.id,toolName:e.name,arguments:e.args}});const a=r(this,s,M).get(e.name);if(a?.handler){const o=!!a.renderer;a.skipConfirmation||o?await Promise.resolve(n(this,s,Y).call(this,e.id,e.name,a.handler,e.args)):(_(this,m,{type:"auto-intercept",toolCallId:e.id,displayText:a.displayName??e.name,toolName:e.name,args:e.args,handler:a.handler}),this.requestUpdate())}else n(this,s,E).call(this,e.id,n(this,s,L).call(this,e.name))}};Y=async function(e,t,a,o){et(this,T)._++,this.requestUpdate();try{const d=await a({args:o,toolCallId:e,toolName:t,signal:void 0});await n(this,s,E).call(this,e,n(this,s,L).call(this,t,d))}catch(i){console.error(`Tool handler error [${t}]:`,i),r(this,c).updateToolCallInResponse(e,{status:"error",result:{error:i.message}});const d={id:k(),role:"assistant",content:"An unexpected error occurred.",timestamp:Date.now(),status:"error"};r(this,c).addMessage(d),n(this,s,b).call(this,{type:"forge-ai-chatbot-error",detail:{error:i.message}})}finally{et(this,T)._--,n(this,s,j).call(this),this.requestUpdate()}};kt=function(e){const t={id:k(),role:"assistant",content:e.message,timestamp:Date.now(),status:"error"};r(this,c).addMessage(t),n(this,s,S).call(this,"forge-ai-chatbot-message-received",t),n(this,s,b).call(this,{type:"forge-ai-chatbot-error",detail:{error:e.message}})};Ct=function(){const e={id:k(),role:"system",content:"Run cancelled",timestamp:Date.now(),status:"complete"};r(this,c).addMessage(e),n(this,s,S).call(this,"forge-ai-chatbot-message-received",e)};It=function(e){this.requestUpdate()};Mt=function(e){r(this,c).completeToolCallInResponse(e.toolCallId,e.result,e)};E=async function(e,t){!r(this,c).getToolCall(e)||!this.adapter||(r(this,c).completeToolCallInResponse(e,t),this.adapter.sendToolResult(e,t,this.getMessages()))};J=async function(e){if(!e.content.trim()||!this.adapter||r(this,s,R)){this.adapter||console.warn("No adapter configured.");return}if(!r(this,f).canSend())return;const t={id:k(),role:"user",content:e.content,timestamp:e.timestamp??Date.now(),status:"pending"};r(this,c).addMessage(t);try{this.adapter.sendMessage(this.getMessages()),r(this,c).updateMessageStatus(t.id,"complete")}catch(a){r(this,c).updateMessageStatus(t.id,"error");const o=a instanceof Error?a.message:"Failed to send message";n(this,s,b).call(this,{type:"forge-ai-chatbot-error",detail:{error:o}})}finally{n(this,s,S).call(this,"forge-ai-chatbot-message-sent",t.id)}};$t=async function(e){const t=[...r(this,f).pendingAttachments];await n(this,s,J).call(this,{content:e.detail.value,timestamp:e.detail.date.getTime(),attachments:t})};O=function(){this.adapter?.isRunning&&this.adapter.abort(),this.requestUpdate()};Tt=function(){n(this,s,O).call(this)};Rt=function(){if(!r(this,m))return;const{type:e,toolCallId:t,displayText:a,toolName:o,args:i,handler:d}=r(this,m);if(_(this,m,void 0),e==="llm-driven"){const l={status:"confirmed",action:a};n(this,s,E).call(this,t,l)}else e==="auto-intercept"&&d&&o&&i&&n(this,s,Y).call(this,t,o,d,i);this.requestUpdate()};Et=function(){if(!r(this,m))return;const{type:e,toolCallId:t,displayText:a,toolName:o}=r(this,m);if(_(this,m,void 0),e==="llm-driven"){const i={status:"denied",action:a};n(this,s,E).call(this,t,i)}else if(e==="auto-intercept"){const i={denied:!0,toolName:o??"unknown",message:"User denied this action"};n(this,s,E).call(this,t,i)}this.requestUpdate()};At=async function(e){const t=e.detail.messageId,a=r(this,s,w).find(i=>i.type==="assistant"&&i.data.id===t);if(!a||a.type!=="assistant")return;const o=a.data.children.filter(i=>i.type==="text").map(i=>i.content).join(`

`);try{await navigator.clipboard.writeText(o)}catch{}};zt=async function(e){const t=e.detail.messageId,a=r(this,c).getMessage(t);if(!(!a||a.role!=="user"))try{await navigator.clipboard.writeText(a.content)}catch{}};St=function(e){if(!this.adapter)return;const t=e.detail.messageId,a=r(this,s,w).findIndex(i=>i.type==="message"&&i.data.id===t);if(a===-1)return;const o=a+1;o<r(this,s,w).length&&r(this,c).removeMessageItemsFrom(o),this.adapter.sendMessage(this.getMessages())};Dt=function(e){if(!this.adapter)return;const{messageId:t,content:a}=e.detail,o=r(this,s,w).findIndex(d=>d.type==="message"&&d.data.id===t);if(o===-1)return;r(this,c).updateMessageContent(t,a);const i=o+1;i<r(this,s,w).length&&r(this,c).removeMessageItemsFrom(i),this.adapter.sendMessage(this.getMessages())};Ft=function(e){if(!this.adapter)return;const t=e.detail.messageId,a=r(this,s,w).findIndex(o=>o.type==="assistant"&&o.data.id===t);a!==-1&&(r(this,c).removeMessageItemsFrom(a),this.adapter.sendMessage(this.getMessages()))};G=function(e,t){r(this,c).setResponseFeedback(e.detail.messageId,{type:t,reason:e.detail.feedback}),n(this,s,b).call(this,{type:"forge-ai-chatbot-response-feedback",detail:{messageId:e.detail.messageId,type:t,feedback:e.detail.feedback}})};Ut=function(e){n(this,s,G).call(this,e,"positive")};Bt=function(e){n(this,s,G).call(this,e,"negative")};V=function(e,t){const a=k();r(this,f).addAttachment(a,{filename:e.name,size:e.size,mimeType:e.type,timestamp:t});const o=n(this,s,Ot).call(this,a);this.adapter?.emitFileUpload(e,o),n(this,s,b).call(this,{type:"forge-ai-chatbot-file-select",detail:{fileId:a,file:e,filename:e.name,size:e.size,mimeType:e.type,timestamp:t,...o}})};Pt=function(e){const{file:t,timestamp:a}=e.detail;n(this,s,V).call(this,t,a)};Ot=function(e){return{updateProgress:t=>{r(this,f).updateProgress(e,t)},markComplete:t=>{r(this,f).markComplete(e,t)},markError:t=>{r(this,f).markError(e,t)},onAbort:t=>{r(this,f).registerOnAbort(e,t)}}};Wt=function(e){const t={id:k(),role:"assistant",content:e.detail.message,timestamp:Date.now(),status:"error"};r(this,c).addMessage(t)};qt=function(e){const{filename:t}=e.detail,a=r(this,f).pendingAttachments.find(i=>i.filename===t);if(a){r(this,f).abort(a.id);return}const o=r(this,f).completedAttachments.find(i=>i.filename===t);o&&o.fileId&&(r(this,f).removeCompletedAttachment(o.id),this.requestUpdate(),this.adapter?.emitFileRemove(o.fileId,{onSuccess:()=>{},onError:i=>{console.error(`Failed to remove file ${t}:`,i)}}))};Nt=async function(e){r(this,x).value?.addToHistory(e.detail.text),await this.sendMessage(e.detail.text),r(this,x).value?.focus()};Ht=function(e){const{transcript:t}=e.detail;t&&r(this,x).value&&(r(this,x).value.value=t)};jt=function(){n(this,s,b).call(this,{type:"forge-ai-chatbot-expand"})};Lt=function(){n(this,s,b).call(this,{type:"forge-ai-chatbot-minimize"})};Z=function(){n(this,s,b).call(this,{type:"forge-ai-chatbot-clear",cancelable:!0}).defaultPrevented||this.clearMessages()};K=function(){const e=r(this,B).value;e?.showAgentInfo&&e.showAgentInfo(),n(this,s,b).call(this,{type:"forge-ai-chatbot-info"})};Yt=function(e){const{agent:t,previousAgentId:a}=e.detail;n(this,s,b).call(this,{type:"forge-ai-chatbot-agent-change",detail:{agent:t,previousAgentId:a}}).defaultPrevented||(this.selectedAgentId=t?.id,this.adapter&&(this.adapter.threadId=k()))};Q=function(){this.debugMode=!this.debugMode};Jt=function(e){switch(e.detail.commandId){case"clear":n(this,s,Z).call(this);break;case"export":n(this,s,X).call(this);break;case"info":n(this,s,K).call(this);break;case"debug":n(this,s,Q).call(this);break}};Gt=function(e){const t=[`  Tool: ${e.name}`,`  Args: ${JSON.stringify(e.args)}`];if(e.status==="error"){const a=typeof e.result=="object"&&e.result!==null&&"error"in e.result?e.result.error:"Unknown error";t.push(`  Error: ${a}`)}else e.result!==void 0&&t.push(`  Result: ${JSON.stringify(e.result)}`);return t.join(`
`)};X=function(){const e=this.getMessages();if(e.length===0)return;const t=e.map(o=>{const i=new Date(o.timestamp).toLocaleString(),d=o.role==="user"?"You":"Assistant";let l=`[${i}] ${d}:
${o.content}
`;return o.toolCalls?.length&&(l+=`
`+o.toolCalls.map(p=>n(this,s,Gt).call(this,p)).join(`

`)+`
`),l}).join(`
`),a=`chat-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`;te(t,a,"text/plain")};Vt=function(){const e=r(this,f).completedAttachments,a=[...r(this,f).pendingAttachments,...e];return a.length===0?st:y`
      <div class="session-files" slot="attachments">
        <div class="session-files-header">Session Files (${a.length})</div>
        <div class="session-files-list">
          ${a.map(o=>y`
              <forge-ai-attachment
                .filename=${o.filename}
                .size=${o.size}
                ?uploading=${o.uploading??!1}
                removable
                @forge-ai-attachment-remove=${n(this,s,qt)}>
              </forge-ai-attachment>
            `)}
        </div>
      </div>
    `};Zt=function(){return r(this,m)?y`
      <forge-ai-confirmation-prompt
        slot="confirmation"
        .text=${r(this,m).displayText}
        @forge-ai-confirmation-prompt-confirm=${n(this,s,Rt)}
        @forge-ai-confirmation-prompt-deny=${n(this,s,Et)}>
      </forge-ai-confirmation-prompt>
    `:st};Kt=function(){const e=r(this,s,gt),t=e||r(this,s,ut);return y`
      <forge-ai-prompt
        ${U(r(this,x))}
        slot="prompt"
        .placeholder=${this.placeholder}
        .running=${r(this,s,R)||e}
        .slashCommands=${r(this,s,ht)}
        ?disabled=${t}
        ?debug-mode=${this.debugMode}
        @forge-ai-prompt-send=${n(this,s,$t)}
        @forge-ai-prompt-stop=${n(this,s,O)}
        @forge-ai-prompt-cancel=${n(this,s,Tt)}
        @forge-ai-prompt-debug-toggle=${n(this,s,Q)}
        @forge-ai-prompt-command=${n(this,s,Jt)}>
        ${W(this.fileUpload==="on",()=>y`
            <forge-ai-file-picker
              slot="actions"
              variant="icon-button"
              multiple
              ?disabled=${e}
              .selectedFiles=${r(this,f).pendingAttachments.map(a=>a.filename)}
              @forge-ai-file-picker-change=${n(this,s,Pt)}
              @forge-ai-file-picker-error=${n(this,s,Wt)}>
            </forge-ai-file-picker>
          `)}
        ${W(this.voiceInput==="on",()=>y`
            <forge-ai-voice-input slot="actions" @forge-ai-voice-input-result=${n(this,s,Ht)}>
            </forge-ai-voice-input>
          `)}
      </forge-ai-prompt>
    `};Qt=function(){return y`
      <forge-ai-message-thread
        ${U(r(this,A))}
        .messageItems=${r(this,s,ft)}
        .tools=${r(this,s,M)}
        ?enable-reactions=${this.enableReactions}
        ?show-thinking=${r(this,s,R)}
        ?debug-mode=${this.debugMode}
        @forge-ai-message-thread-copy=${n(this,s,At)}
        @forge-ai-message-thread-resend=${n(this,s,Ft)}
        @forge-ai-message-thread-thumbs-up=${n(this,s,Ut)}
        @forge-ai-message-thread-thumbs-down=${n(this,s,Bt)}
        @forge-ai-message-thread-user-copy=${n(this,s,zt)}
        @forge-ai-message-thread-user-resend=${n(this,s,St)}
        @forge-ai-message-thread-user-edit=${n(this,s,Dt)}>
        <slot name="empty-state-heading" slot="empty-state-heading"></slot>
        <slot name="empty-state-message" slot="empty-state-message"></slot>
        <forge-ai-suggestions
          slot="empty-state-actions"
          variant="block"
          .suggestions=${this.suggestions??[]}
          @forge-ai-suggestions-select=${n(this,s,Nt)}>
        </forge-ai-suggestions>
      </forge-ai-message-thread>
    `};b=function(e){const t=new CustomEvent(e.type,{detail:e.detail,bubbles:!0,composed:!0,cancelable:e.cancelable??!1});return this.dispatchEvent(t),t};S=function(e,t){const a=typeof t=="string"?r(this,c).getMessage(t):t;a&&n(this,s,b).call(this,{type:e,detail:{message:a}})};u.styles=at(de);g([h({attribute:!1})],u.prototype,"adapter",2);g([h({attribute:"file-upload"})],u.prototype,"fileUpload",2);g([h({attribute:"voice-input"})],u.prototype,"voiceInput",2);g([h({attribute:"debug-command"})],u.prototype,"debugCommand",2);g([h()],u.prototype,"placeholder",2);g([h({attribute:!1})],u.prototype,"suggestions",2);g([h({type:Boolean,attribute:"show-expand-button"})],u.prototype,"showExpandButton",2);g([h({type:Boolean,attribute:"show-minimize-button"})],u.prototype,"showMinimizeButton",2);g([h({type:Boolean})],u.prototype,"expanded",2);g([h({attribute:"minimize-icon"})],u.prototype,"minimizeIcon",2);g([h({type:Boolean,attribute:"enable-reactions"})],u.prototype,"enableReactions",2);g([h({type:Object,attribute:!1})],u.prototype,"agentInfo",2);g([h({attribute:"title-text"})],u.prototype,"titleText",2);g([h({attribute:"heading-level",type:Number})],u.prototype,"headingLevel",2);g([h({type:Boolean,attribute:"debug-mode"})],u.prototype,"debugMode",2);g([h({attribute:"disclaimer-text"})],u.prototype,"disclaimerText",2);g([h({attribute:!1})],u.prototype,"agents",2);g([h({attribute:"selected-agent-id"})],u.prototype,"selectedAgentId",2);u=g([rt(ue)],u);
