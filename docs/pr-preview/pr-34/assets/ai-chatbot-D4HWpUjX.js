import{r as Fe,i as De,x as v,E as Ue}from"./iframe-DRsxbJNB.js";import{t as Be}from"./custom-element-UsVr97OX.js";import{n as m}from"./property-qDaXtDqy.js";import{n as A,e as E}from"./ref-BwyghMc-.js";import{n as D}from"./when-CI7b_ccM.js";import{S as We}from"./mock-adapter-CGsAFG5D.js";import{g as k,d as He}from"./utils-B0W8KtS_.js";import"./ai-attachment-vVg3N8Im.js";import"./ai-chat-header-BT421IfC.js";import"./ai-chat-interface-CpGhMhlk.js";import"./ai-file-picker-lmPf-hCs.js";import"./ai-message-thread-DZQ_UdKb.js";import"./ai-prompt-DB5y7RAQ.js";import"./ai-spinner-l889ZGM9.js";import"./ai-suggestions-BAteF82d.js";import"./ai-voice-input-CjLCpqVm.js";class Pe{constructor(e){this._attachments=new Map,this._abortCallbacks=new Map,this._config=e}get pendingAttachments(){return Array.from(this._attachments.values()).filter(e=>e.status==="pending"||e.status==="uploading").map(e=>e.metadata)}get completedAttachments(){return Array.from(this._attachments.values()).filter(e=>e.status==="complete").map(e=>e.metadata)}get allAttachments(){return Array.from(this._attachments.values()).map(e=>e.metadata)}get isUploading(){return Array.from(this._attachments.values()).some(e=>e.status==="uploading")}updateConfig(e){this._config={...this._config,...e}}addAttachment(e,a){const s={id:e,status:"pending",...a};this._attachments.set(e,{id:e,metadata:s,status:"pending"}),this._config.onStateChange?.()}removeAttachment(e){this._attachments.delete(e),this._abortCallbacks.delete(e),this._config.onStateChange?.()}removeCompletedAttachment(e){this._attachments.get(e)?.status==="complete"&&(this._attachments.delete(e),this._config.onStateChange?.())}updateProgress(e,a){const s=this._attachments.get(e);s&&(s.status="uploading",s.metadata.uploading=!0,s.metadata.progress=a,s.metadata.status="uploading",this._config.onStateChange?.())}markComplete(e,a){const s=this._attachments.get(e);s&&(s.status="complete",s.uploadedFile=a,s.metadata.uploading=!1,s.metadata.progress=100,s.metadata.status="success",s.metadata.fileId=a.fileId,this._config.onStateChange?.())}markError(e,a){const s=this._attachments.get(e);s&&(s.status="error",s.errorMessage=a,s.metadata.uploading=!1,s.metadata.status="error",s.metadata.error=a,console.error(`File upload error for ${s.metadata.filename}: ${a}`),this._config.onError?.(a),this.removeAttachment(e))}registerOnAbort(e,a){this._abortCallbacks.set(e,a)}abort(e){const a=this._abortCallbacks.get(e);a&&a(),this.removeAttachment(e)}canSend(){return!Array.from(this._attachments.values()).some(e=>e.status==="uploading")}getCompletedUploads(){return Array.from(this._attachments.values()).filter(e=>e.status==="complete"&&e.uploadedFile).map(e=>e.uploadedFile)}clear(){this._attachments.clear(),this._abortCallbacks.clear(),this._config.onStateChange?.()}}class qe{constructor(e,a){this._host=e,this._config=a,this._messageItems=[],this._toolCalls=new Map,this._activeResponse=null,e.addController(this)}hostConnected(){}hostDisconnected(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null}updateConfig(e){this._config={...this._config,...e}}get messageItems(){return this._messageItems}getToolCall(e){return this._toolCalls.get(e)}getActiveResponse(){return this._activeResponse}startResponse(){if(this._activeResponse)return this._activeResponse;const e={id:k(),children:[],status:"streaming",timestamp:Date.now()};return this._activeResponse=e,this._messageItems=[...this._messageItems,{type:"assistant",data:e}],this.#e(),e}addTextToResponse(e,a,s){const n=this._activeResponse??this.startResponse(),c=n.children.findIndex(l=>l.type==="text"&&l.messageId===e);if(c>=0){const l=n.children[c];l.type==="text"&&(l.content=a)}else n.children.push({type:"text",messageId:e,content:a,status:"streaming"});s&&this.#t({type:"message-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#e()}appendTextDelta(e,a,s){const n=this._activeResponse??this.startResponse(),c=n.children.find(l=>l.type==="text"&&l.messageId===e);c&&c.type==="text"?c.content+=a:n.children.push({type:"text",messageId:e,content:a,status:"streaming"}),s&&this.#t({type:"message-delta",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#e()}markTextComplete(e,a){if(!this._activeResponse)return;const s=this._activeResponse.children.find(n=>n.type==="text"&&n.messageId===e);s&&s.type==="text"&&(s.status="complete"),a&&this.#t({type:"message-end",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#e()}addToolCallToResponse(e,a){const s=this._activeResponse??this.startResponse();if(this._toolCalls.set(e.id,e),s.children.push({type:"toolCall",data:e}),a){const n={type:"tool-call-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent};this.#t(n),this.#a(e.id,n)}this.#s(),this.#e()}updateToolCallInResponse(e,a,s){const n=this._toolCalls.get(e);if(!n)return;const c={...n,...a};if(this._toolCalls.set(e,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===e){l.data=c;break}}if(s)if(s.eventType==="tool-call-args"){const l=s.event,u={type:"tool-call-args",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#t(u),this.#a(e,u)}else{const l=s.event,u={type:"tool-call-end",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#t(u),this.#a(e,u)}this.#s(),this.#e()}completeToolCallInResponse(e,a,s){if(this.updateToolCallInResponse(e,{result:a,status:"complete"}),s){const n={type:"tool-result",timestamp:Date.now(),data:s,rawEvent:s.rawEvent};this.#t(n),this.#a(e,n)}}completeResponse(){this._activeResponse&&(this._activeResponse.status="complete",this.#s(),this._activeResponse=null,this.#e())}#s(){const e=this._activeResponse;e&&(this._messageItems=this._messageItems.map(a=>a.type==="assistant"&&a.data.id===e.id?{type:"assistant",data:{...e}}:a))}#t(e){this._activeResponse&&(this._activeResponse.eventStream=[...this._activeResponse.eventStream||[],e])}#a(e,a){const s=this._toolCalls.get(e);if(!s)return;const n=[...s.eventStream||[],a],c={...s,eventStream:n};if(this._toolCalls.set(e,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===e){l.data=c;break}}}#e(){this._host.requestUpdate()}addMessageItem(e){this._messageItems=[...this._messageItems,e],this.#e()}addMessage(e,a){this.getMessage(e.id)||(this.addMessageItem({type:"message",data:e}),a&&this.#i(e.id,{type:"message-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}))}getMessage(e){const a=this._messageItems.find(s=>s.type==="message"&&s.data.id===e);return a?.type==="message"?a.data:void 0}updateMessageStatus(e,a,s){this._messageItems=this._messageItems.map(n=>n.type==="message"&&n.data.id===e?{...n,data:{...n.data,status:a}}:n),s&&this.#i(e,{type:"message-end",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#e()}updateMessageContent(e,a){this._messageItems=this._messageItems.map(s=>s.type==="message"&&s.data.id===e?{...s,data:{...s.data,content:a}}:s),this.#e()}removeMessageItem(e){this._messageItems=this._messageItems.filter((a,s)=>s!==e),this.#e()}clearMessages(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null,this.#e()}removeMessageItemsFrom(e){this._messageItems=this._messageItems.slice(0,e),this._activeResponse=null,this.#e()}getMessages(){const e=[];for(const a of this._messageItems)if(a.type==="message")e.push({...a.data,toolCalls:[]});else if(a.type==="assistant"){const s=a.data,n=s.children.filter(u=>u.type==="text").map(u=>u.content).join(""),c=s.children.filter(u=>u.type==="toolCall").map(u=>u.data),l={id:s.id,role:"assistant",content:n,timestamp:s.timestamp,status:s.status==="streaming"?"streaming":s.status==="error"?"error":"complete",toolCalls:c.length?c:void 0,eventStream:s.eventStream,feedback:s.feedback,children:s.children};e.push(l)}else if(a.type==="toolCall"){const s=e[e.length-1];s&&s.role==="assistant"&&(s.toolCalls=[...s.toolCalls||[],a.data])}return e}setMessages(e){const a=[];this._toolCalls.clear(),this._activeResponse=null;for(const s of e)if(s.role==="assistant"&&s.status!=="error"){let n;if(s.children?.length)n=s.children.map(l=>(l.type==="toolCall"&&this._toolCalls.set(l.data.id,l.data),l));else if(n=[],s.content?.trim()&&n.push({type:"text",messageId:s.id,content:s.content,status:"complete"}),s.toolCalls)for(const l of s.toolCalls)n.push({type:"toolCall",data:l}),this._toolCalls.set(l.id,l);const c={id:s.id,children:n,status:s.status==="streaming"?"streaming":"complete",timestamp:s.timestamp,eventStream:s.eventStream,feedback:s.feedback};a.push({type:"assistant",data:c})}else a.push({type:"message",data:{...s,toolCalls:void 0}});this._messageItems=a,this.#e()}setResponseFeedback(e,a){const s=this._messageItems.find(n=>n.type==="assistant"&&n.data.id===e);s?.type==="assistant"&&(s.data.feedback=a,this.#e())}#i(e,a){this._messageItems.some(n=>n.type==="message"&&n.data.id===e)&&(this._messageItems=this._messageItems.map(n=>{if(n.type==="message"&&n.data.id===e){const c=[...n.data.eventStream||[],a];return{...n,data:{...n.data,eventStream:c}}}return n}),this.#e())}}const Oe=':host{display:block;width:100%;height:100%}forge-ai-chat-interface::part(messages){overflow:hidden}forge-ai-chat-interface forge-ai-message-thread{min-height:0}.session-files{display:flex;flex-direction:column;gap:var(--forge-spacing-xsmall, 8px);min-width:0}.session-files .session-files-header{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6))}.session-files .session-files-list::-webkit-scrollbar{height:var(--forge-scrollbar-height, 16px);width:var(--forge-scrollbar-width, 16px)}.session-files .session-files-list::-webkit-scrollbar-track{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-track:hover{background-color:var(--forge-scrollbar-track-container-hover, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-corner{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-thumb{height:var(--forge-scrollbar-thumb-min-height, 32px);width:var(--forge-scrollbar-thumb-min-width, 32px);border-radius:var(--forge-scrollbar-border-radius, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));border-width:var(--forge-scrollbar-border-width, 3px);border-style:solid;border-color:transparent;background-color:var(--forge-scrollbar-thumb-container, var(--forge-theme-surface-container-medium, #c2c2c2));background-clip:content-box}.session-files .session-files-list::-webkit-scrollbar-thumb:hover{background-color:var(--forge-scrollbar-thumb-container-hover, var(--forge-theme-surface-container-high, #9e9e9e))}.session-files .session-files-list{display:flex;gap:var(--forge-spacing-small, 12px);overflow-x:auto;padding-block-end:var(--forge-spacing-xsmall, 8px)}.disclaimer{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6));text-align:center;margin-block-start:var(--forge-spacing-xxsmall, 4px);margin-block-end:calc(var(--forge-spacing-small, 12px) * -1)}';var Le=Object.defineProperty,Ne=Object.getOwnPropertyDescriptor,K=t=>{throw TypeError(t)},g=(t,e,a,s)=>{for(var n=s>1?void 0:s?Ne(e,a):e,c=t.length-1,l;c>=0;c--)(l=t[c])&&(n=(s?l(e,a,n):l(n))||n);return s&&n&&Le(e,a,n),n},W=(t,e,a)=>e.has(t)||K("Cannot "+a),o=(t,e,a)=>(W(t,e,"read from private field"),a?a.call(t):e.get(t)),b=(t,e,a)=>e.has(t)?K("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,a),w=(t,e,a,s)=>(W(t,e,"write to private field"),e.set(t,a),a),r=(t,e,a)=>(W(t,e,"access private method"),a),J=(t,e,a,s)=>({set _(n){w(t,e,n)},get _(){return o(t,e,s)}}),U,R,y,S,h,p,C,I,M,i,Q,_,T,X,z,x,B,Z,ee,te,se,H,ae,ie,oe,P,ne,re,le,he,ce,de,q,O,pe,F,ge,me,fe,ue,be,ye,L,_e,ve,N,we,Ce,xe,Ie,Me,Te,ke,Re,j,G,$e,V,Ee,Y,Ae,Se,ze,f,$;const je="forge-ai-chatbot";let d=class extends De{constructor(){super(...arguments),b(this,i),this.fileUpload="off",this.voiceInput="on",this.debugCommand="on",this.placeholder="Ask a question...",this.showExpandButton=!1,this.showMinimizeButton=!1,this.expanded=!1,this.minimizeIcon="default",this.enableReactions=!1,this.titleText="AI Assistant",this.headingLevel=2,this.debugMode=!1,this.disclaimerText="AI can make mistakes. Always verify responses.",this.agents=[],b(this,U,E()),b(this,R,E()),b(this,y,E()),b(this,S,E()),b(this,h),b(this,p),b(this,C),b(this,I),b(this,M,0)}connectedCallback(){super.connectedCallback(),w(this,h,new qe(this,{tools:o(this,i,x)})),w(this,p,new Pe({onError:t=>{r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:t}})},onStateChange:()=>{this.requestUpdate()}})),this.adapter&&r(this,i,B).call(this)}disconnectedCallback(){super.disconnectedCallback(),o(this,I)?.unsubscribe(),this.adapter?.disconnect()}willUpdate(t){t.has("adapter")&&this.adapter&&(w(this,C,void 0),r(this,i,B).call(this))}clearMessages(){o(this,h).clearMessages(),o(this,p).clear()}getMessages(){return o(this,h).getMessages()}setMessages(t){o(this,h).setMessages(t)}getSelectedAgent(){return this.agents.find(t=>t.id===this.selectedAgentId)}async sendMessage(t,e){if(!this.adapter){console.warn("No adapter configured.");return}if(o(this,y).value?.closeSlashMenu(),e){const a=Date.now();for(const s of e)r(this,i,N).call(this,s,a)}await r(this,i,O).call(this,{content:t,attachments:o(this,p).pendingAttachments})}abort(){r(this,i,F).call(this)}async scrollToBottom({behavior:t}={}){await o(this,R).value?.updateComplete,await new Promise(requestAnimationFrame),o(this,R).value?.scrollToBottom({behavior:t})}getThreadState(){return{threadId:this.adapter?.threadId,messages:this.getMessages(),timestamp:Date.now()}}async setThreadState(t){this.setMessages(t.messages),t.threadId&&this.adapter&&(this.adapter.threadId=t.threadId),await this.updateComplete;const e=t.messages.filter(a=>a.role==="user").map(a=>a.content);o(this,y).value?.setHistory(e),this.scrollToBottom({behavior:"instant"})}render(){return v`
      <forge-ai-chat-interface
        ${A(o(this,U))}
        role="region"
        aria-label="AI chatbot"
        aria-live="polite"
        aria-busy=${o(this,i,T)}>
        <forge-ai-chat-header
          ${A(o(this,S))}
          slot="header"
          ?show-expand-button=${this.showExpandButton}
          ?show-minimize-button=${this.showMinimizeButton}
          ?expanded=${this.expanded}
          ?disable-agent-selector=${o(this,i,T)}
          export-option=${o(this,i,z)?"enabled":"off"}
          clear-option=${o(this,i,z)?"enabled":"off"}
          .minimizeIcon=${this.minimizeIcon}
          .agentInfo=${this.agentInfo}
          .headingLevel=${this.headingLevel}
          .titleText=${this.titleText}
          .agents=${this.agents}
          .selectedAgentId=${this.selectedAgentId}
          @forge-ai-chat-header-expand=${r(this,i,ke)}
          @forge-ai-chat-header-minimize=${r(this,i,Re)}
          @forge-ai-chat-header-clear=${r(this,i,j)}
          @forge-ai-chat-header-export=${r(this,i,Y)}
          @forge-ai-chat-header-info=${r(this,i,G)}
          @forge-ai-chat-header-agent-change=${r(this,i,$e)}>
        </forge-ai-chat-header>
        ${o(this,i,Ae)} ${o(this,i,ze)} ${o(this,i,Se)}
        ${D(this.disclaimerText,()=>v`<div class="disclaimer" slot="disclaimer">${this.disclaimerText}</div>`)}
      </forge-ai-chat-interface>
    `}};U=new WeakMap;R=new WeakMap;y=new WeakMap;S=new WeakMap;h=new WeakMap;p=new WeakMap;C=new WeakMap;I=new WeakMap;M=new WeakMap;i=new WeakSet;Q=function(){const t=[];return o(this,i,z)&&(t.push({id:"clear",name:"Clear",group:"Conversation"}),t.push({id:"export",name:"Export",group:"Conversation"})),t.push({id:"info",name:"Info",group:"Help"}),this.debugCommand==="on"&&t.push({id:"debug",name:`${this.debugMode?"Disable debug mode":"Enable debug mode"}`,group:"Help"}),t};_=function(){return o(this,h)?.messageItems??[]};T=function(){return(this.adapter?.isRunning??!1)||o(this,M)>0};X=function(){return o(this,p)?.isUploading??!1};z=function(){return o(this,i,_).length>0};x=function(){return o(this,C)||w(this,C,new Map(this.adapter?.getTools().map(t=>[t.name,t])??[])),o(this,C)};B=async function(){!this.adapter||this.adapter.isConnecting||(await this.adapter.connect(),o(this,I)?.unsubscribe(),w(this,I,new We),o(this,I).add(this.adapter.onMessageStart(r(this,i,Z).bind(this)),this.adapter.onMessageDelta(r(this,i,ee).bind(this)),this.adapter.onMessageEnd(r(this,i,te).bind(this)),this.adapter.onToolCallStart(r(this,i,ae).bind(this)),this.adapter.onToolCallArgs(r(this,i,ie).bind(this)),this.adapter.onToolCallEnd(r(this,i,oe).bind(this)),this.adapter.onToolCall(r(this,i,ne).bind(this)),this.adapter.onToolCallResult(r(this,i,de).bind(this)),this.adapter.onRunFinished(r(this,i,se).bind(this)),this.adapter.onRunAborted(r(this,i,he).bind(this)),this.adapter.onError(r(this,i,le).bind(this)),this.adapter.onStateChange(r(this,i,ce).bind(this))),w(this,C,void 0),o(this,h)?.updateConfig({tools:o(this,i,x)}),r(this,i,f).call(this,{type:"forge-ai-chatbot-connected"}))};Z=function(t){o(this,h).addTextToResponse(t.messageId,"",t)};ee=function(t){o(this,h).appendTextDelta(t.messageId,t.delta,t),this.scrollToBottom()};te=function(t){o(this,h).markTextComplete(t.messageId,t)};se=function(){r(this,i,H).call(this)};H=function(){if(o(this,M)>0||this.adapter?.isRunning)return;o(this,h).completeResponse();const t=this.getMessages(),e=t[t.length-1];e?.role==="assistant"&&e.status==="complete"&&r(this,i,$).call(this,"forge-ai-chatbot-message-received",e)};ae=function(t){const e={id:t.id,messageId:t.messageId,name:t.name,args:{},argsBuffer:"",status:"parsing",type:o(this,i,x).has(t.name)?"client":"agent"};o(this,h).addToolCallToResponse(e,t)};ie=function(t){const e={argsBuffer:t.argsBuffer,args:t.partialArgs??{}},a={eventType:"tool-call-args",event:t};o(this,h).updateToolCallInResponse(t.id,e,a),this.scrollToBottom()};oe=function(t){const e={args:t.args,argsBuffer:void 0,status:"executing"},a={eventType:"tool-call-end",event:t};o(this,h).updateToolCallInResponse(t.id,e,a)};P=function(t,e){return typeof e=="string"||e&&typeof e=="object"?e:`Tool '${t}' executed successfully`};ne=async function(t){let e=o(this,h).getToolCall(t.id);if(e?o(this,h).updateToolCallInResponse(t.id,{args:t.args,status:"executing"}):(e={id:t.id,messageId:t.messageId,name:t.name,args:t.args,status:"executing",type:o(this,i,x).has(t.name)?"client":"agent"},o(this,h).addToolCallToResponse(e)),e?.type==="client"){r(this,i,f).call(this,{type:"forge-ai-chatbot-tool-call",detail:{toolCallId:t.id,toolName:t.name,arguments:t.args}});const a=o(this,i,x).get(t.name);a?.handler?await Promise.resolve(r(this,i,re).call(this,t.id,t.name,a.handler,t.args)):r(this,i,q).call(this,t.id,r(this,i,P).call(this,t.name))}};re=async function(t,e,a,s){J(this,M)._++,this.requestUpdate();try{const c=await a({args:s,toolCallId:t,toolName:e,signal:void 0});await r(this,i,q).call(this,t,r(this,i,P).call(this,e,c))}catch(n){o(this,h).updateToolCallInResponse(t,{status:"error",result:{error:n.message}})}finally{J(this,M)._--,r(this,i,H).call(this),this.requestUpdate()}};le=function(t){const e={id:k(),role:"assistant",content:t.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(e),r(this,i,$).call(this,"forge-ai-chatbot-message-received",e),r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:t.message}})};he=function(){const t={id:k(),role:"system",content:"Run cancelled",timestamp:Date.now(),status:"complete"};o(this,h).addMessage(t),r(this,i,$).call(this,"forge-ai-chatbot-message-received",t)};ce=function(t){this.requestUpdate()};de=function(t){o(this,h).completeToolCallInResponse(t.toolCallId,t.result,t)};q=async function(t,e){!o(this,h).getToolCall(t)||!this.adapter||(o(this,h).completeToolCallInResponse(t,e),this.adapter.sendToolResult(t,e,this.getMessages()))};O=async function(t){if(!t.content.trim()||!this.adapter||o(this,i,T)){this.adapter||console.warn("No adapter configured.");return}if(!o(this,p).canSend())return;const e={id:k(),role:"user",content:t.content,timestamp:t.timestamp??Date.now(),status:"pending"};o(this,h).addMessage(e);try{this.adapter.sendMessage(this.getMessages()),o(this,h).updateMessageStatus(e.id,"complete")}catch(a){o(this,h).updateMessageStatus(e.id,"error");const s=a instanceof Error?a.message:"Failed to send message";r(this,i,f).call(this,{type:"forge-ai-chatbot-error",detail:{error:s}})}finally{r(this,i,$).call(this,"forge-ai-chatbot-message-sent",e.id)}};pe=async function(t){const e=[...o(this,p).pendingAttachments];await r(this,i,O).call(this,{content:t.detail.value,timestamp:t.detail.date.getTime(),attachments:e})};F=function(){this.adapter?.isRunning&&this.adapter.abort(),this.requestUpdate()};ge=function(){r(this,i,F).call(this)};me=async function(t){const e=t.detail.messageId,a=o(this,i,_).find(n=>n.type==="assistant"&&n.data.id===e);if(!a||a.type!=="assistant")return;const s=a.data.children.filter(n=>n.type==="text").map(n=>n.content).join(`

`);try{await navigator.clipboard.writeText(s)}catch{}};fe=async function(t){const e=t.detail.messageId,a=o(this,h).getMessage(e);if(!(!a||a.role!=="user"))try{await navigator.clipboard.writeText(a.content)}catch{}};ue=function(t){if(!this.adapter)return;const e=t.detail.messageId,a=o(this,i,_).findIndex(n=>n.type==="message"&&n.data.id===e);if(a===-1)return;const s=a+1;s<o(this,i,_).length&&o(this,h).removeMessageItemsFrom(s),this.adapter.sendMessage(this.getMessages())};be=function(t){if(!this.adapter)return;const{messageId:e,content:a}=t.detail,s=o(this,i,_).findIndex(c=>c.type==="message"&&c.data.id===e);if(s===-1)return;o(this,h).updateMessageContent(e,a);const n=s+1;n<o(this,i,_).length&&o(this,h).removeMessageItemsFrom(n),this.adapter.sendMessage(this.getMessages())};ye=function(t){if(!this.adapter)return;const e=t.detail.messageId,a=o(this,i,_).findIndex(s=>s.type==="assistant"&&s.data.id===e);a!==-1&&(o(this,h).removeMessageItemsFrom(a),this.adapter.sendMessage(this.getMessages()))};L=function(t,e){o(this,h).setResponseFeedback(t.detail.messageId,{type:e,reason:t.detail.feedback}),r(this,i,f).call(this,{type:"forge-ai-chatbot-response-feedback",detail:{messageId:t.detail.messageId,type:e,feedback:t.detail.feedback}})};_e=function(t){r(this,i,L).call(this,t,"positive")};ve=function(t){r(this,i,L).call(this,t,"negative")};N=function(t,e){const a=k();o(this,p).addAttachment(a,{filename:t.name,size:t.size,mimeType:t.type,timestamp:e});const s=r(this,i,Ce).call(this,a);this.adapter?.emitFileUpload(t,s),r(this,i,f).call(this,{type:"forge-ai-chatbot-file-select",detail:{fileId:a,file:t,filename:t.name,size:t.size,mimeType:t.type,timestamp:e,...s}})};we=function(t){const{file:e,timestamp:a}=t.detail;r(this,i,N).call(this,e,a)};Ce=function(t){return{updateProgress:e=>{o(this,p).updateProgress(t,e)},markComplete:e=>{o(this,p).markComplete(t,e)},markError:e=>{o(this,p).markError(t,e)},onAbort:e=>{o(this,p).registerOnAbort(t,e)}}};xe=function(t){const e={id:k(),role:"assistant",content:t.detail.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(e)};Ie=function(t){const{filename:e}=t.detail,a=o(this,p).pendingAttachments.find(n=>n.filename===e);if(a){o(this,p).abort(a.id);return}const s=o(this,p).completedAttachments.find(n=>n.filename===e);s&&s.fileId&&(o(this,p).removeCompletedAttachment(s.id),this.requestUpdate(),this.adapter?.emitFileRemove(s.fileId,{onSuccess:()=>{},onError:n=>{console.error(`Failed to remove file ${e}:`,n)}}))};Me=async function(t){o(this,y).value?.addToHistory(t.detail.text),await this.sendMessage(t.detail.text),o(this,y).value?.focus()};Te=function(t){const{transcript:e}=t.detail;e&&o(this,y).value&&(o(this,y).value.value=e)};ke=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-expand"})};Re=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-minimize"})};j=function(){r(this,i,f).call(this,{type:"forge-ai-chatbot-clear",cancelable:!0}).defaultPrevented||this.clearMessages()};G=function(){const t=o(this,S).value;t?.showAgentInfo&&t.showAgentInfo(),r(this,i,f).call(this,{type:"forge-ai-chatbot-info"})};$e=function(t){const{agent:e,previousAgentId:a}=t.detail;r(this,i,f).call(this,{type:"forge-ai-chatbot-agent-change",detail:{agent:e,previousAgentId:a}}).defaultPrevented||(this.selectedAgentId=e?.id,this.clearMessages())};V=function(){this.debugMode=!this.debugMode};Ee=function(t){switch(t.detail.commandId){case"clear":r(this,i,j).call(this);break;case"export":r(this,i,Y).call(this);break;case"info":r(this,i,G).call(this);break;case"debug":r(this,i,V).call(this);break}};Y=function(){const t=this.getMessages();if(t.length===0)return;const e=t.map(s=>{const n=new Date(s.timestamp).toLocaleString(),c=s.role==="user"?"You":"Assistant";return`[${n}] ${c}:
${s.content}
`}).join(`
`),a=`chat-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`;He(e,a,"text/plain")};Ae=function(){const t=o(this,p).completedAttachments,a=[...o(this,p).pendingAttachments,...t];return a.length===0?Ue:v`
      <div class="session-files" slot="attachments">
        <div class="session-files-header">Session Files (${a.length})</div>
        <div class="session-files-list">
          ${a.map(s=>v`
              <forge-ai-attachment
                .filename=${s.filename}
                .size=${s.size}
                ?uploading=${s.uploading??!1}
                removable
                @forge-ai-attachment-remove=${r(this,i,Ie)}>
              </forge-ai-attachment>
            `)}
        </div>
      </div>
    `};Se=function(){const t=o(this,i,X);return v`
      <forge-ai-prompt
        ${A(o(this,y))}
        slot="prompt"
        .placeholder=${this.placeholder}
        .running=${o(this,i,T)||t}
        .slashCommands=${o(this,i,Q)}
        ?disabled=${t}
        ?debug-mode=${this.debugMode}
        @forge-ai-prompt-send=${r(this,i,pe)}
        @forge-ai-prompt-stop=${r(this,i,F)}
        @forge-ai-prompt-cancel=${r(this,i,ge)}
        @forge-ai-prompt-debug-toggle=${r(this,i,V)}
        @forge-ai-prompt-command=${r(this,i,Ee)}>
        ${D(this.fileUpload==="on",()=>v`
            <forge-ai-file-picker
              slot="actions"
              variant="icon-button"
              multiple
              ?disabled=${t}
              .selectedFiles=${o(this,p).pendingAttachments.map(e=>e.filename)}
              @forge-ai-file-picker-change=${r(this,i,we)}
              @forge-ai-file-picker-error=${r(this,i,xe)}>
            </forge-ai-file-picker>
          `)}
        ${D(this.voiceInput==="on",()=>v`
            <forge-ai-voice-input slot="actions" @forge-ai-voice-input-result=${r(this,i,Te)}>
            </forge-ai-voice-input>
          `)}
      </forge-ai-prompt>
    `};ze=function(){return v`
      <forge-ai-message-thread
        ${A(o(this,R))}
        .messageItems=${o(this,i,_)}
        .tools=${o(this,i,x)}
        ?enable-reactions=${this.enableReactions}
        ?show-thinking=${o(this,i,T)}
        ?debug-mode=${this.debugMode}
        @forge-ai-message-thread-copy=${r(this,i,me)}
        @forge-ai-message-thread-refresh=${r(this,i,ye)}
        @forge-ai-message-thread-thumbs-up=${r(this,i,_e)}
        @forge-ai-message-thread-thumbs-down=${r(this,i,ve)}
        @forge-ai-message-thread-user-copy=${r(this,i,fe)}
        @forge-ai-message-thread-user-resend=${r(this,i,ue)}
        @forge-ai-message-thread-user-edit=${r(this,i,be)}>
        <slot name="empty-state-heading" slot="empty-state-heading"></slot>
        <slot name="empty-state-message" slot="empty-state-message"></slot>
        <forge-ai-suggestions
          slot="empty-state-actions"
          variant="block"
          .suggestions=${this.suggestions??[]}
          @forge-ai-suggestions-select=${r(this,i,Me)}>
        </forge-ai-suggestions>
      </forge-ai-message-thread>
    `};f=function(t){const e=new CustomEvent(t.type,{detail:t.detail,bubbles:!0,composed:!0,cancelable:t.cancelable??!1});return this.dispatchEvent(e),e};$=function(t,e){const a=typeof e=="string"?o(this,h).getMessage(e):e;a&&r(this,i,f).call(this,{type:t,detail:{message:a}})};d.styles=Fe(Oe);g([m({attribute:!1})],d.prototype,"adapter",2);g([m({attribute:"file-upload"})],d.prototype,"fileUpload",2);g([m({attribute:"voice-input"})],d.prototype,"voiceInput",2);g([m({attribute:"debug-command"})],d.prototype,"debugCommand",2);g([m()],d.prototype,"placeholder",2);g([m({attribute:!1})],d.prototype,"suggestions",2);g([m({type:Boolean,attribute:"show-expand-button"})],d.prototype,"showExpandButton",2);g([m({type:Boolean,attribute:"show-minimize-button"})],d.prototype,"showMinimizeButton",2);g([m({type:Boolean})],d.prototype,"expanded",2);g([m({attribute:"minimize-icon"})],d.prototype,"minimizeIcon",2);g([m({type:Boolean,attribute:"enable-reactions"})],d.prototype,"enableReactions",2);g([m({type:Object,attribute:!1})],d.prototype,"agentInfo",2);g([m({attribute:"title-text"})],d.prototype,"titleText",2);g([m({attribute:"heading-level",type:Number})],d.prototype,"headingLevel",2);g([m({type:Boolean,attribute:"debug-mode"})],d.prototype,"debugMode",2);g([m({attribute:"disclaimer-text"})],d.prototype,"disclaimerText",2);g([m({attribute:!1})],d.prototype,"agents",2);g([m({attribute:"selected-agent-id"})],d.prototype,"selectedAgentId",2);d=g([Be(je)],d);
