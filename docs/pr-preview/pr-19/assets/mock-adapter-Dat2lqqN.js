import{g as l}from"./utils-C_XXmvvR.js";class i{#e=[];subscribe(e){return this.#e.push(e),{unsubscribe:()=>{const t=this.#e.indexOf(e);t>-1&&this.#e.splice(t,1)}}}emit(e){const t=[...this.#e];for(const s of t)try{s(e)}catch(n){console.error("Error in event listener:",n)}}clear(){this.#e=[]}get listenerCount(){return this.#e.length}}class g{#e=[];#t=!1;add(...e){if(this.#t){for(const t of e)t.unsubscribe();return}this.#e.push(...e)}unsubscribe(){if(!this.#t){this.#t=!0;for(const e of this.#e)try{e.unsubscribe()}catch(t){console.error("Error unsubscribing:",t)}this.#e=[]}}get isUnsubscribed(){return this.#t}}class m{constructor(){this._state={isConnected:!1,isConnecting:!1,isRunning:!1},this._tools=[],this._events={runStarted:new i,runFinished:new i,runAborted:new i,messageStart:new i,messageDelta:new i,messageEnd:new i,toolCall:new i,toolCallStart:new i,toolCallArgs:new i,toolCallEnd:new i,toolResult:new i,fileUpload:new i,fileRemove:new i,error:new i,stateChange:new i}}setTools(e){this._tools=e}getTools(){return[...this._tools]}getState(){return{...this._state}}get isConnected(){return this._state.isConnected}get isConnecting(){return this._state.isConnecting}get isRunning(){return this._state.isRunning}onRunStarted(e){return this._events.runStarted.subscribe(e)}onRunFinished(e){return this._events.runFinished.subscribe(e)}onRunAborted(e){return this._events.runAborted.subscribe(e)}onMessageStart(e){return this._events.messageStart.subscribe(e)}onMessageDelta(e){return this._events.messageDelta.subscribe(e)}onMessageEnd(e){return this._events.messageEnd.subscribe(e)}onToolCall(e){return this._events.toolCall.subscribe(e)}onToolCallStart(e){return this._events.toolCallStart.subscribe(e)}onToolCallArgs(e){return this._events.toolCallArgs.subscribe(e)}onToolCallEnd(e){return this._events.toolCallEnd.subscribe(e)}onToolCallResult(e){return this._events.toolResult.subscribe(e)}onFileUpload(e){return this._events.fileUpload.subscribe(e)}onFileRemove(e){return this._events.fileRemove.subscribe(e)}onError(e){return this._events.error.subscribe(e)}onStateChange(e){return this._events.stateChange.subscribe(e)}_emitRunStarted(){this._events.runStarted.emit()}_emitRunFinished(){this._events.runFinished.emit()}_emitRunAborted(){this._events.runAborted.emit()}_emitMessageStart(e,t){this._events.messageStart.emit({messageId:e,rawEvent:t})}_emitMessageDelta(e,t,s){this._events.messageDelta.emit({messageId:e,delta:t,rawEvent:s})}_emitMessageEnd(e,t){this._events.messageEnd.emit({messageId:e,rawEvent:t})}_emitToolCall(e,t){this._events.toolCall.emit({...e,rawEvent:t})}_emitToolCallStart(e,t){this._events.toolCallStart.emit({...e,rawEvent:t})}_emitToolCallArgs(e,t){this._events.toolCallArgs.emit({...e,rawEvent:t})}_emitToolCallEnd(e,t){this._events.toolCallEnd.emit({...e,rawEvent:t})}_emitToolResult(e,t){this._events.toolResult.emit({...e,rawEvent:t})}emitFileUpload(e,t){this._events.fileUpload.emit({file:e,...t})}emitFileRemove(e,t){this._events.fileRemove.emit({fileId:e,...t})}_emitError(e){this._events.error.emit({message:e})}_updateState(e){this._state={...this._state,...e},this._events.stateChange.emit(this.getState())}}class d extends m{#e;#t=0;#s=null;get threadId(){return"mock-thread-123"}set threadId(e){}constructor(e={}){super(),this.#e={simulateTools:!1,simulateStreaming:!0,streamingDelay:50,responseDelay:500,mockResponses:["Hello! How can I assist you today?","That's a great question! Let me help you with that.",`I understand. Here's what I can do:

1. Answer questions
2. Help with tasks
3. Provide information

What would you like to do?`,"Here's some code:\n\n```typescript\nfunction greet(name: string) {\n  return `Hello, ${name}!`;\n}\n```\n\nThis is a simple greeting function."],...e},e.tools&&this.setTools(e.tools)}async connect(){this._updateState({isConnected:!0})}async disconnect(){this.abort(),this._updateState({isConnected:!1})}sendMessage(e,t){this._updateState({isRunning:!0});const s=l("msg"),n=this.#e.mockResponses[this.#t%this.#e.mockResponses.length];this.#t++;const o=e[e.length-1],u=o?.role==="tool";if(this.#e.simulateTools&&this._tools.length>0&&!u){const r=o?.content?.toLowerCase()||"",h=r.includes("ask me")||r.includes("prompt me")||r.includes("get user input")||r.includes("get my input");this._emitMessageStart(s),h?this.#o(s):this.#n(s)}else u?this.#i(`Based on the tool result, ${n}`,s):this.#i(n,s)}sendToolResult(e,t,s){this.sendMessage(s)}abort(){this.#s!==null&&(clearTimeout(this.#s),this.#s=null),this._updateState({isRunning:!1})}#i(e,t){if(this._emitMessageStart(t),this.#e.simulateStreaming){const s=e.split(" ");s.forEach((n,o)=>{this.#s=window.setTimeout(()=>{this._emitMessageDelta(t,(o===0?"":" ")+n),o===s.length-1&&setTimeout(()=>{this._emitMessageEnd(t),this._updateState({isRunning:!1})},this.#e.streamingDelay)},this.#e.responseDelay+o*this.#e.streamingDelay)})}else setTimeout(()=>{this._emitMessageDelta(t,e),setTimeout(()=>{this._emitMessageEnd(t),this._updateState({isRunning:!1})},this.#e.streamingDelay)},this.#e.responseDelay)}#n(e){const t=l("tool"),s="getCurrentWeather";setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{this._emitToolCall({id:t,messageId:e,name:s,args:{location:"San Francisco"}}),setTimeout(()=>{this._emitMessageEnd(e),this._updateState({isRunning:!1})},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.responseDelay)}#o(e){const t=l("tool"),s="getUserInput";setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{this._emitToolCall({id:t,messageId:e,name:s,args:{prompt:"What is your name?"}}),setTimeout(()=>{this._emitMessageEnd(e),this._updateState({isRunning:!1})},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.streamingDelay)},this.#e.responseDelay)}}export{d as M,g as S};
