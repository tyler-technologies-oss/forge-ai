import{r as Et,i as St,x as _,E as At}from"./iframe-ZAkSFMu8.js";import{t as zt}from"./custom-element-UsVr97OX.js";import{n as m}from"./property-DFQ_Uq77.js";import{n as S,e as E}from"./ref-CEtDpJqE.js";import{n as F}from"./when-CI7b_ccM.js";import{S as Dt}from"./mock-adapter-DPRgB_9-.js";import{g as I,d as Ft}from"./utils-Dod8vlOP.js";import"./ai-attachment-Ctok9U7d.js";import"./ai-chat-header-t0jSpV_p.js";import"./ai-chat-interface-DlJ2aP38.js";import"./ai-file-picker-CTeCJryu.js";import"./ai-message-thread-grHbA8WF.js";import"./ai-prompt-Du-lvrA6.js";import"./ai-spinner-D9bA8YYJ.js";import"./ai-suggestions-B5gtu7Gn.js";import"./ai-voice-input-D50AMp6r.js";class Ut{constructor(t){this._attachments=new Map,this._abortCallbacks=new Map,this._config=t}get pendingAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="pending"||t.status==="uploading").map(t=>t.metadata)}get completedAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete").map(t=>t.metadata)}get allAttachments(){return Array.from(this._attachments.values()).map(t=>t.metadata)}get isUploading(){return Array.from(this._attachments.values()).some(t=>t.status==="uploading")}updateConfig(t){this._config={...this._config,...t}}addAttachment(t,s){const a={id:t,status:"pending",...s};this._attachments.set(t,{id:t,metadata:a,status:"pending"}),this._config.onStateChange?.()}removeAttachment(t){this._attachments.delete(t),this._abortCallbacks.delete(t),this._config.onStateChange?.()}removeCompletedAttachment(t){this._attachments.get(t)?.status==="complete"&&(this._attachments.delete(t),this._config.onStateChange?.())}updateProgress(t,s){const a=this._attachments.get(t);a&&(a.status="uploading",a.metadata.uploading=!0,a.metadata.progress=s,a.metadata.status="uploading",this._config.onStateChange?.())}markComplete(t,s){const a=this._attachments.get(t);a&&(a.status="complete",a.uploadedFile=s,a.metadata.uploading=!1,a.metadata.progress=100,a.metadata.status="success",a.metadata.fileId=s.fileId,this._config.onStateChange?.())}markError(t,s){const a=this._attachments.get(t);a&&(a.status="error",a.errorMessage=s,a.metadata.uploading=!1,a.metadata.status="error",a.metadata.error=s,console.error(`File upload error for ${a.metadata.filename}: ${s}`),this._config.onError?.(s),this.removeAttachment(t))}registerOnAbort(t,s){this._abortCallbacks.set(t,s)}abort(t){const s=this._abortCallbacks.get(t);s&&s(),this.removeAttachment(t)}canSend(){return!Array.from(this._attachments.values()).some(t=>t.status==="uploading")}getCompletedUploads(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete"&&t.uploadedFile).map(t=>t.uploadedFile)}clear(){this._attachments.clear(),this._abortCallbacks.clear(),this._config.onStateChange?.()}}class Bt{constructor(t,s){this._host=t,this._config=s,this._messageItems=[],this._toolCalls=new Map,this._activeResponse=null,t.addController(this)}hostConnected(){}hostDisconnected(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null}updateConfig(t){this._config={...this._config,...t}}get messageItems(){return this._messageItems}getToolCall(t){return this._toolCalls.get(t)}getActiveResponse(){return this._activeResponse}startResponse(){if(this._activeResponse)return this._activeResponse;const t={id:I(),children:[],status:"streaming",timestamp:Date.now()};return this._activeResponse=t,this._messageItems=[...this._messageItems,{type:"assistant",data:t}],this.#t(),t}addTextToResponse(t,s,a){const n=this._activeResponse??this.startResponse(),c=n.children.findIndex(l=>l.type==="text"&&l.messageId===t);if(c>=0){const l=n.children[c];l.type==="text"&&(l.content=s)}else n.children.push({type:"text",messageId:t,content:s,status:"streaming"});a&&this.#e({type:"message-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#t()}appendTextDelta(t,s,a){const n=this._activeResponse??this.startResponse(),c=n.children.find(l=>l.type==="text"&&l.messageId===t);c&&c.type==="text"?c.content+=s:n.children.push({type:"text",messageId:t,content:s,status:"streaming"}),a&&this.#e({type:"message-delta",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#t()}markTextComplete(t,s){if(!this._activeResponse)return;const a=this._activeResponse.children.find(n=>n.type==="text"&&n.messageId===t);a&&a.type==="text"&&(a.status="complete"),s&&this.#e({type:"message-end",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#t()}addToolCallToResponse(t,s){const a=this._activeResponse??this.startResponse();if(this._toolCalls.set(t.id,t),a.children.push({type:"toolCall",data:t}),s){const n={type:"tool-call-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent};this.#e(n),this.#a(t.id,n)}this.#s(),this.#t()}updateToolCallInResponse(t,s,a){const n=this._toolCalls.get(t);if(!n)return;const c={...n,...s};if(this._toolCalls.set(t,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=c;break}}if(a)if(a.eventType==="tool-call-args"){const l=a.event,f={type:"tool-call-args",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(f),this.#a(t,f)}else{const l=a.event,f={type:"tool-call-end",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(f),this.#a(t,f)}this.#s(),this.#t()}completeToolCallInResponse(t,s,a){if(this.updateToolCallInResponse(t,{result:s,status:"complete"}),a){const n={type:"tool-result",timestamp:Date.now(),data:a,rawEvent:a.rawEvent};this.#e(n),this.#a(t,n)}}completeResponse(){this._activeResponse&&(this._activeResponse.status="complete",this.#s(),this._activeResponse=null,this.#t())}#s(){const t=this._activeResponse;t&&(this._messageItems=this._messageItems.map(s=>s.type==="assistant"&&s.data.id===t.id?{type:"assistant",data:{...t}}:s))}#e(t){this._activeResponse&&(this._activeResponse.eventStream=[...this._activeResponse.eventStream||[],t])}#a(t,s){const a=this._toolCalls.get(t);if(!a)return;const n=[...a.eventStream||[],s],c={...a,eventStream:n};if(this._toolCalls.set(t,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=c;break}}}#t(){this._host.requestUpdate()}addMessageItem(t){this._messageItems=[...this._messageItems,t],this.#t()}addMessage(t,s){this.getMessage(t.id)||(this.addMessageItem({type:"message",data:t}),s&&this.#i(t.id,{type:"message-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}))}getMessage(t){const s=this._messageItems.find(a=>a.type==="message"&&a.data.id===t);return s?.type==="message"?s.data:void 0}updateMessageStatus(t,s,a){this._messageItems=this._messageItems.map(n=>n.type==="message"&&n.data.id===t?{...n,data:{...n.data,status:s}}:n),a&&this.#i(t,{type:"message-end",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#t()}removeMessageItem(t){this._messageItems=this._messageItems.filter((s,a)=>a!==t),this.#t()}clearMessages(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null,this.#t()}removeMessageItemsFrom(t){this._messageItems=this._messageItems.slice(0,t),this._activeResponse=null,this.#t()}getMessages(){const t=[];for(const s of this._messageItems)if(s.type==="message")t.push({...s.data,toolCalls:[]});else if(s.type==="assistant"){const a=s.data,n=a.children.filter(f=>f.type==="text").map(f=>f.content).join(""),c=a.children.filter(f=>f.type==="toolCall").map(f=>f.data),l={id:a.id,role:"assistant",content:n,timestamp:a.timestamp,status:a.status==="streaming"?"streaming":a.status==="error"?"error":"complete",toolCalls:c.length?c:void 0,eventStream:a.eventStream,feedback:a.feedback};t.push(l)}else if(s.type==="toolCall"){const a=t[t.length-1];a&&a.role==="assistant"&&(a.toolCalls=[...a.toolCalls||[],s.data])}return t}setMessages(t){const s=[];this._toolCalls.clear(),this._activeResponse=null;for(const a of t)if(a.role==="assistant"&&a.status!=="error"){const n=[];if(a.content?.trim()&&n.push({type:"text",messageId:a.id,content:a.content,status:"complete"}),a.toolCalls)for(const l of a.toolCalls)n.push({type:"toolCall",data:l}),this._toolCalls.set(l.id,l);const c={id:a.id,children:n,status:a.status==="streaming"?"streaming":"complete",timestamp:a.timestamp,eventStream:a.eventStream,feedback:a.feedback};s.push({type:"assistant",data:c})}else s.push({type:"message",data:{...a,toolCalls:void 0}});this._messageItems=s,this.#t()}setResponseFeedback(t,s){const a=this._messageItems.find(n=>n.type==="assistant"&&n.data.id===t);a?.type==="assistant"&&(a.data.feedback=s,this.#t())}#i(t,s){this._messageItems.some(n=>n.type==="message"&&n.data.id===t)&&(this._messageItems=this._messageItems.map(n=>{if(n.type==="message"&&n.data.id===t){const c=[...n.data.eventStream||[],s];return{...n,data:{...n.data,eventStream:c}}}return n}),this.#t())}}const Wt=':host{display:block;width:100%;height:100%}forge-ai-chat-interface::part(messages){overflow:hidden}forge-ai-chat-interface forge-ai-message-thread{min-height:0}.session-files{display:flex;flex-direction:column;gap:var(--forge-spacing-xsmall, 8px);min-width:0}.session-files .session-files-header{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6))}.session-files .session-files-list::-webkit-scrollbar{height:var(--forge-scrollbar-height, 16px);width:var(--forge-scrollbar-width, 16px)}.session-files .session-files-list::-webkit-scrollbar-track{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-track:hover{background-color:var(--forge-scrollbar-track-container-hover, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-corner{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-thumb{height:var(--forge-scrollbar-thumb-min-height, 32px);width:var(--forge-scrollbar-thumb-min-width, 32px);border-radius:var(--forge-scrollbar-border-radius, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));border-width:var(--forge-scrollbar-border-width, 3px);border-style:solid;border-color:transparent;background-color:var(--forge-scrollbar-thumb-container, var(--forge-theme-surface-container-medium, #c2c2c2));background-clip:content-box}.session-files .session-files-list::-webkit-scrollbar-thumb:hover{background-color:var(--forge-scrollbar-thumb-container-hover, var(--forge-theme-surface-container-high, #9e9e9e))}.session-files .session-files-list{display:flex;gap:var(--forge-spacing-small, 12px);overflow-x:auto;padding-block-end:var(--forge-spacing-xsmall, 8px)}.disclaimer{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6));text-align:center;margin-block-start:var(--forge-spacing-xxsmall, 4px);margin-block-end:calc(var(--forge-spacing-small, 12px) * -1)}';var Ht=Object.defineProperty,Pt=Object.getOwnPropertyDescriptor,K=e=>{throw TypeError(e)},g=(e,t,s,a)=>{for(var n=a>1?void 0:a?Pt(t,s):t,c=e.length-1,l;c>=0;c--)(l=e[c])&&(n=(a?l(t,s,n):l(n))||n);return a&&n&&Ht(t,s,n),n},W=(e,t,s)=>t.has(e)||K("Cannot "+s),o=(e,t,s)=>(W(e,t,"read from private field"),s?s.call(e):t.get(e)),b=(e,t,s)=>t.has(e)?K("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),v=(e,t,s,a)=>(W(e,t,"write to private field"),t.set(e,s),s),r=(e,t,s)=>(W(e,t,"access private method"),s),J=(e,t,s,a)=>({set _(n){v(e,t,n)},get _(){return o(e,t,a)}}),U,T,y,A,h,d,w,x,M,i,Q,k,R,X,z,C,B,Z,tt,et,st,H,at,it,ot,P,nt,rt,lt,ht,ct,dt,q,O,pt,D,gt,mt,ft,L,ut,bt,N,yt,_t,vt,wt,Ct,xt,Mt,It,j,G,V,Tt,Y,kt,Rt,$t,u,$;const qt="forge-ai-chatbot";let p=class extends St{constructor(){super(...arguments),b(this,i),this.fileUpload="off",this.voiceInput="on",this.debugCommand="on",this.placeholder="Ask a question...",this.showExpandButton=!1,this.showMinimizeButton=!1,this.expanded=!1,this.minimizeIcon="default",this.enableReactions=!1,this.titleText="AI Assistant",this.headingLevel=2,this.debugMode=!1,this.disclaimerText="AI can make mistakes. Always verify responses.",b(this,U,E()),b(this,T,E()),b(this,y,E()),b(this,A,E()),b(this,h),b(this,d),b(this,w),b(this,x),b(this,M,0)}connectedCallback(){super.connectedCallback(),v(this,h,new Bt(this,{tools:o(this,i,C)})),v(this,d,new Ut({onError:e=>{r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:e}})},onStateChange:()=>{this.requestUpdate()}})),this.adapter&&r(this,i,B).call(this)}disconnectedCallback(){super.disconnectedCallback(),o(this,x)?.unsubscribe(),this.adapter?.disconnect()}willUpdate(e){e.has("adapter")&&this.adapter&&(v(this,w,void 0),r(this,i,B).call(this))}clearMessages(){o(this,h).clearMessages(),o(this,d).clear()}getMessages(){return o(this,h).getMessages()}setMessages(e){o(this,h).setMessages(e)}async sendMessage(e,t){if(!this.adapter){console.warn("No adapter configured.");return}if(o(this,y).value?.closeSlashMenu(),t){const s=Date.now();for(const a of t)r(this,i,N).call(this,a,s)}await r(this,i,O).call(this,{content:e,attachments:o(this,d).pendingAttachments})}abort(){r(this,i,D).call(this)}async scrollToBottom({behavior:e}={}){await o(this,T).value?.updateComplete,await new Promise(requestAnimationFrame),o(this,T).value?.scrollToBottom({behavior:e})}getThreadState(){return{threadId:this.adapter?.threadId,messages:this.getMessages(),timestamp:Date.now()}}async setThreadState(e){this.setMessages(e.messages),e.threadId&&this.adapter&&(this.adapter.threadId=e.threadId),await this.updateComplete;const t=e.messages.filter(s=>s.role==="user").map(s=>s.content);o(this,y).value?.setHistory(t),this.scrollToBottom({behavior:"instant"})}render(){return _`
      <forge-ai-chat-interface
        ${S(o(this,U))}
        role="region"
        aria-label="AI chatbot"
        aria-live="polite"
        aria-busy=${o(this,i,R)}>
        <forge-ai-chat-header
          ${S(o(this,A))}
          slot="header"
          ?show-expand-button=${this.showExpandButton}
          ?show-minimize-button=${this.showMinimizeButton}
          ?expanded=${this.expanded}
          export-option=${o(this,i,z)?"enabled":"off"}
          clear-option=${o(this,i,z)?"enabled":"off"}
          .minimizeIcon=${this.minimizeIcon}
          .agentInfo=${this.agentInfo}
          .headingLevel=${this.headingLevel}
          .titleText=${this.titleText}
          @forge-ai-chat-header-expand=${r(this,i,Mt)}
          @forge-ai-chat-header-minimize=${r(this,i,It)}
          @forge-ai-chat-header-clear=${r(this,i,j)}
          @forge-ai-chat-header-export=${r(this,i,Y)}
          @forge-ai-chat-header-info=${r(this,i,G)}>
        </forge-ai-chat-header>
        ${o(this,i,kt)} ${o(this,i,$t)} ${o(this,i,Rt)}
        ${F(this.disclaimerText,()=>_`<div class="disclaimer" slot="disclaimer">${this.disclaimerText}</div>`)}
      </forge-ai-chat-interface>
    `}};U=new WeakMap;T=new WeakMap;y=new WeakMap;A=new WeakMap;h=new WeakMap;d=new WeakMap;w=new WeakMap;x=new WeakMap;M=new WeakMap;i=new WeakSet;Q=function(){const e=[];return o(this,i,z)&&(e.push({id:"clear",name:"Clear",group:"Conversation"}),e.push({id:"export",name:"Export",group:"Conversation"})),e.push({id:"info",name:"Info",group:"Help"}),this.debugCommand==="on"&&e.push({id:"debug",name:`${this.debugMode?"Disable debug mode":"Enable debug mode"}`,group:"Help"}),e};k=function(){return o(this,h)?.messageItems??[]};R=function(){return(this.adapter?.isRunning??!1)||o(this,M)>0};X=function(){return o(this,d)?.isUploading??!1};z=function(){return o(this,i,k).length>0};C=function(){return o(this,w)||v(this,w,new Map(this.adapter?.getTools().map(e=>[e.name,e])??[])),o(this,w)};B=async function(){!this.adapter||this.adapter.isConnecting||(await this.adapter.connect(),o(this,x)?.unsubscribe(),v(this,x,new Dt),o(this,x).add(this.adapter.onMessageStart(r(this,i,Z).bind(this)),this.adapter.onMessageDelta(r(this,i,tt).bind(this)),this.adapter.onMessageEnd(r(this,i,et).bind(this)),this.adapter.onToolCallStart(r(this,i,at).bind(this)),this.adapter.onToolCallArgs(r(this,i,it).bind(this)),this.adapter.onToolCallEnd(r(this,i,ot).bind(this)),this.adapter.onToolCall(r(this,i,nt).bind(this)),this.adapter.onToolCallResult(r(this,i,dt).bind(this)),this.adapter.onRunFinished(r(this,i,st).bind(this)),this.adapter.onRunAborted(r(this,i,ht).bind(this)),this.adapter.onError(r(this,i,lt).bind(this)),this.adapter.onStateChange(r(this,i,ct).bind(this))),v(this,w,void 0),o(this,h)?.updateConfig({tools:o(this,i,C)}),r(this,i,u).call(this,{type:"forge-ai-chatbot-connected"}))};Z=function(e){o(this,h).addTextToResponse(e.messageId,"",e)};tt=function(e){o(this,h).appendTextDelta(e.messageId,e.delta,e),this.scrollToBottom()};et=function(e){o(this,h).markTextComplete(e.messageId,e)};st=function(){r(this,i,H).call(this)};H=function(){if(o(this,M)>0||this.adapter?.isRunning)return;o(this,h).completeResponse();const e=this.getMessages(),t=e[e.length-1];t?.role==="assistant"&&t.status==="complete"&&r(this,i,$).call(this,"forge-ai-chatbot-message-received",t)};at=function(e){const t={id:e.id,messageId:e.messageId,name:e.name,args:{},argsBuffer:"",status:"parsing",type:o(this,i,C).has(e.name)?"client":"agent"};o(this,h).addToolCallToResponse(t,e)};it=function(e){const t={argsBuffer:e.argsBuffer,args:e.partialArgs??{}},s={eventType:"tool-call-args",event:e};o(this,h).updateToolCallInResponse(e.id,t,s),this.scrollToBottom()};ot=function(e){const t={args:e.args,argsBuffer:void 0,status:"executing"},s={eventType:"tool-call-end",event:e};o(this,h).updateToolCallInResponse(e.id,t,s)};P=function(e,t){return typeof t=="string"||t&&typeof t=="object"?t:`Tool '${e}' executed successfully`};nt=async function(e){let t=o(this,h).getToolCall(e.id);if(t?o(this,h).updateToolCallInResponse(e.id,{args:e.args,status:"executing"}):(t={id:e.id,messageId:e.messageId,name:e.name,args:e.args,status:"executing",type:o(this,i,C).has(e.name)?"client":"agent"},o(this,h).addToolCallToResponse(t)),t?.type==="client"){r(this,i,u).call(this,{type:"forge-ai-chatbot-tool-call",detail:{toolCallId:e.id,toolName:e.name,arguments:e.args}});const s=o(this,i,C).get(e.name);s?.handler?await Promise.resolve(r(this,i,rt).call(this,e.id,e.name,s.handler,e.args)):r(this,i,q).call(this,e.id,r(this,i,P).call(this,e.name))}};rt=async function(e,t,s,a){J(this,M)._++,this.requestUpdate();try{const c=await s({args:a,toolCallId:e,toolName:t,signal:void 0});await r(this,i,q).call(this,e,r(this,i,P).call(this,t,c))}catch(n){o(this,h).updateToolCallInResponse(e,{status:"error",result:{error:n.message}})}finally{J(this,M)._--,r(this,i,H).call(this),this.requestUpdate()}};lt=function(e){const t={id:I(),role:"assistant",content:e.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(t),r(this,i,$).call(this,"forge-ai-chatbot-message-received",t),r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:e.message}})};ht=function(){const e={id:I(),role:"system",content:"Run cancelled",timestamp:Date.now(),status:"complete"};o(this,h).addMessage(e),r(this,i,$).call(this,"forge-ai-chatbot-message-received",e)};ct=function(e){this.requestUpdate()};dt=function(e){o(this,h).completeToolCallInResponse(e.toolCallId,e.result,e)};q=async function(e,t){!o(this,h).getToolCall(e)||!this.adapter||(o(this,h).completeToolCallInResponse(e,t),this.adapter.sendToolResult(e,t,this.getMessages()))};O=async function(e){if(!e.content.trim()||!this.adapter||o(this,i,R)){this.adapter||console.warn("No adapter configured.");return}if(!o(this,d).canSend())return;const t={id:I(),role:"user",content:e.content,timestamp:e.timestamp??Date.now(),status:"pending"};o(this,h).addMessage(t);try{this.adapter.sendMessage(this.getMessages()),o(this,h).updateMessageStatus(t.id,"complete")}catch(s){o(this,h).updateMessageStatus(t.id,"error");const a=s instanceof Error?s.message:"Failed to send message";r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:a}})}finally{r(this,i,$).call(this,"forge-ai-chatbot-message-sent",t.id)}};pt=async function(e){const t=[...o(this,d).pendingAttachments];await r(this,i,O).call(this,{content:e.detail.value,timestamp:e.detail.date.getTime(),attachments:t})};D=function(){this.adapter?.isRunning&&this.adapter.abort(),this.requestUpdate()};gt=function(){r(this,i,D).call(this)};mt=async function(e){const t=e.detail.messageId,s=o(this,i,k).find(n=>n.type==="assistant"&&n.data.id===t);if(!s||s.type!=="assistant")return;const a=s.data.children.filter(n=>n.type==="text").map(n=>n.content).join(`

`);try{await navigator.clipboard.writeText(a)}catch{}};ft=function(e){if(!this.adapter)return;const t=e.detail.messageId,s=o(this,i,k).findIndex(a=>a.type==="assistant"&&a.data.id===t);s!==-1&&(o(this,h).removeMessageItemsFrom(s),this.adapter.sendMessage(this.getMessages()))};L=function(e,t){o(this,h).setResponseFeedback(e.detail.messageId,{type:t,reason:e.detail.feedback}),r(this,i,u).call(this,{type:"forge-ai-chatbot-response-feedback",detail:{messageId:e.detail.messageId,type:t,feedback:e.detail.feedback}})};ut=function(e){r(this,i,L).call(this,e,"positive")};bt=function(e){r(this,i,L).call(this,e,"negative")};N=function(e,t){const s=I();o(this,d).addAttachment(s,{filename:e.name,size:e.size,mimeType:e.type,timestamp:t});const a=r(this,i,_t).call(this,s);this.adapter?.emitFileUpload(e,a),r(this,i,u).call(this,{type:"forge-ai-chatbot-file-select",detail:{fileId:s,file:e,filename:e.name,size:e.size,mimeType:e.type,timestamp:t,...a}})};yt=function(e){const{file:t,timestamp:s}=e.detail;r(this,i,N).call(this,t,s)};_t=function(e){return{updateProgress:t=>{o(this,d).updateProgress(e,t)},markComplete:t=>{o(this,d).markComplete(e,t)},markError:t=>{o(this,d).markError(e,t)},onAbort:t=>{o(this,d).registerOnAbort(e,t)}}};vt=function(e){const t={id:I(),role:"assistant",content:e.detail.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(t)};wt=function(e){const{filename:t}=e.detail,s=o(this,d).pendingAttachments.find(n=>n.filename===t);if(s){o(this,d).abort(s.id);return}const a=o(this,d).completedAttachments.find(n=>n.filename===t);a&&a.fileId&&(o(this,d).removeCompletedAttachment(a.id),this.requestUpdate(),this.adapter?.emitFileRemove(a.fileId,{onSuccess:()=>{},onError:n=>{console.error(`Failed to remove file ${t}:`,n)}}))};Ct=async function(e){o(this,y).value?.addToHistory(e.detail.text),await this.sendMessage(e.detail.text),o(this,y).value?.focus()};xt=function(e){const{transcript:t}=e.detail;t&&o(this,y).value&&(o(this,y).value.value=t)};Mt=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-expand"})};It=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-minimize"})};j=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-clear",cancelable:!0}).defaultPrevented||this.clearMessages()};G=function(){const e=o(this,A).value;e?.showAgentInfo&&e.showAgentInfo(),r(this,i,u).call(this,{type:"forge-ai-chatbot-info"})};V=function(){this.debugMode=!this.debugMode};Tt=function(e){switch(e.detail.commandId){case"clear":r(this,i,j).call(this);break;case"export":r(this,i,Y).call(this);break;case"info":r(this,i,G).call(this);break;case"debug":r(this,i,V).call(this);break}};Y=function(){const e=this.getMessages();if(e.length===0)return;const t=e.map(a=>{const n=new Date(a.timestamp).toLocaleString(),c=a.role==="user"?"You":"Assistant";return`[${n}] ${c}:
${a.content}
`}).join(`
`),s=`chat-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`;Ft(t,s,"text/plain")};kt=function(){const e=o(this,d).completedAttachments,s=[...o(this,d).pendingAttachments,...e];return s.length===0?At:_`
      <div class="session-files" slot="attachments">
        <div class="session-files-header">Session Files (${s.length})</div>
        <div class="session-files-list">
          ${s.map(a=>_`
              <forge-ai-attachment
                .filename=${a.filename}
                .size=${a.size}
                ?uploading=${a.uploading??!1}
                removable
                @forge-ai-attachment-remove=${r(this,i,wt)}>
              </forge-ai-attachment>
            `)}
        </div>
      </div>
    `};Rt=function(){const e=o(this,i,X);return _`
      <forge-ai-prompt
        ${S(o(this,y))}
        slot="prompt"
        .placeholder=${this.placeholder}
        .running=${o(this,i,R)||e}
        .slashCommands=${o(this,i,Q)}
        ?disabled=${e}
        ?debug-mode=${this.debugMode}
        @forge-ai-prompt-send=${r(this,i,pt)}
        @forge-ai-prompt-stop=${r(this,i,D)}
        @forge-ai-prompt-cancel=${r(this,i,gt)}
        @forge-ai-prompt-debug-toggle=${r(this,i,V)}
        @forge-ai-prompt-command=${r(this,i,Tt)}>
        ${F(this.fileUpload==="on",()=>_`
            <forge-ai-file-picker
              slot="actions"
              variant="icon-button"
              multiple
              ?disabled=${e}
              .selectedFiles=${o(this,d).pendingAttachments.map(t=>t.filename)}
              @forge-ai-file-picker-change=${r(this,i,yt)}
              @forge-ai-file-picker-error=${r(this,i,vt)}>
            </forge-ai-file-picker>
          `)}
        ${F(this.voiceInput==="on",()=>_`
            <forge-ai-voice-input slot="actions" @forge-ai-voice-input-result=${r(this,i,xt)}>
            </forge-ai-voice-input>
          `)}
      </forge-ai-prompt>
    `};$t=function(){return _`
      <forge-ai-message-thread
        ${S(o(this,T))}
        .messageItems=${o(this,i,k)}
        .tools=${o(this,i,C)}
        ?enable-reactions=${this.enableReactions}
        ?show-thinking=${o(this,i,R)}
        ?debug-mode=${this.debugMode}
        @forge-ai-message-thread-copy=${r(this,i,mt)}
        @forge-ai-message-thread-refresh=${r(this,i,ft)}
        @forge-ai-message-thread-thumbs-up=${r(this,i,ut)}
        @forge-ai-message-thread-thumbs-down=${r(this,i,bt)}>
        <slot name="empty-state-heading" slot="empty-state-heading"></slot>
        <slot name="empty-state-message" slot="empty-state-message"></slot>
        <forge-ai-suggestions
          slot="empty-state-actions"
          variant="block"
          .suggestions=${this.suggestions??[]}
          @forge-ai-suggestions-select=${r(this,i,Ct)}>
        </forge-ai-suggestions>
      </forge-ai-message-thread>
    `};u=function(e){const t=new CustomEvent(e.type,{detail:e.detail,bubbles:!0,composed:!0,cancelable:e.cancelable??!1});return this.dispatchEvent(t),t};$=function(e,t){const s=typeof t=="string"?o(this,h).getMessage(t):t;s&&r(this,i,u).call(this,{type:e,detail:{message:s}})};p.styles=Et(Wt);g([m({attribute:!1})],p.prototype,"adapter",2);g([m({attribute:"file-upload"})],p.prototype,"fileUpload",2);g([m({attribute:"voice-input"})],p.prototype,"voiceInput",2);g([m({attribute:"debug-command"})],p.prototype,"debugCommand",2);g([m()],p.prototype,"placeholder",2);g([m({attribute:!1})],p.prototype,"suggestions",2);g([m({type:Boolean,attribute:"show-expand-button"})],p.prototype,"showExpandButton",2);g([m({type:Boolean,attribute:"show-minimize-button"})],p.prototype,"showMinimizeButton",2);g([m({type:Boolean})],p.prototype,"expanded",2);g([m({attribute:"minimize-icon"})],p.prototype,"minimizeIcon",2);g([m({type:Boolean,attribute:"enable-reactions"})],p.prototype,"enableReactions",2);g([m({type:Object,attribute:!1})],p.prototype,"agentInfo",2);g([m({attribute:"title-text"})],p.prototype,"titleText",2);g([m({attribute:"heading-level",type:Number})],p.prototype,"headingLevel",2);g([m({type:Boolean,attribute:"debug-mode"})],p.prototype,"debugMode",2);g([m({attribute:"disclaimer-text"})],p.prototype,"disclaimerText",2);p=g([zt(qt)],p);
