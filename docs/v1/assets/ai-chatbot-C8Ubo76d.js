import{r as $t,i as kt,x as y,E as Et}from"./iframe-C2rBoQes.js";import{t as St}from"./custom-element-UsVr97OX.js";import{n as m}from"./property-B6tO7CkJ.js";import{n as E,e as k}from"./ref-DMrpeMts.js";import{n as D}from"./when-CI7b_ccM.js";import{S as At}from"./mock-adapter-DPRgB_9-.js";import{g as I,d as zt}from"./utils-Dod8vlOP.js";import"./ai-attachment-BcZStbYJ.js";import"./ai-chat-header-DsESxKwS.js";import"./ai-chat-interface-DYNOZ4iU.js";import"./ai-file-picker-Dnvul26T.js";import"./ai-message-thread-z5H5aIzm.js";import"./ai-prompt-BEMcO6bP.js";import"./ai-spinner-ByUEuC-A.js";import"./ai-suggestions-DqMBRc7K.js";import"./ai-voice-input-DinyQjPV.js";class Dt{constructor(t){this._attachments=new Map,this._abortCallbacks=new Map,this._config=t}get pendingAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="pending"||t.status==="uploading").map(t=>t.metadata)}get completedAttachments(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete").map(t=>t.metadata)}get allAttachments(){return Array.from(this._attachments.values()).map(t=>t.metadata)}get isUploading(){return Array.from(this._attachments.values()).some(t=>t.status==="uploading")}updateConfig(t){this._config={...this._config,...t}}addAttachment(t,a){const s={id:t,status:"pending",...a};this._attachments.set(t,{id:t,metadata:s,status:"pending"}),this._config.onStateChange?.()}removeAttachment(t){this._attachments.delete(t),this._abortCallbacks.delete(t),this._config.onStateChange?.()}removeCompletedAttachment(t){this._attachments.get(t)?.status==="complete"&&(this._attachments.delete(t),this._config.onStateChange?.())}updateProgress(t,a){const s=this._attachments.get(t);s&&(s.status="uploading",s.metadata.uploading=!0,s.metadata.progress=a,s.metadata.status="uploading",this._config.onStateChange?.())}markComplete(t,a){const s=this._attachments.get(t);s&&(s.status="complete",s.uploadedFile=a,s.metadata.uploading=!1,s.metadata.progress=100,s.metadata.status="success",s.metadata.fileId=a.fileId,this._config.onStateChange?.())}markError(t,a){const s=this._attachments.get(t);s&&(s.status="error",s.errorMessage=a,s.metadata.uploading=!1,s.metadata.status="error",s.metadata.error=a,console.error(`File upload error for ${s.metadata.filename}: ${a}`),this._config.onError?.(a),this.removeAttachment(t))}registerOnAbort(t,a){this._abortCallbacks.set(t,a)}abort(t){const a=this._abortCallbacks.get(t);a&&a(),this.removeAttachment(t)}canSend(){return!Array.from(this._attachments.values()).some(t=>t.status==="uploading")}getCompletedUploads(){return Array.from(this._attachments.values()).filter(t=>t.status==="complete"&&t.uploadedFile).map(t=>t.uploadedFile)}clear(){this._attachments.clear(),this._abortCallbacks.clear(),this._config.onStateChange?.()}}class Ut{constructor(t,a){this._host=t,this._config=a,this._messageItems=[],this._toolCalls=new Map,this._activeResponse=null,t.addController(this)}hostConnected(){}hostDisconnected(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null}updateConfig(t){this._config={...this._config,...t}}get messageItems(){return this._messageItems}getToolCall(t){return this._toolCalls.get(t)}getActiveResponse(){return this._activeResponse}startResponse(){if(this._activeResponse)return this._activeResponse;const t={id:I(),children:[],status:"streaming",timestamp:Date.now()};return this._activeResponse=t,this._messageItems=[...this._messageItems,{type:"assistant",data:t}],this.#t(),t}addTextToResponse(t,a,s){const n=this._activeResponse??this.startResponse(),c=n.children.findIndex(l=>l.type==="text"&&l.messageId===t);if(c>=0){const l=n.children[c];l.type==="text"&&(l.content=a)}else n.children.push({type:"text",messageId:t,content:a,status:"streaming"});s&&this.#e({type:"message-start",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#t()}appendTextDelta(t,a,s){const n=this._activeResponse??this.startResponse(),c=n.children.find(l=>l.type==="text"&&l.messageId===t);c&&c.type==="text"?c.content+=a:n.children.push({type:"text",messageId:t,content:a,status:"streaming"}),s&&this.#e({type:"message-delta",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#s(),this.#t()}markTextComplete(t,a){if(!this._activeResponse)return;const s=this._activeResponse.children.find(n=>n.type==="text"&&n.messageId===t);s&&s.type==="text"&&(s.status="complete"),a&&this.#e({type:"message-end",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}),this.#s(),this.#t()}addToolCallToResponse(t,a){const s=this._activeResponse??this.startResponse();if(this._toolCalls.set(t.id,t),s.children.push({type:"toolCall",data:t}),a){const n={type:"tool-call-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent};this.#e(n),this.#a(t.id,n)}this.#s(),this.#t()}updateToolCallInResponse(t,a,s){const n=this._toolCalls.get(t);if(!n)return;const c={...n,...a};if(this._toolCalls.set(t,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=c;break}}if(s)if(s.eventType==="tool-call-args"){const l=s.event,f={type:"tool-call-args",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(f),this.#a(t,f)}else{const l=s.event,f={type:"tool-call-end",timestamp:Date.now(),data:l,rawEvent:l.rawEvent};this.#e(f),this.#a(t,f)}this.#s(),this.#t()}completeToolCallInResponse(t,a,s){if(this.updateToolCallInResponse(t,{result:a,status:"complete"}),s){const n={type:"tool-result",timestamp:Date.now(),data:s,rawEvent:s.rawEvent};this.#e(n),this.#a(t,n)}}completeResponse(){this._activeResponse&&(this._activeResponse.status="complete",this.#s(),this._activeResponse=null,this.#t())}#s(){const t=this._activeResponse;t&&(this._messageItems=this._messageItems.map(a=>a.type==="assistant"&&a.data.id===t.id?{type:"assistant",data:{...t}}:a))}#e(t){this._activeResponse&&(this._activeResponse.eventStream=[...this._activeResponse.eventStream||[],t])}#a(t,a){const s=this._toolCalls.get(t);if(!s)return;const n=[...s.eventStream||[],a],c={...s,eventStream:n};if(this._toolCalls.set(t,c),this._activeResponse){for(const l of this._activeResponse.children)if(l.type==="toolCall"&&l.data.id===t){l.data=c;break}}}#t(){this._host.requestUpdate()}addMessageItem(t){this._messageItems=[...this._messageItems,t],this.#t()}addMessage(t,a){this.getMessage(t.id)||(this.addMessageItem({type:"message",data:t}),a&&this.#i(t.id,{type:"message-start",timestamp:Date.now(),data:a,rawEvent:a.rawEvent}))}getMessage(t){const a=this._messageItems.find(s=>s.type==="message"&&s.data.id===t);return a?.type==="message"?a.data:void 0}updateMessageStatus(t,a,s){this._messageItems=this._messageItems.map(n=>n.type==="message"&&n.data.id===t?{...n,data:{...n.data,status:a}}:n),s&&this.#i(t,{type:"message-end",timestamp:Date.now(),data:s,rawEvent:s.rawEvent}),this.#t()}removeMessageItem(t){this._messageItems=this._messageItems.filter((a,s)=>s!==t),this.#t()}clearMessages(){this._messageItems=[],this._toolCalls.clear(),this._activeResponse=null,this.#t()}removeMessageItemsFrom(t){this._messageItems=this._messageItems.slice(0,t),this._activeResponse=null,this.#t()}getMessages(){const t=[];for(const a of this._messageItems)if(a.type==="message")t.push({...a.data,toolCalls:[]});else if(a.type==="assistant"){const s=a.data,n=s.children.filter(f=>f.type==="text").map(f=>f.content).join(""),c=s.children.filter(f=>f.type==="toolCall").map(f=>f.data),l={id:s.id,role:"assistant",content:n,timestamp:s.timestamp,status:s.status==="streaming"?"streaming":s.status==="error"?"error":"complete",toolCalls:c.length?c:void 0,eventStream:s.eventStream};t.push(l)}else if(a.type==="toolCall"){const s=t[t.length-1];s&&s.role==="assistant"&&(s.toolCalls=[...s.toolCalls||[],a.data])}return t}setMessages(t){const a=[];this._toolCalls.clear(),this._activeResponse=null;for(const s of t)if(s.role==="assistant"){const n=[];if(s.content?.trim()&&n.push({type:"text",messageId:s.id,content:s.content,status:"complete"}),s.toolCalls)for(const l of s.toolCalls)n.push({type:"toolCall",data:l}),this._toolCalls.set(l.id,l);const c={id:s.id,children:n,status:s.status==="streaming"?"streaming":s.status==="error"?"error":"complete",timestamp:s.timestamp,eventStream:s.eventStream};a.push({type:"assistant",data:c})}else a.push({type:"message",data:{...s,toolCalls:void 0}});this._messageItems=a,this.#t()}#i(t,a){this._messageItems.some(n=>n.type==="message"&&n.data.id===t)&&(this._messageItems=this._messageItems.map(n=>{if(n.type==="message"&&n.data.id===t){const c=[...n.data.eventStream||[],a];return{...n,data:{...n.data,eventStream:c}}}return n}),this.#t())}}const Ft=':host{display:block;width:100%;height:100%}forge-ai-chat-interface::part(messages){overflow:hidden}forge-ai-chat-interface forge-ai-message-thread{min-height:0}.session-files{display:flex;flex-direction:column;gap:var(--forge-spacing-xsmall, 8px);min-width:0}.session-files .session-files-header{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6))}.session-files .session-files-list::-webkit-scrollbar{height:var(--forge-scrollbar-height, 16px);width:var(--forge-scrollbar-width, 16px)}.session-files .session-files-list::-webkit-scrollbar-track{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-track:hover{background-color:var(--forge-scrollbar-track-container-hover, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-corner{background-color:var(--forge-scrollbar-track-container, var(--forge-theme-surface-container-low, #ebebeb))}.session-files .session-files-list::-webkit-scrollbar-thumb{height:var(--forge-scrollbar-thumb-min-height, 32px);width:var(--forge-scrollbar-thumb-min-width, 32px);border-radius:var(--forge-scrollbar-border-radius, calc(var(--forge-shape-full, 9999px) * var(--forge-shape-factor, 1)));border-width:var(--forge-scrollbar-border-width, 3px);border-style:solid;border-color:transparent;background-color:var(--forge-scrollbar-thumb-container, var(--forge-theme-surface-container-medium, #c2c2c2));background-clip:content-box}.session-files .session-files-list::-webkit-scrollbar-thumb:hover{background-color:var(--forge-scrollbar-thumb-container-hover, var(--forge-theme-surface-container-high, #9e9e9e))}.session-files .session-files-list{display:flex;gap:var(--forge-spacing-small, 12px);overflow-x:auto;padding-block-end:var(--forge-spacing-xsmall, 8px)}.disclaimer{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--forge-typography-label1-font-family, var(--forge-typography-font-family, "Roboto", sans-serif));font-size:var(--forge-typography-label1-font-size, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-font-size-scale, .75)));font-weight:var(--forge-typography-label1-font-weight, 400);line-height:var(--forge-typography-label1-line-height, calc(var(--forge-typography-font-size, 1rem) * var(--forge-typography-label-line-height-scale, 1.25)));letter-spacing:var(--forge-typography-label1-letter-spacing, .0357142857em);text-transform:var(--forge-typography-label1-text-transform, inherit);text-decoration:var(--forge-typography-label1-text-decoration, inherit);color:var(--forge-theme-text-medium, rgba(0, 0, 0, .6));text-align:center;margin-block-start:var(--forge-spacing-xxsmall, 4px);margin-block-end:calc(var(--forge-spacing-small, 12px) * -1)}';var Bt=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,Y=e=>{throw TypeError(e)},g=(e,t,a,s)=>{for(var n=s>1?void 0:s?Wt(t,a):t,c=e.length-1,l;c>=0;c--)(l=e[c])&&(n=(s?l(t,a,n):l(n))||n);return s&&n&&Bt(t,a,n),n},B=(e,t,a)=>t.has(e)||Y("Cannot "+a),o=(e,t,a)=>(B(e,t,"read from private field"),a?a.call(e):t.get(e)),b=(e,t,a)=>t.has(e)?Y("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),v=(e,t,a,s)=>(B(e,t,"write to private field"),t.set(e,a),a),r=(e,t,a)=>(B(e,t,"access private method"),a),V=(e,t,a,s)=>({set _(n){v(e,t,n)},get _(){return o(e,t,s)}}),U,T,_,S,h,d,w,x,M,i,J,R,$,K,A,C,F,Q,X,Z,tt,W,et,st,at,P,it,ot,nt,rt,lt,ht,q,H,ct,z,dt,pt,gt,mt,ft,O,ut,bt,yt,_t,vt,wt,Ct,xt,L,N,j,Mt,G,It,Tt,Rt,u;const Pt="forge-ai-chatbot";let p=class extends kt{constructor(){super(...arguments),b(this,i),this.fileUpload="off",this.voiceInput="on",this.debugCommand="on",this.placeholder="Ask a question...",this.showExpandButton=!1,this.showMinimizeButton=!1,this.expanded=!1,this.minimizeIcon="default",this.enableReactions=!1,this.titleText="AI Assistant",this.headingLevel=2,this.debugMode=!1,this.disclaimerText="AI can make mistakes. Always verify responses.",b(this,U,k()),b(this,T,k()),b(this,_,k()),b(this,S,k()),b(this,h),b(this,d),b(this,w),b(this,x),b(this,M,0)}connectedCallback(){super.connectedCallback(),v(this,h,new Ut(this,{tools:o(this,i,C)})),v(this,d,new Dt({onError:e=>{r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:e}})},onStateChange:()=>{this.requestUpdate()}})),this.adapter&&r(this,i,F).call(this)}disconnectedCallback(){super.disconnectedCallback(),o(this,x)?.unsubscribe(),this.adapter?.disconnect()}willUpdate(e){e.has("adapter")&&this.adapter&&(v(this,w,void 0),r(this,i,F).call(this))}clearMessages(){o(this,h).clearMessages(),o(this,d).clear()}getMessages(){return o(this,h).getMessages()}setMessages(e){o(this,h).setMessages(e)}async sendMessage(e,t){if(!this.adapter){console.warn("No adapter configured.");return}if(o(this,_).value?.closeSlashMenu(),t){const a=Date.now();for(const s of t)r(this,i,O).call(this,s,a)}await r(this,i,H).call(this,{content:e,attachments:o(this,d).pendingAttachments})}abort(){r(this,i,z).call(this)}async scrollToBottom({behavior:e}={}){await o(this,T).value?.updateComplete,await new Promise(requestAnimationFrame),o(this,T).value?.scrollToBottom({behavior:e})}getThreadState(){return{threadId:this.adapter?.threadId,messages:this.getMessages(),timestamp:Date.now()}}setThreadState(e){this.setMessages(e.messages),e.threadId&&this.adapter&&(this.adapter.threadId=e.threadId)}render(){return y`
      <forge-ai-chat-interface
        ${E(o(this,U))}
        role="region"
        aria-label="AI chatbot"
        aria-live="polite"
        aria-busy=${o(this,i,$)}>
        <forge-ai-chat-header
          ${E(o(this,S))}
          slot="header"
          ?show-expand-button=${this.showExpandButton}
          ?show-minimize-button=${this.showMinimizeButton}
          ?expanded=${this.expanded}
          export-option=${o(this,i,A)?"enabled":"off"}
          clear-option=${o(this,i,A)?"enabled":"off"}
          .minimizeIcon=${this.minimizeIcon}
          .agentInfo=${this.agentInfo}
          .headingLevel=${this.headingLevel}
          .titleText=${this.titleText}
          @forge-ai-chat-header-expand=${r(this,i,Ct)}
          @forge-ai-chat-header-minimize=${r(this,i,xt)}
          @forge-ai-chat-header-clear=${r(this,i,L)}
          @forge-ai-chat-header-export=${r(this,i,G)}
          @forge-ai-chat-header-info=${r(this,i,N)}>
        </forge-ai-chat-header>
        ${o(this,i,It)} ${o(this,i,Rt)} ${o(this,i,Tt)}
        ${D(this.disclaimerText,()=>y`<div class="disclaimer" slot="disclaimer">${this.disclaimerText}</div>`)}
      </forge-ai-chat-interface>
    `}};U=new WeakMap;T=new WeakMap;_=new WeakMap;S=new WeakMap;h=new WeakMap;d=new WeakMap;w=new WeakMap;x=new WeakMap;M=new WeakMap;i=new WeakSet;J=function(){const e=[];return o(this,i,A)&&(e.push({id:"clear",name:"Clear",group:"Conversation"}),e.push({id:"export",name:"Export",group:"Conversation"})),e.push({id:"info",name:"Info",group:"Help"}),this.debugCommand==="on"&&e.push({id:"debug",name:`${this.debugMode?"Disable debug mode":"Enable debug mode"}`,group:"Help"}),e};R=function(){return o(this,h)?.messageItems??[]};$=function(){return(this.adapter?.isRunning??!1)||o(this,M)>0};K=function(){return o(this,d)?.isUploading??!1};A=function(){return o(this,i,R).length>0};C=function(){return o(this,w)||v(this,w,new Map(this.adapter?.getTools().map(e=>[e.name,e])??[])),o(this,w)};F=async function(){!this.adapter||this.adapter.isConnecting||(await this.adapter.connect(),o(this,x)?.unsubscribe(),v(this,x,new At),o(this,x).add(this.adapter.onMessageStart(r(this,i,Q).bind(this)),this.adapter.onMessageDelta(r(this,i,X).bind(this)),this.adapter.onMessageEnd(r(this,i,Z).bind(this)),this.adapter.onToolCallStart(r(this,i,et).bind(this)),this.adapter.onToolCallArgs(r(this,i,st).bind(this)),this.adapter.onToolCallEnd(r(this,i,at).bind(this)),this.adapter.onToolCall(r(this,i,it).bind(this)),this.adapter.onToolCallResult(r(this,i,ht).bind(this)),this.adapter.onRunFinished(r(this,i,tt).bind(this)),this.adapter.onRunAborted(r(this,i,rt).bind(this)),this.adapter.onError(r(this,i,nt).bind(this)),this.adapter.onStateChange(r(this,i,lt).bind(this))),v(this,w,void 0),o(this,h)?.updateConfig({tools:o(this,i,C)}),r(this,i,u).call(this,{type:"forge-ai-chatbot-connected"}))};Q=function(e){o(this,h).addTextToResponse(e.messageId,"",e)};X=function(e){o(this,h).appendTextDelta(e.messageId,e.delta,e),this.scrollToBottom()};Z=function(e){o(this,h).markTextComplete(e.messageId,e)};tt=function(){r(this,i,W).call(this)};W=function(){o(this,M)>0||this.adapter?.isRunning||o(this,h).completeResponse()};et=function(e){const t={id:e.id,messageId:e.messageId,name:e.name,args:{},argsBuffer:"",status:"parsing",type:o(this,i,C).has(e.name)?"client":"agent"};o(this,h).addToolCallToResponse(t,e)};st=function(e){const t={argsBuffer:e.argsBuffer,args:e.partialArgs??{}},a={eventType:"tool-call-args",event:e};o(this,h).updateToolCallInResponse(e.id,t,a),this.scrollToBottom()};at=function(e){const t={args:e.args,argsBuffer:void 0,status:"executing"},a={eventType:"tool-call-end",event:e};o(this,h).updateToolCallInResponse(e.id,t,a)};P=function(e,t){return typeof t=="string"||t&&typeof t=="object"?t:`Tool '${e}' executed successfully`};it=async function(e){let t=o(this,h).getToolCall(e.id);if(t?o(this,h).updateToolCallInResponse(e.id,{args:e.args,status:"executing"}):(t={id:e.id,messageId:e.messageId,name:e.name,args:e.args,status:"executing",type:o(this,i,C).has(e.name)?"client":"agent"},o(this,h).addToolCallToResponse(t)),t?.type==="client"){r(this,i,u).call(this,{type:"forge-ai-chatbot-tool-call",detail:{toolCallId:e.id,toolName:e.name,arguments:e.args}});const a=o(this,i,C).get(e.name);a?.handler?await Promise.resolve(r(this,i,ot).call(this,e.id,e.name,a.handler,e.args)):r(this,i,q).call(this,e.id,r(this,i,P).call(this,e.name))}};ot=async function(e,t,a,s){V(this,M)._++,this.requestUpdate();try{const c=await a({args:s,toolCallId:e,toolName:t,signal:void 0});await r(this,i,q).call(this,e,r(this,i,P).call(this,t,c))}catch(n){o(this,h).updateToolCallInResponse(e,{status:"error",result:{error:n.message}})}finally{V(this,M)._--,r(this,i,W).call(this),this.requestUpdate()}};nt=function(e){const t={id:I(),role:"assistant",content:e.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(t),r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:e.message}})};rt=function(){const e={id:I(),role:"system",content:"Run cancelled",timestamp:Date.now(),status:"complete"};o(this,h).addMessage(e)};lt=function(e){this.requestUpdate()};ht=function(e){o(this,h).completeToolCallInResponse(e.toolCallId,e.result,e)};q=async function(e,t){!o(this,h).getToolCall(e)||!this.adapter||(o(this,h).completeToolCallInResponse(e,t),this.adapter.sendToolResult(e,t,this.getMessages()))};H=async function(e){if(!e.content.trim()||!this.adapter||o(this,i,$)){this.adapter||console.warn("No adapter configured.");return}if(!o(this,d).canSend())return;const t={id:I(),role:"user",content:e.content,timestamp:e.timestamp??Date.now(),status:"pending"};o(this,h).addMessage(t),r(this,i,u).call(this,{type:"forge-ai-chatbot-message-sent",detail:{message:t}});try{this.adapter.sendMessage(this.getMessages()),o(this,h).updateMessageStatus(t.id,"complete")}catch(a){o(this,h).updateMessageStatus(t.id,"error");const s=a instanceof Error?a.message:"Failed to send message";r(this,i,u).call(this,{type:"forge-ai-chatbot-error",detail:{error:s}})}};ct=async function(e){const t=[...o(this,d).pendingAttachments];await r(this,i,H).call(this,{content:e.detail.value,timestamp:e.detail.date.getTime(),attachments:t})};z=function(){this.adapter?.isRunning&&this.adapter.abort(),this.requestUpdate()};dt=function(){r(this,i,z).call(this)};pt=async function(e){const t=e.detail.messageId,a=o(this,i,R).find(n=>n.type==="assistant"&&n.data.id===t);if(!a||a.type!=="assistant")return;const s=a.data.children.filter(n=>n.type==="text").map(n=>n.content).join(`

`);try{await navigator.clipboard.writeText(s)}catch{}};gt=function(e){if(!this.adapter)return;const t=e.detail.messageId,a=o(this,i,R).findIndex(s=>s.type==="assistant"&&s.data.id===t);a!==-1&&(o(this,h).removeMessageItemsFrom(a),this.adapter.sendMessage(this.getMessages()))};mt=function(e){console.warn("thumbs-up",e.detail.messageId)};ft=function(e){console.warn("thumbs-down",e.detail.messageId)};O=function(e,t){const a=I();o(this,d).addAttachment(a,{filename:e.name,size:e.size,mimeType:e.type,timestamp:t});const s=r(this,i,bt).call(this,a);this.adapter?.emitFileUpload(e,s),r(this,i,u).call(this,{type:"forge-ai-chatbot-file-select",detail:{fileId:a,file:e,filename:e.name,size:e.size,mimeType:e.type,timestamp:t,...s}})};ut=function(e){const{file:t,timestamp:a}=e.detail;r(this,i,O).call(this,t,a)};bt=function(e){return{updateProgress:t=>{o(this,d).updateProgress(e,t)},markComplete:t=>{o(this,d).markComplete(e,t)},markError:t=>{o(this,d).markError(e,t)},onAbort:t=>{o(this,d).registerOnAbort(e,t)}}};yt=function(e){const t={id:I(),role:"assistant",content:e.detail.message,timestamp:Date.now(),status:"error"};o(this,h).addMessage(t)};_t=function(e){const{filename:t}=e.detail,a=o(this,d).pendingAttachments.find(n=>n.filename===t);if(a){o(this,d).abort(a.id);return}const s=o(this,d).completedAttachments.find(n=>n.filename===t);s&&s.fileId&&(o(this,d).removeCompletedAttachment(s.id),this.requestUpdate(),this.adapter?.emitFileRemove(s.fileId,{onSuccess:()=>{},onError:n=>{console.error(`Failed to remove file ${t}:`,n)}}))};vt=async function(e){o(this,_).value?.addToHistory(e.detail.text),await this.sendMessage(e.detail.text),o(this,_).value?.focus()};wt=function(e){const{transcript:t}=e.detail;t&&o(this,_).value&&(o(this,_).value.value=t)};Ct=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-expand"})};xt=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-minimize"})};L=function(){r(this,i,u).call(this,{type:"forge-ai-chatbot-clear",cancelable:!0}).defaultPrevented||this.clearMessages()};N=function(){const e=o(this,S).value;e?.showAgentInfo&&e.showAgentInfo(),r(this,i,u).call(this,{type:"forge-ai-chatbot-info"})};j=function(){this.debugMode=!this.debugMode};Mt=function(e){switch(e.detail.commandId){case"clear":r(this,i,L).call(this);break;case"export":r(this,i,G).call(this);break;case"info":r(this,i,N).call(this);break;case"debug":r(this,i,j).call(this);break}};G=function(){const e=this.getMessages();if(e.length===0)return;const t=e.map(s=>{const n=new Date(s.timestamp).toLocaleString(),c=s.role==="user"?"You":"Assistant";return`[${n}] ${c}:
${s.content}
`}).join(`
`),a=`chat-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`;zt(t,a,"text/plain")};It=function(){const e=o(this,d).completedAttachments,a=[...o(this,d).pendingAttachments,...e];return a.length===0?Et:y`
      <div class="session-files" slot="attachments">
        <div class="session-files-header">Session Files (${a.length})</div>
        <div class="session-files-list">
          ${a.map(s=>y`
              <forge-ai-attachment
                .filename=${s.filename}
                .size=${s.size}
                ?uploading=${s.uploading??!1}
                removable
                @forge-ai-attachment-remove=${r(this,i,_t)}>
              </forge-ai-attachment>
            `)}
        </div>
      </div>
    `};Tt=function(){const e=o(this,i,K);return y`
      <forge-ai-prompt
        ${E(o(this,_))}
        slot="prompt"
        .placeholder=${this.placeholder}
        .running=${o(this,i,$)||e}
        .slashCommands=${o(this,i,J)}
        ?disabled=${e}
        ?debug-mode=${this.debugMode}
        @forge-ai-prompt-send=${r(this,i,ct)}
        @forge-ai-prompt-stop=${r(this,i,z)}
        @forge-ai-prompt-cancel=${r(this,i,dt)}
        @forge-ai-prompt-debug-toggle=${r(this,i,j)}
        @forge-ai-prompt-command=${r(this,i,Mt)}>
        ${D(this.fileUpload==="on",()=>y`
            <forge-ai-file-picker
              slot="actions"
              variant="icon-button"
              multiple
              ?disabled=${e}
              .selectedFiles=${o(this,d).pendingAttachments.map(t=>t.filename)}
              @forge-ai-file-picker-change=${r(this,i,ut)}
              @forge-ai-file-picker-error=${r(this,i,yt)}>
            </forge-ai-file-picker>
          `)}
        ${D(this.voiceInput==="on",()=>y`
            <forge-ai-voice-input slot="actions" @forge-ai-voice-input-result=${r(this,i,wt)}>
            </forge-ai-voice-input>
          `)}
      </forge-ai-prompt>
    `};Rt=function(){return y`
      <forge-ai-message-thread
        ${E(o(this,T))}
        .messageItems=${o(this,i,R)}
        .tools=${o(this,i,C)}
        ?enable-reactions=${this.enableReactions}
        ?show-thinking=${o(this,i,$)}
        ?debug-mode=${this.debugMode}
        @forge-ai-message-thread-copy=${r(this,i,pt)}
        @forge-ai-message-thread-refresh=${r(this,i,gt)}
        @forge-ai-message-thread-thumbs-up=${r(this,i,mt)}
        @forge-ai-message-thread-thumbs-down=${r(this,i,ft)}>
        <slot name="empty-state-heading" slot="empty-state-heading"></slot>
        <slot name="empty-state-message" slot="empty-state-message"></slot>
        <forge-ai-suggestions
          slot="empty-state-actions"
          variant="block"
          .suggestions=${this.suggestions??[]}
          @forge-ai-suggestions-select=${r(this,i,vt)}>
        </forge-ai-suggestions>
      </forge-ai-message-thread>
    `};u=function(e){const t=new CustomEvent(e.type,{detail:e.detail,bubbles:!0,composed:!0,cancelable:e.cancelable??!1});return this.dispatchEvent(t),t};p.styles=$t(Ft);g([m({attribute:!1})],p.prototype,"adapter",2);g([m({attribute:"file-upload"})],p.prototype,"fileUpload",2);g([m({attribute:"voice-input"})],p.prototype,"voiceInput",2);g([m({attribute:"debug-command"})],p.prototype,"debugCommand",2);g([m()],p.prototype,"placeholder",2);g([m({attribute:!1})],p.prototype,"suggestions",2);g([m({type:Boolean,attribute:"show-expand-button"})],p.prototype,"showExpandButton",2);g([m({type:Boolean,attribute:"show-minimize-button"})],p.prototype,"showMinimizeButton",2);g([m({type:Boolean})],p.prototype,"expanded",2);g([m({attribute:"minimize-icon"})],p.prototype,"minimizeIcon",2);g([m({type:Boolean,attribute:"enable-reactions"})],p.prototype,"enableReactions",2);g([m({type:Object,attribute:!1})],p.prototype,"agentInfo",2);g([m({attribute:"title-text"})],p.prototype,"titleText",2);g([m({attribute:"heading-level",type:Number})],p.prototype,"headingLevel",2);g([m({type:Boolean,attribute:"debug-mode"})],p.prototype,"debugMode",2);g([m({attribute:"disclaimer-text"})],p.prototype,"disclaimerText",2);p=g([St(Pt)],p);
