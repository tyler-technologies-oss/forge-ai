<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AG-UI Adapter - Standalone Usage Demos</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        color: #333;
        margin-bottom: 8px;
      }

      .subtitle {
        color: #666;
        font-size: 14px;
        margin-bottom: 24px;
      }

      .config {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .config h2 {
        margin-top: 0;
        font-size: 18px;
        color: #333;
      }

      .config-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 12px;
      }

      .config label {
        display: block;
        margin-bottom: 4px;
        font-weight: 500;
        font-size: 14px;
        color: #555;
      }

      .config input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .config button {
        padding: 10px 20px;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .config button:hover:not(:disabled) {
        background: #0052a3;
      }

      .config button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .status {
        padding: 12px;
        margin-bottom: 20px;
        border-radius: 4px;
        font-size: 14px;
      }

      .status.info {
        background: #e3f2fd;
        color: #0d47a1;
      }

      .status.error {
        background: #ffebee;
        color: #c62828;
      }

      .status.success {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .demos {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .demo {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .demo h3 {
        margin-top: 0;
        font-size: 16px;
        color: #333;
      }

      .demo textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        resize: vertical;
        min-height: 150px;
        margin-bottom: 12px;
      }

      .demo-actions {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .demo button {
        flex: 1;
        padding: 10px;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .demo button:hover:not(:disabled) {
        background: #0052a3;
      }

      .demo button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .demo button.secondary {
        background: #6c757d;
      }

      .demo button.secondary:hover:not(:disabled) {
        background: #5a6268;
      }

      .response {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 12px;
        min-height: 100px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 14px;
      }

      .response:empty::before {
        content: 'Response will appear here...';
        color: #999;
        font-style: italic;
      }

      .response.streaming {
        border-color: #0066cc;
        background: #f0f7ff;
      }

      .history {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .history h3 {
        margin-top: 0;
        font-size: 16px;
        color: #333;
      }

      .history-content {
        max-height: 400px;
        overflow-y: auto;
        font-size: 14px;
      }

      .message {
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid #eee;
      }

      .message:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .message-role {
        font-weight: 600;
        color: #0066cc;
        margin-bottom: 4px;
      }

      .message-role.assistant {
        color: #2e7d32;
      }

      .message-role.tool {
        color: #f57c00;
      }

      .message-content {
        color: #333;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .tool-call {
        background: #fff3e0;
        border-left: 3px solid #f57c00;
        padding: 8px 12px;
        margin: 8px 0;
        border-radius: 4px;
        font-size: 13px;
      }

      .tool-name {
        font-weight: 600;
        color: #f57c00;
      }

      .tool-args {
        color: #666;
        margin-top: 4px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
      }

      .state-indicator {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
      }

      .state-indicator.connected {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .state-indicator.running {
        background: #e3f2fd;
        color: #0d47a1;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>AG-UI Adapter - Standalone Usage Demos</h1>
      <p class="subtitle">
        Demonstrates using the adapter directly without the chatbot component for one-off AI requests
      </p>

      <div class="config">
        <h2>
          Configuration
          <span id="stateConnected" class="state-indicator" style="display: none">Connected</span>
          <span id="stateRunning" class="state-indicator" style="display: none">Processing...</span>
        </h2>
        <div class="config-grid">
          <div>
            <label for="baseUrl">Base URL:</label>
            <input
              type="text"
              id="baseUrl"
              value="http://localhost:3001/api/agents"
              placeholder="http://localhost:3001/api/agents" />
          </div>
          <div>
            <label for="agentId">Agent ID:</label>
            <input
              type="text"
              id="agentId"
              value="agent-9b3ff935-f32d-477b-ac45-ce2a3570b90c"
              placeholder="agent-9b3ff935-f32d-477b-ac45-ce2a3570b90c" />
          </div>
        </div>
        <button id="initBtn">Initialize Adapter</button>
      </div>

      <div id="status"></div>

      <div class="demos">
        <div class="demo">
          <h3>Demo 1: Code Snippet Explainer</h3>
          <textarea id="codeInput" placeholder="Paste code here...">function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}</textarea>
          <div class="demo-actions">
            <button id="explainBtn" disabled>Explain Code</button>
          </div>
          <div id="codeResponse" class="response"></div>
        </div>

        <div class="demo">
          <h3>Demo 2: Invoice Data Extractor</h3>
          <textarea id="invoiceInput">INVOICE #INV-2024-1234

Bill To:
Acme Corporation
123 Business St
New York, NY 10001

Invoice Date: January 15, 2024
Due Date: February 14, 2024

Items:
- Web Development Services (40 hrs @ $150/hr): $6,000.00
- UI/UX Design (20 hrs @ $125/hr): $2,500.00
- Project Management: $1,500.00

Subtotal: $10,000.00
Tax (8.5%): $850.00
Total Due: $10,850.00

Payment Terms: Net 30
Payment Methods: Wire Transfer, Check</textarea>
          <div class="demo-actions">
            <button id="extractBtn" disabled>Extract Data</button>
            <button id="loadAnotherBtn" class="secondary" disabled>Load Another Invoice</button>
          </div>
          <div id="invoiceResponse" class="response"></div>
        </div>
      </div>

      <div class="history">
        <h3>Message History (Shared Adapter Instance)</h3>
        <div id="historyContent" class="history-content">
          <p style="color: #999; font-style: italic">Initialize adapter to start...</p>
        </div>
      </div>
    </div>

    <script type="module">
      import { AgUiAdapter, generateId } from './src/lib/ai-chatbot';

      let adapter = null;
      let messageHistory = [];

      const initBtn = document.getElementById('initBtn');
      const explainBtn = document.getElementById('explainBtn');
      const extractBtn = document.getElementById('extractBtn');
      const loadAnotherBtn = document.getElementById('loadAnotherBtn');
      const statusEl = document.getElementById('status');
      const codeInput = document.getElementById('codeInput');
      const codeResponse = document.getElementById('codeResponse');
      const invoiceInput = document.getElementById('invoiceInput');
      const invoiceResponse = document.getElementById('invoiceResponse');
      const historyContent = document.getElementById('historyContent');
      const stateConnected = document.getElementById('stateConnected');
      const stateRunning = document.getElementById('stateRunning');
      const baseUrlInput = document.getElementById('baseUrl');
      const agentIdInput = document.getElementById('agentId');

      const sampleInvoice2 = `INVOICE #INV-2024-5678

Bill To:
Tech Solutions Inc
456 Innovation Dr
San Francisco, CA 94105

Invoice Date: January 20, 2024
Due Date: February 19, 2024

Items:
- Cloud Infrastructure Setup: $3,500.00
- Database Migration (30 hrs @ $175/hr): $5,250.00
- Security Audit: $2,750.00

Subtotal: $11,500.00
Tax (9.25%): $1,063.75
Total Due: $12,563.75

Payment Terms: Net 30
Payment Methods: ACH, Credit Card`;

      const tools = [
        {
          name: 'copyToClipboard',
          description: 'Copy text to clipboard',
          parameters: {
            type: 'object',
            properties: {
              text: { type: 'string', description: 'Text to copy' }
            },
            required: ['text']
          }
        },
        {
          name: 'exportJSON',
          description: 'Export data as JSON file',
          parameters: {
            type: 'object',
            properties: {
              data: { type: 'object', description: 'Data to export' },
              filename: { type: 'string', description: 'Filename for export' }
            },
            required: ['data']
          }
        }
      ];

      function showStatus(message, type = 'info') {
        statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        setTimeout(() => {
          statusEl.innerHTML = '';
        }, 5000);
      }

      function updateHistory() {
        if (messageHistory.length === 0) {
          historyContent.innerHTML = '<p style="color: #999; font-style: italic">No messages yet...</p>';
          return;
        }

        historyContent.innerHTML = messageHistory
          .map(msg => {
            if (msg.role === 'tool-call') {
              return `
                <div class="tool-call">
                  <div class="tool-name">ðŸ”§ Tool Call: ${msg.name}</div>
                  <div class="tool-args">${JSON.stringify(msg.args, null, 2)}</div>
                </div>
              `;
            }

            return `
              <div class="message">
                <div class="message-role ${msg.role}">${msg.role.toUpperCase()}</div>
                <div class="message-content">${msg.content}</div>
              </div>
            `;
          })
          .join('');

        historyContent.scrollTop = historyContent.scrollHeight;
      }

      function updateStateIndicators(state) {
        if (state.isConnected) {
          stateConnected.style.display = 'inline-block';
          stateConnected.classList.add('connected');
        } else {
          stateConnected.style.display = 'none';
        }

        if (state.isRunning) {
          stateRunning.style.display = 'inline-block';
          stateRunning.classList.add('running');
        } else {
          stateRunning.style.display = 'none';
        }
      }

      async function sendMessage(content, responseEl) {
        const userMessage = {
          id: generateId('msg'),
          role: 'user',
          content,
          timestamp: Date.now(),
          status: 'complete'
        };

        messageHistory.push(userMessage);
        updateHistory();

        responseEl.textContent = '';
        responseEl.classList.add('streaming');

        let currentResponse = '';
        let currentMessageId = null;

        adapter.onMessageStart(event => {
          currentMessageId = event.messageId;
          currentResponse = '';
        });

        adapter.onMessageDelta(event => {
          currentResponse += event.delta;
          responseEl.textContent = currentResponse;
        });

        adapter.onMessageEnd(() => {
          responseEl.classList.remove('streaming');
          messageHistory.push({
            id: currentMessageId,
            role: 'assistant',
            content: currentResponse,
            timestamp: Date.now(),
            status: 'complete'
          });
          updateHistory();
        });

        adapter.onToolCall(async event => {
          messageHistory.push({
            role: 'tool-call',
            name: event.name,
            args: event.args
          });
          updateHistory();

          let result;
          if (event.name === 'copyToClipboard') {
            try {
              await navigator.clipboard.writeText(event.args.text);
              result = { success: true, message: 'Copied to clipboard!' };
              showStatus('âœ… Copied to clipboard!', 'success');
            } catch (err) {
              result = { success: false, error: err.message };
              showStatus('âŒ Failed to copy to clipboard', 'error');
            }
          } else if (event.name === 'exportJSON') {
            try {
              const json = JSON.stringify(event.args.data, null, 2);
              const blob = new Blob([json], { type: 'application/json' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = event.args.filename || 'export.json';
              a.click();
              URL.revokeObjectURL(url);
              result = { success: true, message: 'JSON exported!' };
              showStatus('âœ… JSON exported!', 'success');
            } catch (err) {
              result = { success: false, error: err.message };
              showStatus('âŒ Failed to export JSON', 'error');
            }
          }

          adapter.sendToolResult(event.id, result);
        });

        adapter.onError(event => {
          showStatus(`âŒ Error: ${event.message}`, 'error');
          responseEl.classList.remove('streaming');
        });

        adapter.sendMessage(messageHistory.filter(m => m.role === 'user' || m.role === 'assistant' || m.role === 'tool'));
      }

      initBtn.addEventListener('click', async () => {
        const baseUrl = baseUrlInput.value.trim();
        const agentId = agentIdInput.value.trim();

        if (!baseUrl || !agentId) {
          showStatus('Please provide both Base URL and Agent ID', 'error');
          return;
        }

        try {
          adapter = new AgUiAdapter(
            {
              baseUrl,
              agentId,
              credentials: 'include',
              context: {
                purpose: 'standalone-adapter-demo',
                timestamp: new Date().toISOString()
              }
            },
            generateId('thread')
          );

          adapter.registerTools(tools);

          adapter.onStateChange(state => {
            updateStateIndicators(state);
            explainBtn.disabled = !state.isConnected || state.isRunning;
            extractBtn.disabled = !state.isConnected || state.isRunning;
            loadAnotherBtn.disabled = !state.isConnected || state.isRunning;
          });

          await adapter.connect();

          initBtn.disabled = true;
          baseUrlInput.disabled = true;
          agentIdInput.disabled = true;
          explainBtn.disabled = false;
          extractBtn.disabled = false;
          loadAnotherBtn.disabled = false;

          messageHistory = [];
          updateHistory();

          showStatus('âœ… Adapter initialized! Try the demos above.', 'success');
        } catch (error) {
          showStatus(`âŒ Initialization failed: ${error.message}`, 'error');
        }
      });

      explainBtn.addEventListener('click', () => {
        const code = codeInput.value.trim();
        if (!code) {
          showStatus('Please enter some code to explain', 'error');
          return;
        }

        sendMessage(
          `Explain this code in plain English:\n\n\`\`\`\n${code}\n\`\`\`\n\nProvide a clear, concise explanation of what it does and how it works.`,
          codeResponse
        );
      });

      extractBtn.addEventListener('click', () => {
        const invoice = invoiceInput.value.trim();
        if (!invoice) {
          showStatus('Please provide invoice text', 'error');
          return;
        }

        sendMessage(
          `Extract structured data from this invoice:\n\n${invoice}\n\nPlease extract: invoice number, customer name, date, due date, line items with amounts, subtotal, tax, and total. Format as JSON.`,
          invoiceResponse
        );
      });

      loadAnotherBtn.addEventListener('click', () => {
        invoiceInput.value = sampleInvoice2;
        invoiceResponse.textContent = '';
        showStatus('ðŸ“„ Loaded another invoice. Click "Extract Data" to process.', 'info');
      });
    </script>
  </body>
</html>
