@use '@tylertech/forge/sass/core/styles/theme' as forge-theme;
@use '@tylertech/forge/dist/icon-button/forge-icon-button';
@use '../utils/markdown-styles' as markdown;
@use '../utils/toolbar' as toolbar;

$cursor-blink-duration: 1s;
$fade-distance: 3ch;

:host {
  display: block;
  box-sizing: border-box;
}

:host(:state(empty)) {
  display: none;
}

.assistant-response {
  position: relative;
}

.text-chunk {
  @include markdown.markdown-content;

  &.revealing {
    mask-image: linear-gradient(to left, transparent 0%, black $fade-distance);
    mask-position: right;
    mask-size: 100% 100%;
  }
}

.text-chunk.show-cursor > :last-child::after {
  content: '';
  display: inline-block;
  width: 3px;
  height: 1.2em;
  background-color: #{forge-theme.variable(primary)};
  margin-inline-start: 2px;
  vertical-align: text-bottom;
  border-radius: 1px;
  animation: cursor-blink $cursor-blink-duration step-end infinite;
}

@keyframes cursor-blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .text-chunk.show-cursor > :last-child::after {
    animation: none;
  }

  .text-chunk.revealing {
    mask-image: none;
  }
}

.toolbar-container {
  @include toolbar.toolbar-container;
  left: 0;
}

.assistant-response[data-complete]:hover .toolbar-container,
.assistant-response[data-complete] .toolbar-container:focus-within {
  @include toolbar.toolbar-container-visible;
}

:host(:not(:last-of-type)) .assistant-response[data-complete]::after {
  content: '';
  position: absolute;
  bottom: -40px;
  left: 0;
  right: 0;
  height: 40px;
}

:host(:last-of-type) .assistant-response[data-complete] .toolbar-container {
  @include toolbar.toolbar-container-visible;
}

.debug-button {
  color: #{forge-theme.variable(on-error-container-low)};
  --forge-icon-button-focus-indicator-color: #{forge-theme.variable(error)};
  --forge-icon-button-tonal-background-color: #{forge-theme.variable(error-container-low)};
}
